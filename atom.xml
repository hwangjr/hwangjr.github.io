<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
  <title><![CDATA[HwangJR's Blog]]></title>
  <subtitle><![CDATA[Life is wonderful!]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="https://hwangjr.github.io//"/>
  <updated>2015-11-24T10:43:47.007Z</updated>
  <id>https://hwangjr.github.io//</id>
  
  <author>
    <name><![CDATA[HwangJR]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[发布开源项目到Maven（Gradle + Sonatype）]]></title>
    <link href="https://hwangjr.github.io/2015/11/24/%E5%8F%91%E5%B8%83%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%88%B0Maven%EF%BC%88Gradle-Sonatype%EF%BC%89/"/>
    <id>https://hwangjr.github.io/2015/11/24/发布开源项目到Maven（Gradle-Sonatype）/</id>
    <published>2015-11-24T10:43:22.000Z</published>
    <updated>2015-11-24T10:43:47.007Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>最近整理Android开发工具，想跟其他人分享，就有了将其发布到maven想法，所以考虑将库发布到maven，目前Android官方使用jCenter，比这个简单，后续补充（jCenter会自动同步Maven Center中的库）。<br>顺带避免：</p>
<blockquote>
<p>Download the source to use it as library project</p>
</blockquote>
<h2 id="流程">流程</h2><p>整个流程很清晰：</p>
<ol>
<li>获取JIRA Ticket，简单说就是去<a href="https://issues.sonatype.org/browse/" target="_blank" rel="external">Issues Sonatype</a>注册并提交issue</li>
<li>GPG密钥，要上传到maven，需要GPG密钥</li>
<li>本地配置POM，即配置项目信息</li>
<li>Gradle提交到Sonatype，通过脚本提交到Sonatype</li>
<li>发布版本，分为SNAPSHOT和Release版本</li>
</ol>
<p>整个流程就是酱紫。OVER。</p>
<h2 id="获取JIRA_Ticket">获取JIRA Ticket</h2><h3 id="注册JIRA帐号">注册JIRA帐号</h3><p>提交项目到Sonatype，首先需要注册。打开<a href="https://issues.sonatype.org/" target="_blank" rel="external">(Issue Sonatype)</a>注册JIRA帐号。</p>
<h3 id="创建Issue">创建Issue</h3><p>在导航上Create按钮，创建一个新的Issue。其中特别注意：</p>
<ol>
<li>Issue Type默认是new Project，按照默认就好</li>
<li>Summer和Description填写你要创建项目的描述即可</li>
<li>Group id特别关键，最好创建顶级Group ID，比如我需要<code>com.hwangjr.xxx</code>，那么Group ID填写为<code>com.hwangjr</code>，这样其他的库也可发布</li>
<li>Project URL和SCM URL填GIT HUB项目地址即可</li>
<li>其他基本都懂</li>
</ol>
<p>填写完毕，等待！工作人员会让你提交你的项目到Sonatype。</p>
<h2 id="GPG密钥">GPG密钥</h2><p>密钥是为了上传文件的加密和签名。如果有安装git，那么应该是已经安装GPG了，以下默认命令为Linux下。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成密钥</span></span><br><span class="line">gpg --gen-key</span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">gpg --list-key</span><br></pre></td></tr></table></figure></p>
<p>其中姓名、邮箱和备注需要认真填写下，最后输入的Passphase，是密码，上传maven需要使用。</p>
<blockquote>
<p>pub   2048R/B53A8137 2015-11-24<br>uid                  hwangjr (Upload Modules For Maven By Sonatype.) <a href="&#x6d;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#x68;&#x75;&#97;&#x6e;&#x67;&#x6a;&#105;&#97;&#x6e;&#114;&#x6f;&#x6e;&#x67;&#50;&#x30;&#49;&#48;&#64;&#x67;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;">&#x68;&#x75;&#97;&#x6e;&#x67;&#x6a;&#105;&#97;&#x6e;&#114;&#x6f;&#x6e;&#x67;&#50;&#x30;&#49;&#48;&#64;&#x67;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;</a><br>sub   2048R/2F11E234 2015-11-24</p>
</blockquote>
<p>B53A8137是KEY ID。上传公钥到服务器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver hkp://pool.sks-keyservers.net --send-keys B53A8137</span><br></pre></td></tr></table></figure></p>
<h2 id="本地配置POM">本地配置POM</h2><p>Chris Banes大神已经写完Gradle插件<a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="external">chrisbanes/gradle-mvn-push</a>，可直接使用<a href="https://raw.githubusercontent.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle" target="_blank" rel="external">gradle-mvn-push.gradle</a>，上面有详细的配置和使用方式。简要步骤为：</p>
<ol>
<li>项目，保证是可以用Gradle编译。</li>
<li>更新<code>HOME gradle.properties</code>，修改<code>USER_HOME/.gradle/gradle.properties</code>文件。</li>
<li>在项目根目录下，创建文件<code>gradle.properties</code>。</li>
<li>在想要上传的子模块下，分别创建<code>gradle.properties</code>。</li>
<li>在子模块下，应用Gradle插件，即在<code>build.gradle</code>末尾加上<code>apply from: &#39;https://raw.github.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle&#39;</code> 或者下载gradle-mvn-push.gradle文件，放到根目录的<code>gradle</code>文件夹下，在<code>build.gradle</code>末尾加上<code>apply from: rootProject.file(&#39;gradle/gradle-mvn-push.gradle&#39;)</code>。</li>
<li>编译并上传<code>gradle clean build uploadArchives</code>。</li>
</ol>
<p>其他属性：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RELEASE_REPOSITORY_URL (defaults to Maven Central's staging server)</span><br><span class="line">SNAPSHOT_REPOSITORY_URL (defaults to Maven Central's snapshot server)</span><br></pre></td></tr></table></figure></p>
<p>USER_HOME/.gradle/gradle.properties文件新增，内容修改为自身用户名密码，下面的就是创建的GPG密钥：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NEXUS_USERNAME=chrisbanes</span><br><span class="line">NEXUS_PASSWORD=g00dtry</span><br><span class="line"></span><br><span class="line">signing.keyId=ABCDEF12</span><br><span class="line">signing.password=n1c3try</span><br><span class="line">signing.secretKeyRingFile=<span class="regexp">/home/u</span>ser<span class="regexp">/.gnupg/</span>secring.gpg</span><br></pre></td></tr></table></figure></p>
<p>项目根目录下的gradle.properties文件内容为，需要根据具体项目情况进行修改：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">VERSION_NAME=0.9.2-SNAPSHOT</span><br><span class="line">VERSION_CODE=92</span><br><span class="line">GROUP=com.github.chrisbanes.actionbarpulltorefresh</span><br><span class="line"></span><br><span class="line">POM_DESCRIPTION=A modern implementation of the pull-to-refresh for Android</span><br><span class="line">POM_URL=https://github.com/chrisbanes/ActionBar-PullToRefresh</span><br><span class="line">POM_SCM_URL=https://github.com/chrisbanes/ActionBar-PullToRefresh</span><br><span class="line">POM_SCM_CONNECTION=scm:git@github.com:chrisbanes/ActionBar-PullToRefresh.git</span><br><span class="line">POM_SCM_DEV_CONNECTION=scm:git@github.com:chrisbanes/ActionBar-PullToRefresh.git</span><br><span class="line">POM_LICENCE_NAME=The Apache Software License, Version 2.0</span><br><span class="line">POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</span><br><span class="line">POM_LICENCE_DIST=repo</span><br><span class="line">POM_DEVELOPER_ID=chrisbanes</span><br><span class="line">POM_DEVELOPER_NAME=Chris Banes</span><br></pre></td></tr></table></figure></p>
<p>子模块的gradle.properties文件内容为：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POM_NAME=ActionBar-PullToRefresh Library</span><br><span class="line">POM_ARTIFACT_ID=library</span><br><span class="line">POM_PACKAGING=aar</span><br></pre></td></tr></table></figure></p>
<p><strong>其中</strong>VERSION_NAME后面如果带<code>SNAPSHOT</code>会提交到<a href="https://oss.sonatype.org/content/repositories/snapshots" target="_blank" rel="external">Snapshots</a>，这个不需要同步即可下载jar和源码，如果不加则为RELEASE版本，会同步到MAVEN CENTER。</p>
<h2 id="Gradle脚本提交到Sonatype">Gradle脚本提交到Sonatype</h2><p>运行命令：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean build uploadArchives</span><br></pre></td></tr></table></figure></p>
<p>即会执行clean，并重新编译，上传到Sonatype。</p>
<h2 id="发布版本">发布版本</h2><p>版本分为<code>SNAPSHOT</code>版本和<code>RELEASE</code>版本。<br>如果<code>VERSION_NAME</code>有加入<code>SNAPSHOT</code>，即为<code>SNAPSHOT</code>版本，不会同步到MAVEN。<br>如果没有<code>SNAPSHOT</code>，则会同步到MAVEN。</p>
<p>首次提交之后，登陆<a href="https://oss.sonatype.org/index.html#welcome" target="_blank" rel="external">Sonatype Nexus Professional</a>，查看<code>Staging Repositories</code>，找到提交的包，选择并close并Release，再到<code>issue sonatype</code>上提交的JIRA TICKET后面评论告知版本已经staged并released，可以进行sync，工作人员会进行同步。<br>同步成功之后，即可在<a href="http://search.maven.org/" target="_blank" rel="external">maven center</a>搜索到项目，可通过gradle添加依赖。</p>
<h2 id="常规发布步骤">常规发布步骤</h2><ol>
<li>发布<code>SNAPSHOT</code>版本是否查看是否正常</li>
<li>发布<code>RELEASE</code>版本到线上，并进行同步</li>
<li>修改为下个<code>SNAPSHOT</code>版本</li>
</ol>
<h2 id="TIPS">TIPS</h2><h3 id="发布JAR">发布JAR</h3><p>如果想发布JAR，在<a href="#本地配置POM">本地配置POM</a>时，修改<a href="https://raw.githubusercontent.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle" target="_blank" rel="external">gradle-mvn-push.gradle</a>，在脚本中加入：<br>``` gradle<br>artifacts {<br>    archives packageReleaseJar<br>}</p>
<h3 id="发布时返回401">发布时返回401</h3><p>401为没有权限错误，检查：</p>
<ol>
<li>用户名密码，可在gradle-mvn-push中打印日志查看用户名密码是否正确</li>
<li>检查Sonatype是否有权限</li>
</ol>
<h2 id="REFS">REFS</h2><p><a href="http://central.sonatype.org/pages/ossrh-guide.html" target="_blank" rel="external">OSSRH Guide</a><br><a href="http://www.ruanyifeng.com/blog/2013/07/gpg.html" target="_blank" rel="external">GPG入门教程</a><br><a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="external">gradle-mvn-push</a><br><a href="https://oss.sonatype.org/" target="_blank" rel="external">Sonatype Nexus Professional</a><br><a href="http://afoo.me/posts/2013-07-18-publishing-oss-release-to-maven-central-repo.html" target="_blank" rel="external">发布开源项目到Maven Central</a></p>
]]></content>
    <summary type="html">
    <![CDATA[在使用自己构建库的同时，是否有强烈的分享欲，那么，就开源上传到Maven Center让别人一起开森吧。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[应用内存泄露排查]]></title>
    <link href="https://hwangjr.github.io/2015/11/13/%E5%BA%94%E7%94%A8%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%8E%92%E6%9F%A5/"/>
    <id>https://hwangjr.github.io/2015/11/13/应用内存泄露排查/</id>
    <published>2015-11-13T03:26:23.000Z</published>
    <updated>2015-11-24T07:30:44.759Z</updated>
    <content type="html"><![CDATA[<h2 id="内存泄露">内存泄露</h2><p>用到神器<a href="https://github.com/square/leakcanary" target="_blank" rel="external">square/leakcanary</a>：</p>
<blockquote>
<p>A memory leak detection library for Android and Java.<br>“A small leak will sink a great ship.”    - Benjamin Franklin<br>千里之堤，毁于蚁穴。 — 《韩非子.喻老》</p>
</blockquote>
<h3 id="LeakCanary完整集成">LeakCanary完整集成</h3><p><strong>配置build.gradle</strong><br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">	    <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.2.3'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">apply plugin: <span class="string">'android-library'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">allprojects</span> &#123;</span><br><span class="line">	<span class="keyword">repositories</span>&#123;</span><br><span class="line">		jcenter()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">   debugCompile <span class="string">'com.squareup.leakcanary:leakcanary-android:1.3.1'</span></span><br><span class="line">   releaseCompile <span class="string">'com.squareup.leakcanary:leakcanary-android-no-op:1.3.1'</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>配置代码</strong><br>在你的APPLICATION中：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class ExampleApplication extends Application &#123;&#10;  @Override public void onCreate() &#123;&#10;&#9;super.onCreate();&#10;&#9;if (BuildConfig.DEBUG) &#123;&#10;&#9;    refWatcher = LeakCanary.install(this, LeakLogService.class,&#10;&#9;            AndroidExcludedRefs.createAndroidDefaults().build());&#10;&#9;&#125; else &#123;&#10;&#9;    refWatcher = RefWatcher.DISABLED;&#10;&#9;&#125;&#10;&#10;&#9;public static RefWatcher getRefWatcher(Context context) &#123;&#10;        ExampleApplication application = (ExampleApplication) context.getApplicationContext();&#10;        return application.refWatcher;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后在需要检测的地方进行监听即可：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public abstract class BaseFragment extends Fragment &#123;&#10;&#10;  @Override public void onDestroy() &#123;&#10;    super.onDestroy();&#10;    RefWatcher refWatcher = ExampleApplication.getRefWatcher(getActivity());&#10;    refWatcher.watch(this);&#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="简易集成">简易集成</h3><p>参考<a href="https://github.com/GavinCT/SimpleLeakCanary" target="_blank" rel="external">GavinCT/SimpleLeakCanary</a>。<br>拷贝库文件到项目下：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AndroidWatchExecutor<span class="class">.java</span></span><br><span class="line">GcTrigger<span class="class">.java</span></span><br><span class="line">KeyedWeakReference<span class="class">.java</span></span><br><span class="line">RefWatcher.java</span><br></pre></td></tr></table></figure></p>
<p>在需要监听的地方添加监听代码：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected void onDestroy() &#123;&#10;&#9;super.onDestroy();&#10;&#9;getApplicationContext().getRefWatcher().watch(this);&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="排查内存泄露">排查内存泄露</h2><p>利用Eclipse的Memory Analyzer（<a href="http://www.eclipse.org/mat/" target="_blank" rel="external">Eclipse Memory Analyzer Open Source Project</a>）可以方便的分析内存泄露原因。</p>
<p><strong>使用Studio帮助我们排查泄露</strong><br>通过Studio我们可以：</p>
<ol>
<li>查看内存堆栈情况</li>
<li>手动/强制垃圾回收，排除LeakCanary误报</li>
<li>导出Heap信息（Dump Java Heap）</li>
</ol>
<p>内存信息导出后，可用MAT打开.hprof文件进行分析，可能需要进行转换：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hprof-conv source.hprof dist.hprof</span><br></pre></td></tr></table></figure></p>
<p>打开QQL查询当前内存信息（快捷键CTRL + ENTER执行QQL语句）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from instanceof android.app.Activity</span><br></pre></td></tr></table></figure></p>
<p>查看内存信息，如果有多个相同对象即为可疑泄露对象：<br><code>右键 -&gt; Merge Shortest Paths to GC Roots -&gt; exclude all phantom/weak/soft etc. refrences</code><br>具体排查类，即可发现泄露对象。</p>
<h2 id="解决内存泄露">解决内存泄露</h2><p>针对可疑泄露对象，进行代码排查，即可解决。</p>
<h2 id="避免内存泄露">避免内存泄露</h2><p>良好编码习惯！</p>
<ol>
<li>匿名内部类</li>
<li>非静态内部类</li>
<li>单例对象持有Activity或Context对象<br>ETC…</li>
</ol>
<h2 id="REF">REF</h2><p><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-ma/index.html" target="_blank" rel="external">使用 Eclipse Memory Analyzer 进行堆转储文件分析</a><br><a href="https://github.com/square/leakcanary" target="_blank" rel="external">square/leakcanary</a><br><a href="http://droidyue.com/blog/2014/11/02/note-for-google-io-memory-management-for-android-chinese-edition/" target="_blank" rel="external">Google IO：Android内存管理主题演讲记录 - 技术小黑屋</a><br><a href="http://jiajixin.cn/2015/01/06/memory_leak/" target="_blank" rel="external">Android内存泄漏研究 | Jason’s Blog</a></p>
]]></content>
    <summary type="html">
    <![CDATA[调试内存泄露方法，监控应用是否正常使用内存并回收。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOS如何移除依赖]]></title>
    <link href="https://hwangjr.github.io/2015/11/09/CentOS%E5%A6%82%E4%BD%95%E7%A7%BB%E9%99%A4%E4%BE%9D%E8%B5%96/"/>
    <id>https://hwangjr.github.io/2015/11/09/CentOS如何移除依赖/</id>
    <published>2015-11-09T02:44:12.000Z</published>
    <updated>2015-11-09T02:44:38.879Z</updated>
    <content type="html"><![CDATA[<h2 id="自带清除技能">自带清除技能</h2><p>从Fedora 18之后，yum有自带清除：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum autoremove</span><br><span class="line">yum autoremove &lt;package&gt;</span><br><span class="line"><span class="comment"># 一般不用</span></span><br><span class="line">yum remove --setopt=clean_requerements_on_remove=<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="第三方技能">第三方技能</h2><p>安装<code>yum-utils</code>也是可以自动清理依赖：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line"><span class="comment"># 清理</span></span><br><span class="line">package-cleanup --leaves</span><br><span class="line">package-cleanup --leaves --all</span><br><span class="line">package-cleanup -q --leaves | xargs <span class="operator">-l</span>1 yum -y remove</span><br></pre></td></tr></table></figure></p>
<h2 id="回滚安装技能">回滚安装技能</h2><p>自然，我们是在安装的时候安装了依赖，那如果我们回滚本次安装，也一样可以卸载这些依赖：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install &lt;package&gt;</span><br><span class="line">yum <span class="built_in">history</span> list &lt;package&gt;</span><br><span class="line">yum <span class="built_in">history</span> undo &lt;ID&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="总结">总结</h2><p>相比而言，现在对包管理还是简单方便的，当然更高深的还需要自己摸索。</p>
]]></content>
    <summary type="html">
    <![CDATA[在使用CentOS时，会安装很多软件，自动解析依赖并安装，然而在卸载时候，仅仅只是卸载当前包，如何清除包及其依赖呢？]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Crontabs Guide]]></title>
    <link href="https://hwangjr.github.io/2015/10/27/Crontabs-Guide/"/>
    <id>https://hwangjr.github.io/2015/10/27/Crontabs-Guide/</id>
    <published>2015-10-27T04:05:24.000Z</published>
    <updated>2015-10-27T04:05:43.536Z</updated>
    <content type="html"><![CDATA[<h2 id="Introduction">Introduction</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man crontab</span><br></pre></td></tr></table></figure>
<p>—-&gt;</p>
<blockquote>
<p>Crontab  is the program used to install, remove or list the tables used to drive the cron(8) daemon.  Each user can have their own crontab, and though these are files in /var/spool/ , they are not intended to be edited directly. For SELinux in mls mode can be even more crontabs - for each range. For more see selinux(8).</p>
<p>The  cron  jobs  could  be allow or disallow for different users. For classical crontab there exists cron.allow and cron.deny files.  If cron.allow file exists, then you must be listed therein in order to be allowed to use this command.  If the cron.allow file does not exist but the cron.deny file does exist,  then  you must  not  be listed in the cron.deny file in order to use this command.  If neither of these files exists, only the super user will be allowed to use this com-mand. The second option is using PAM authentication, where you set up users, which could or couldn’t use crontab and also system cron jobs from /etc/cron.d/.</p>
<p>The temporary directory could be set in enviroment variables. If it’s not set by user than /tmp is used.</p>
</blockquote>
<h2 id="Installation">Installation</h2><p>Just the commands:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check installation</span></span><br><span class="line">rpm -ql crontabs</span><br><span class="line">rpm -qa crontabs</span><br><span class="line"><span class="comment"># install</span></span><br><span class="line">yum install crontabs</span><br><span class="line"><span class="comment"># start service on boot</span></span><br><span class="line">chkconfig crond on</span><br><span class="line"><span class="comment"># start service now</span></span><br><span class="line">service crond start</span><br><span class="line">service crond status</span><br><span class="line">service crond restart</span><br><span class="line">service crond reload</span><br><span class="line">service crond stop</span><br></pre></td></tr></table></figure></p>
<p>Also, you can check the service by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntsysv</span><br></pre></td></tr></table></figure></p>
<h2 id="Usage">Usage</h2><h3 id="Basic_Usage">Basic Usage</h3><p>Also, <code>man</code> is our best friend :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man crontab</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li>NAME<br>crontab - maintain crontab files for individual users</li>
<li>SYNOPSIS<br>crontab [-u user] file<br>crontab [-u user] [-l | -r | -e] [-i] [-s]</li>
<li>OPTIONS<pre><code>**-u**     Append <span class="keyword">the</span> <span class="property">name</span> <span class="keyword">of</span> <span class="keyword">the</span> user <span class="keyword">whose</span> crontab <span class="keyword">is</span> <span class="keyword">to</span> be tweaked.  If this option <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">given</span>, crontab examines <span class="string">"your"</span> crontab, i.e., <span class="keyword">the</span> crontab <span class="keyword">of</span> <span class="keyword">the</span>  person  executing  <span class="keyword">the</span>  command.   Note  <span class="keyword">that</span>  su(<span class="number">8</span>) can confuse crontab <span class="keyword">and</span> <span class="keyword">that</span> <span class="keyword">if</span> you are <span class="property">running</span> inside <span class="keyword">of</span> su(<span class="number">8</span>) you should always use <span class="keyword">the</span> -u option <span class="keyword">for</span> safety’s sake.  The <span class="keyword">first</span> form <span class="keyword">of</span> this command <span class="keyword">is</span> used <span class="keyword">to</span> install a new crontab <span class="keyword">from</span> <span class="keyword">some</span> named <span class="type">file</span> <span class="keyword">or</span> standard input  <span class="keyword">if</span>  <span class="keyword">the</span>  pseudo-filename  <span class="string">"-"</span>  <span class="keyword">is</span> <span class="keyword">given</span>.
**-l**     The current crontab will be displayed <span class="function_start"><span class="keyword">on</span></span> standard output.
**-r**     The current crontab will be removed.
**-e**     This  option  <span class="keyword">is</span> used <span class="keyword">to</span> edit <span class="keyword">the</span> current crontab using <span class="keyword">the</span> editor specified <span class="keyword">by</span> <span class="keyword">the</span> VISUAL <span class="keyword">or</span> EDITOR environment variables.  After you <span class="keyword">exit</span> <span class="keyword">from</span> <span class="keyword">the</span> editor, <span class="keyword">the</span> modified crontab will be installed automatically.
**-i**     This option modifies <span class="keyword">the</span> -r option <span class="keyword">to</span> prompt <span class="keyword">the</span> user <span class="keyword">for</span> a ’y/Y’ response <span class="keyword">before</span> actually removing <span class="keyword">the</span> crontab.
**-s**     It will append <span class="keyword">the</span> current SELinux security context <span class="type">string</span> <span class="keyword">as</span> an MLS_LEVEL setting <span class="keyword">to</span> <span class="keyword">the</span> crontab <span class="type">file</span> <span class="keyword">before</span> editing / replacement occurs - see <span class="keyword">the</span> doc-umentation <span class="keyword">of</span> MLS_LEVEL <span class="keyword">in</span> crontab(<span class="number">5</span>).
</code></pre></li>
<li>FILES<pre><code><span class="regexp">/etc/</span>cron.allow
<span class="regexp">/etc/</span>cron.deny
</code></pre></li>
</ul>
</blockquote>
<p>Shortly for this :<br>&gt;</p>
<ul>
<li>usage:<br>  crontab [-u user] file<br>  crontab [-u user] [ -e | -l | -r ]<pre><code>(<span class="keyword">default</span> operation <span class="keyword">is</span> <span class="built_in">replace</span>, per <span class="number">1003.2</span>)
</code></pre>  -e    (edit user’s crontab)<br>  -l    (list user’s crontab)<br>  -r    (delete user’s crontab)<br>  -i    (prompt before deleting user’s crontab)<br>  -s    (selinux context)</li>
</ul>
<p>The format of <code>-e</code> command is:<br><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  *    *    *    *    *   command</span><br><span class="line">minus <span class="built_in">hour</span> <span class="built_in">day</span> <span class="built_in">month</span> week command</span><br><span class="line"></span><br><span class="line">minus: <span class="number">1</span>~<span class="number">59</span> minus, * <span class="keyword">or</span> */<span class="number">1</span> <span class="keyword">for</span> per minus</span><br><span class="line"><span class="built_in">hour</span>: <span class="number">1</span>~<span class="number">23</span>, <span class="number">0</span> means <span class="number">0</span> o<span class="comment">'clock</span></span><br><span class="line"><span class="built_in">day</span>: <span class="number">1</span>~<span class="number">31</span></span><br><span class="line"><span class="built_in">month</span>: <span class="number">1</span>~<span class="number">12</span></span><br><span class="line">week: <span class="number">0</span>~<span class="number">6</span>, <span class="number">0</span> means sunday</span><br><span class="line">command: the command u want <span class="keyword">to</span> run</span><br></pre></td></tr></table></figure></p>
<h3 id="Examples">Examples</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># every night at <span class="number">21</span>:<span class="number">31</span> reload nginx</span></span><br><span class="line"><span class="preprocessor"># 每晚的<span class="number">21</span>:<span class="number">30</span></span></span><br><span class="line"><span class="number">30</span> <span class="number">21</span> * * * /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># <span class="number">1</span>, <span class="number">10</span>, <span class="number">22</span> per month at <span class="number">4</span>:<span class="number">45</span> reload nginx</span></span><br><span class="line"><span class="preprocessor"># 每月<span class="number">1</span>、<span class="number">10</span>、<span class="number">22</span>日的<span class="number">4</span>:<span class="number">45</span></span></span><br><span class="line"><span class="number">45</span> <span class="number">4</span> <span class="number">1</span>,<span class="number">10</span>,<span class="number">22</span> * * /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># saturday and sunday per week at <span class="number">1</span>:<span class="number">10</span> reload nginx</span></span><br><span class="line"><span class="preprocessor"># 每周六、周日的<span class="number">1</span>:<span class="number">10</span></span></span><br><span class="line"><span class="number">10</span> <span class="number">1</span> * * <span class="number">6</span>,<span class="number">0</span> /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># <span class="number">18</span>:<span class="number">00</span> ~ <span class="number">23</span>:<span class="number">00</span> per <span class="number">30</span> minus everyday reload nginx</span></span><br><span class="line"><span class="preprocessor"># 每天<span class="number">18</span>:<span class="number">00</span>至<span class="number">23</span>:<span class="number">00</span>之间每隔<span class="number">30</span>分钟</span></span><br><span class="line"><span class="number">0</span>,<span class="number">30</span> <span class="number">18</span>-<span class="number">23</span> * * * /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># saturday per week at <span class="number">23</span>:<span class="number">00</span> reload nginx</span></span><br><span class="line"><span class="preprocessor"># 每星期六的<span class="number">23</span>:<span class="number">00</span></span></span><br><span class="line"><span class="number">0</span> <span class="number">23</span> * * <span class="number">6</span> /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># <span class="number">23</span>:<span class="number">00</span> ~ <span class="number">7</span>:<span class="number">00</span> per hour</span></span><br><span class="line"><span class="preprocessor"># <span class="number">23</span>点到<span class="number">7</span>点之间，每隔一小时</span></span><br><span class="line"><span class="number">0</span> <span class="number">23</span>-<span class="number">7</span>/<span class="number">1</span> * * * /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># per hour</span></span><br><span class="line"><span class="comment"># 每一小时</span></span><br><span class="line"><span class="keyword">*</span> <span class="keyword">*</span>/1 <span class="keyword">*</span> <span class="keyword">*</span> <span class="keyword">*</span> /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># <span class="number">4</span> every month and monday to wednesday every week at <span class="number">11</span>:<span class="number">00</span></span></span><br><span class="line"><span class="preprocessor"># 每月的<span class="number">4</span>号与每周一到周三的<span class="number">11</span>点</span></span><br><span class="line"><span class="number">0</span> <span class="number">11</span> <span class="number">4</span> * mon-wed /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># <span class="number">1</span> january at <span class="number">4</span>:<span class="number">00</span></span></span><br><span class="line"><span class="preprocessor"># 一月一号的<span class="number">4</span>点</span></span><br><span class="line"><span class="number">0</span> <span class="number">4</span> <span class="number">1</span> jan * /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># per 30 minus</span></span><br><span class="line"><span class="comment"># 每半小时</span></span><br><span class="line"><span class="keyword">*</span>/30 <span class="keyword">*</span> <span class="keyword">*</span> <span class="keyword">*</span> <span class="keyword">*</span> /usr/bin/nginx -s reload</span><br></pre></td></tr></table></figure>
<h3 id="Advanced_Usage">Advanced Usage</h3><p>For the files:</p>
<ul>
<li>/etc/cron.allow : list the user who can use crontab</li>
<li>/etc/cron.deny : list the user who cannot use crontab</li>
<li>/var/spool/cron : all users and their crontab will be store here</li>
<li>/var/log/cron : cron log per job</li>
<li>/etc/crontab : for system jobs, <code>crontab -e</code> is for current user</li>
<li>/etc/cron.d/* : seperated cron file</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/cron.d</span><br><span class="line"><span class="number">0</span>hourly  raid-check</span><br><span class="line"></span><br><span class="line">cat /etc/cron.d/<span class="number">0</span>hourly </span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line">HOME=/</span><br><span class="line"><span class="number">01</span> * * * * root run-parts /etc/cron.hourly</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/cron.hourly/</span><br><span class="line"><span class="number">0</span>anacron</span><br><span class="line"></span><br><span class="line">cat /etc/cron.hourly/<span class="number">0</span>anacron </span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Skip excecution unless the date has changed from the previous run </span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -r /var/spool/anacron/cron.daily; <span class="keyword">then</span></span><br><span class="line">    day=`cat /var/spool/anacron/cron.daily`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ `date +%Y%m%d` = <span class="string">"<span class="variable">$day</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Skip excecution unless AC powered</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -x /usr/bin/on_ac_power; <span class="keyword">then</span></span><br><span class="line">    /usr/bin/on_ac_power &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> $? <span class="operator">-eq</span> <span class="number">1</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">/usr/sbin/anacron <span class="operator">-s</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/anacrontab </span><br><span class="line"><span class="comment"># /etc/anacrontab: configuration file for anacron</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See anacron(8) and anacrontab(5) for details.</span></span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"><span class="comment"># the maximal random delay added to the base delay of the jobs</span></span><br><span class="line">RANDOM_DELAY=<span class="number">45</span></span><br><span class="line"><span class="comment"># the jobs will be started during the following hours only</span></span><br><span class="line">START_HOURS_RANGE=<span class="number">3</span>-<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#period in days   delay in minutes   job-identifier   command</span></span><br><span class="line"><span class="number">1</span>	<span class="number">5</span>	cron.daily		nice run-parts /etc/cron.daily</span><br><span class="line"><span class="number">7</span>	<span class="number">25</span>	cron.weekly		nice run-parts /etc/cron.weekly</span><br><span class="line">@monthly <span class="number">45</span>	cron.monthly		nice run-parts /etc/cron.monthly</span><br></pre></td></tr></table></figure>
<p><a href="http://linux.vbird.org/linux_basic/0430cron.php" target="_blank" rel="external">More Info</a>.</p>
<h2 id="Practice">Practice</h2><p>I want to backup my svn daily, so i must have a script to backup:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="built_in">cd</span> /home/svn/repos</span><br><span class="line">now=`/bin/date +%Y%m%d`</span><br><span class="line">/bin/tar czvf <span class="string">"kk_backup_<span class="variable">$now</span>.tar.gz"</span> kk/ &amp;&amp; rm -rf /home/svn/backup/* &amp;&amp; /bin/mv kk_backup_*.tar.gz /home/svn/backup/</span><br><span class="line"><span class="keyword">if</span> [ $? == <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">result=<span class="string">"backup svn OK!!"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">result=<span class="string">"backup svn False!!"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br></pre></td></tr></table></figure></p>
<p>then just give the script to <code>/etc/cron.daily</code>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp scripts/backup.sh /etc/cron.daily/svn_backup.sh</span><br><span class="line">chmod +x /etc/cron.daily/svn_backup.sh</span><br></pre></td></tr></table></figure></p>
<p>That’s all.</p>
<h1 id="REF">REF</h1><p><a href="http://linux.vbird.org/linux_basic/0430cron.php" target="_blank" rel="external">鳥哥的 Linux 私房菜 — 第十五章、例行性工作排程(crontab)</a><br><a href="http://www.cnblogs.com/ccdc/archive/2012/06/01/2529471.html" target="_blank" rel="external">centos中crontab（计时器）用法详解 - 长城的草 - 博客园</a></p>
]]></content>
    <summary type="html">
    <![CDATA[The guide line about crontabs。]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOS6.5使用RSYNC发布程序]]></title>
    <link href="https://hwangjr.github.io/2015/10/24/CentOS6-5%E4%BD%BF%E7%94%A8RSYNC%E5%8F%91%E5%B8%83%E7%A8%8B%E5%BA%8F/"/>
    <id>https://hwangjr.github.io/2015/10/24/CentOS6-5使用RSYNC发布程序/</id>
    <published>2015-10-24T11:53:51.000Z</published>
    <updated>2015-10-24T11:54:25.895Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>Rsync（remote synchronize）是一个远程数据同步工具，可通过LAN/WAN快速同步多台主机间的文件，也可以使用 Rsync 同步本地硬盘中的不同目录。</p>
<blockquote>
<p>rsync is an <a href="http://www.opensource.org/" target="_blank" rel="external">open source</a> utility that provides fast incremental file transfer. rsync is freely available under the <a href="https://rsync.samba.org/GPL.html" target="_blank" rel="external">GNU General Public License</a> and is currently being maintained by <a href="http://opencoder.net/" target="_blank" rel="external">Wayne Davison</a>.<br>If you are running (1) an xattr-enabled rsync older than 3.0.2, (2) a writable rsync daemon older than 3.0.0, or (3) a version of rsync older than 2.6.6, please see the <a href="https://rsync.samba.org/security.html" target="_blank" rel="external">rsync security advisory page</a>.</p>
</blockquote>
<p>本次将使用此工具与SVN配合，通过SVN进行版本控制，上传代码之后，自动同步发布到线上。</p>
<h2 id="安装">安装</h2><p>查询现有版本并安装。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询</span></span><br><span class="line">rpm -qa | grep rsync</span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">rpm <span class="operator">-e</span> rsync</span><br><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget http://pkgs.repoforge.org/rsync/rsync-<span class="number">3.1</span>.<span class="number">1</span>-<span class="number">1</span>.el6.rfx.x86_64.rpm</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">rpm -ivh rsync-<span class="number">3.1</span>.<span class="number">1</span>-<span class="number">1</span>.el6.rfx.x86_64.rpm</span><br><span class="line"><span class="comment"># 直接升级</span></span><br><span class="line">rpm -Uvh rsync-<span class="number">3.1</span>.<span class="number">1</span>-<span class="number">1</span>.el6.rfx.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p>自然，你可以通过<code>yum</code>安装，不过版本较低：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rsync.x86_64 <span class="number">0</span>:<span class="number">3.0</span>.<span class="number">6</span>-<span class="number">9</span>.el6_4.<span class="number">1</span> will be updated</span><br><span class="line">---&gt; Package rsync.x86_64 <span class="number">0</span>:<span class="number">3.0</span>.<span class="number">6</span>-<span class="number">12</span>.el6 will be an update</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br></pre></td></tr></table></figure></p>
<h2 id="配置">配置</h2><h3 id="初始配置">初始配置</h3><ul>
<li>选择rsync服务器启动方式：<ol>
<li>rsync服务器负载较高，则使用独立启动模式</li>
<li>rsync服务器负载较低，使用xinetd运行方式</li>
</ol>
</li>
<li>创建配置文件rsyncd.conf</li>
<li>对于非匿名方式访问的rsync服务器创建配置口令（建议配置需要口令访问）<br>CentOS 默认以xinetd模式运行rsync，rsync的xinetd配置文件是/etc/xinetd.d/rsync<br>如果配置rsync以xinetd模式运行，执行如下命令<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chkconfig rsync on</span><br><span class="line">service xinetd restart</span><br><span class="line"><span class="preprocessor"># 如果执行 service xinetd restart 发现 xinetd: unrecognized service 则未安装xinetd服务</span></span><br><span class="line"><span class="preprocessor"># 执行 yum install xinetd 安装 xinetd服务</span></span><br><span class="line"><span class="preprocessor"># 安装之后启动 xinetd服务(service xinetd start)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>编辑rsync的xinetd配置文件/etc/xinetd.d/rsync文件，修改参数 server_args = —daemon —config=/etc/rsyncd/rsyncd.conf 可以配置rsync服务器启动时的参数</p>
<p>如果使用独立运行模式，则执行如下命令<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/rsync <span class="comment">--daemon</span></span><br><span class="line">#编辑 /etc/rc.<span class="keyword">local</span>文件 加入 /usr/bin/rsync <span class="comment">--daemon 保证每次开机启动都会自动启动rsync服务</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置设置">配置设置</h3><p>创建配置目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建rsync服务目录</span></span><br><span class="line">mkdir /etc/rsyncd</span><br><span class="line"><span class="comment"># 创建配置文件</span></span><br><span class="line">touch /etc/rsyncd/rsyncd.conf</span><br><span class="line"><span class="comment"># 创建密码文件</span></span><br><span class="line">touch /etc/rsyncd/rsyncd.passwd</span><br><span class="line"><span class="comment">#权限修改</span></span><br><span class="line">chown root:root /etc/rsyncd/rsyncd.passwd</span><br><span class="line">chmod <span class="number">600</span> /etc/rsyncd/rsyncd.passwd</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># GLOBAL OPTIONS</span><br><span class="line">uid = root                         </span><br><span class="line">gid = root                                  </span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">use</span> chroot = <span class="keyword">no</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">read</span> <span class="keyword">only</span> = yes</span><br><span class="line"></span><br><span class="line">#<span class="keyword">limit</span> <span class="keyword">access</span> <span class="keyword">to</span> <span class="keyword">private</span> LANs</span><br><span class="line"><span class="keyword">hosts</span> <span class="keyword">allow</span>=<span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> <span class="number">10.0</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">hosts</span> deny=*</span><br><span class="line"><span class="keyword">max</span> connections = <span class="number">5</span>                      </span><br><span class="line"></span><br><span class="line">pid <span class="keyword">file</span> = /<span class="keyword">var</span>/run/rsyncd.pid             </span><br><span class="line"></span><br><span class="line">secrets <span class="keyword">file</span> = /etc/rsyncd/rsyncd.passwd</span><br><span class="line">#<span class="keyword">lock</span> <span class="keyword">file</span> = /<span class="keyword">var</span>/run/rsync.<span class="keyword">lock</span>           </span><br><span class="line"></span><br><span class="line">#motd <span class="keyword">file</span> = /etc/rsyncd/rsyncd.motd        </span><br><span class="line"></span><br><span class="line">#This will give you a separate <span class="keyword">log</span> <span class="keyword">file</span></span><br><span class="line">#<span class="keyword">log</span> <span class="keyword">file</span> = /<span class="keyword">var</span>/<span class="keyword">log</span>/rsync.<span class="keyword">log</span></span><br><span class="line"></span><br><span class="line">#This will <span class="keyword">log</span> every <span class="keyword">file</span> transferred - up <span class="keyword">to</span> <span class="number">85</span>,<span class="number">000</span>+ per <span class="keyword">user</span>, per <span class="keyword">sync</span></span><br><span class="line">transfer <span class="keyword">logging</span> = yes</span><br><span class="line"></span><br><span class="line"><span class="keyword">log</span> <span class="keyword">format</span> = %<span class="keyword">t</span> %a %<span class="keyword">m</span> %<span class="keyword">f</span> %b</span><br><span class="line">syslog facility = local3</span><br><span class="line"><span class="keyword">timeout</span> = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">MODULE</span> OPTIONS</span><br><span class="line">[hwangjrhome]</span><br><span class="line"><span class="keyword">path</span> = /home/hwangjr/</span><br><span class="line"><span class="keyword">list</span>=yes</span><br><span class="line"><span class="keyword">ignore</span> <span class="keyword">errors</span></span><br><span class="line">auth <span class="keyword">users</span> = hwangjr</span><br><span class="line"><span class="keyword">comment</span> = HwangJR home</span><br><span class="line"><span class="keyword">exclude</span> = important/</span><br><span class="line"></span><br><span class="line">[chinatmp]</span><br><span class="line"><span class="keyword">path</span> = /tmp/china/</span><br><span class="line"><span class="keyword">list</span>=<span class="keyword">no</span></span><br><span class="line"><span class="keyword">ignore</span> <span class="keyword">errors</span></span><br><span class="line">auth <span class="keyword">users</span> = china</span><br><span class="line"><span class="keyword">comment</span> = tmp china</span></span><br></pre></td></tr></table></figure></p>
<p>密码文件：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">hwangjr:</span>asdf             <span class="preprocessor">#格式   用户名:口令</span></span><br><span class="line"><span class="label">china:</span>jk               <span class="preprocessor">#该用户不要求是系统用户</span></span><br></pre></td></tr></table></figure></p>
<p>查看服务是否启动：<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an <span class="string">| grep 873</span></span><br></pre></td></tr></table></figure></p>
<h3 id="自动同步">自动同步</h3><p>编辑crontab<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab <span class="operator">-e</span></span><br></pre></td></tr></table></figure></p>
<p>加入同步命令：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 每天<span class="number">0</span>点<span class="number">10</span>分执行后面的命令</span></span><br><span class="line"><span class="number">10</span> <span class="number">0</span> * * * rsync -avzP  --<span class="keyword">delete</span>  --password-file=/tmp/rsync.password hwangjr@<span class="number">172.16</span><span class="number">.1</span><span class="number">.135</span>::hwangjrhome  /tmp/hwangjr/</span><br></pre></td></tr></table></figure></p>
<h3 id="客户端配置">客户端配置</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 安装客户端</span></span><br><span class="line">yum -y install rsync</span><br><span class="line"><span class="preprocessor"># 同步命令</span></span><br><span class="line"><span class="preprocessor"># -a 参数，相当于-rlptgoD</span></span><br><span class="line"><span class="preprocessor">#   -r 是递归 -l 是链接文件，意思是拷贝链接文件；-p 表示保持文件原有权限</span></span><br><span class="line"><span class="preprocessor">#   -t 保持文件原有时间；-g 保持文#件原有用户组；-o 保持文件原有属主；-D 相当于块设备文件</span></span><br><span class="line"><span class="preprocessor"># -z 传输时压缩；</span></span><br><span class="line"><span class="preprocessor"># -P 传输进度；</span></span><br><span class="line"><span class="preprocessor"># -v 传输时的进度等信息，和-P有点关系，自己试试。可以看文档；</span></span><br><span class="line"><span class="preprocessor"># 同步</span></span><br><span class="line">rsync -avzP hwangjr@<span class="number">172.16</span><span class="number">.1</span><span class="number">.135</span>::hwangjrhome  /tmp/hwangjr/</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 客户端数据和服务器端数据保持一致</span></span><br><span class="line"><span class="preprocessor"># –delete 选项，表示客户端上的数据要与服务器端完全一致，如果 /tmp/hwangjr/目录中有服务器上不存在的文件，则删除。最终目的是让/tmp/hwangjr/目录上的数据完全与服务器上保持一致；用的时候要小心点，最好不要把已经有重要数所据的目录，当做本地更新目录，否则会把你的数据全部删除</span></span><br><span class="line">rsync -avzP  --delete hwangjr@<span class="number">172.16</span><span class="number">.1</span><span class="number">.135</span>::hwangjrhome  /tmp/hwangjr/</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 指定传输时候的密码文件，密码文件权限 600</span></span><br><span class="line"><span class="preprocessor"># –password-file=rsync.password ，这时当我们以hwangjr用户登录rsync服务器同步数据时，密码将读取 /tmp/rsync.password 这个文件。这个文件内容只是hwangjr用户的密码。我们要如下做；</span></span><br><span class="line"><span class="preprocessor"># touch /tmp/rsync.password</span></span><br><span class="line"><span class="preprocessor"># chmod 600 /tmp/rsync.password</span></span><br><span class="line"><span class="preprocessor"># echo "asdf"&gt; /tmp/rsync.password</span></span><br><span class="line"><span class="preprocessor"># rsync -avzP  --delete  --password-file=/tmp/rsync.password hwangjr@172.16.1.135::hwangjrhome  /tmp/hwangjr/</span></span><br><span class="line"><span class="preprocessor"># 注： 这样就不需要密码了，服务器通过crond 计划任务自动同步</span></span><br><span class="line">rsync -avzP  --delete  --password-file=/tmp/rsync.password hwangjr@<span class="number">172.16</span><span class="number">.1</span><span class="number">.135</span>::hwangjrhome  /tmp/hwangjr/</span><br></pre></td></tr></table></figure>
<h3 id="配置语法">配置语法</h3><blockquote>
<ul>
<li><strong>模块</strong>：<br>  以[模块名称]开始</li>
<li><strong>参数配置行</strong>：<br>  格式 name = value<br>  其中 value的值可以是string(可以不使用引号)或者boolean(0/1,true/false,yes/no)</li>
<li><strong>以#开始是注释行</strong></li>
<li><strong>以\是续行符</strong></li>
</ul>
</blockquote>
<ol>
<li><p>全局参数（[模块名称]之外的配置均为全局配置）<br><strong>address</strong><br>在独立运行时，用于指定的服务器运行的 IP 地址。由 xinetd 运行时将忽略此参数，使用命令行上的 –address 选项替代<br>默认值 本地所有IP<br><strong>port</strong><br>指定 rsync 守护进程监听的端口号。 由 xinetd 运行时将忽略此参数，使用命令行上的–port 选项替代。<br>默认值是 873<br><strong>motd file</strong><br>指定一个消息文件，当客户连接服务器时该文件的内容显示给客户。<br>默认值无<br><strong>pid file</strong><br>rsync 的守护进程将其 PID 写入指定的文件。<br>默认值 无<br><strong>log file</strong><br>指定 rsync 守护进程的日志文件，而不将日志发送给 syslog。<br>默认值 无<br><strong>syslog facility</strong><br>指定 rsync 发送日志消息给 syslog 时的消息级别<br>默认值 daemon<br><strong>socket options</strong><br>指定自定义 TCP 选项。<br>默认值无</p>
</li>
<li><p>模块参数<br>模块参数主要用于定义 rsync 服务器哪个目录要被同步。模块声明的格式必须为 [module] 形式，这个名字就是在 rsync 客户端看到的名字，类似于 Samba 服务器提供的共享名。而服务器真正同步的数据是通过 path 来指定的。可以根据自己的需要，来指定多个模块，模块中可以定义以下参数：</p>
</li>
</ol>
<ul>
<li>基本模块参数<br><strong>path</strong><br>指定当前模块在 rsync 服务器上的同步路径，该参数是必须指定的<br><strong>comment</strong><br>给模块指定一个描述，该描述连同模块名在客户连接得到模块列表时显示给客户<br>模块控制参数<br><strong>use chroot</strong><br>若为 true，则 rsync 在传输文件之前首先 chroot 到 path 参数所指定的目录下。这样做的原因是实现额外的安全防护，但是缺点是需要 root 权限，并且不能备份指向 path 外部的符号连接所指向的目录文件。<br>默认值true<br><strong>uid</strong><br>指定该模块以指定的 UID 传输文件。<br>默认值 nobody<br><strong>gid</strong><br>指定该模块以指定的 GID 传输文件。<br>默认值 nobody<br><strong>max connections</strong><br>定该模块的最大并发连接数量以保护服务器，超过限制的连接请求将被告知随后再试。<br>默认值 0 不限制<br><strong>read only</strong><br>指定是否允许客户上传文件。若为 true 则不允许上传；若为 false 并且服务器目录也具有读写权限则允许上传。<br>默认值 true<br><strong>write only</strong><br>指定是否允许客户下载文件。若为 true 则不允许下载；若为 false 并且服务器目录也具有读权限则允许下载。<br>默认值 false<br>模块认证参数<br><strong>hosts allow</strong><br>用一个主机列表指定哪些主机客户允许连接该模块。不匹配主机列表的主机将被拒绝<br>默认值 <em><br><strong>hosts deny</strong><br>用一个主机列表指定哪些主机客户不允许连接该模块。<br>默认值 空<br><strong>auth users</strong><br>指定由空格或逗号分隔的用户名列表，只有这些用户才允许连接该模块。这里的用户和系统用户没有任何关系。用户名和口令以明文方式存放在 secrets file 参数指定的文件中<br>默认匿名<br><strong>secrets file</strong><br>指定一个 rsync 认证口令文件。只有在 auth users 被定义时，该文件才起作用。<br>默认值 空<br><em>*strict modes</em></em><br>指定是否监测口令文件的权限。若为 true 则口令文件只能被 rsync 服务器运行身份的用户访问，其他任何用户不可以访问该文件。<br>默认值 true</li>
</ul>
<p>其中客户主机列表定义可以是以下形式：</p>
<blockquote>
<p>单个IP地址 例如：192.168.0.1<br>整个网段 例如：192.168.0.0/24，192.168.0.0/255.255.255.0<br>可解析的单个主机名 例如：centos，centos.bsmart.cn<br>域内的所有主机 例如：.bsmart.cn<br>“”则表示所有。<br>多个列表项要用空格间隔。</p>
</blockquote>
<p>而认证口令则：</p>
<blockquote>
<p>rsync 认证口令文件的权限一定是 600，否则客户端将不能连接服务器。<br>rsync 认证口令文件中每一行指定一个 用户名:口令 对，格式为：username:passwd<br>一般来说口令最好不要超过8个字符。若您只配置匿名访问的 rsync 服务器，则无需设置上述参数。</p>
</blockquote>
<h2 id="SVN同步实例">SVN同步实例</h2><p>基本思路就是，当发生commit时，触发服务端svn数据目录update，也触发rsync去同步网站目录。</p>
<h3 id="服务器配置文件">服务器配置文件</h3><p>编辑配置文件：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/rsyncd/rsyncd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure></p>
<p>配置文件为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># GLOBAL OPTIONS</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">use</span> chroot = <span class="keyword">no</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">read</span> <span class="keyword">only</span> = yes</span><br><span class="line"></span><br><span class="line">#<span class="keyword">limit</span> <span class="keyword">access</span> <span class="keyword">to</span> <span class="keyword">private</span> LANs</span><br><span class="line"><span class="keyword">hosts</span> <span class="keyword">allow</span>=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">hosts</span> deny=*</span><br><span class="line"><span class="keyword">max</span> connections = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">pid <span class="keyword">file</span> = /<span class="keyword">var</span>/run/rsyncd.pid</span><br><span class="line">secrets <span class="keyword">file</span> = /etc/rsyncd/rsyncd.passwd</span><br><span class="line"><span class="keyword">lock</span> <span class="keyword">file</span> = /<span class="keyword">var</span>/run/rsync.<span class="keyword">lock</span></span><br><span class="line">#motd <span class="keyword">file</span> = /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line">#This will give you a separate <span class="keyword">log</span> <span class="keyword">file</span></span><br><span class="line">#<span class="keyword">log</span> <span class="keyword">file</span> = /<span class="keyword">var</span>/<span class="keyword">log</span>/rsync.<span class="keyword">log</span></span><br><span class="line"></span><br><span class="line">#This will <span class="keyword">log</span> every <span class="keyword">file</span> transferred - up <span class="keyword">to</span> <span class="number">85</span>,<span class="number">000</span>+ per <span class="keyword">user</span>, per <span class="keyword">sync</span></span><br><span class="line">transfer <span class="keyword">logging</span> = yes</span><br><span class="line"><span class="keyword">log</span> <span class="keyword">format</span> = %<span class="keyword">t</span> %a %<span class="keyword">m</span> %<span class="keyword">f</span> %b</span><br><span class="line">syslog facility = local3</span><br><span class="line"><span class="keyword">timeout</span> = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">MODULE</span> OPTIONS</span><br><span class="line">[kksvn]</span><br><span class="line"><span class="keyword">path</span> = /home/svn/rsyncd/kk</span><br><span class="line"><span class="keyword">list</span>=yes</span><br><span class="line"><span class="keyword">ignore</span> <span class="keyword">errors</span></span><br><span class="line">auth <span class="keyword">users</span> = kksvn</span><br><span class="line"><span class="keyword">comment</span> = KK SVN</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>use chroot=no 时，同步后DES的文件主或组如果有，则显示名，即使ID不一样；<br>use chroot=yes时，如果两台机器同名的ID不同，则服务端只会显示SRC的ID，造成权限问题。</p>
</blockquote>
<p>编辑rsync的用户认证配置文件<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># vim /etc/rsyncd/rsyncd.passwd</span></span><br><span class="line">kksvn:kksvn</span><br><span class="line"><span class="preprocessor">#chmod 600 /etc/rsyncd/rsyncd.passwd</span></span><br></pre></td></tr></table></figure></p>
<p>启动服务：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/rsync --daemon --config=/</span>etc<span class="regexp">/rsyncd/</span>rsyncd.conf</span><br><span class="line">echo <span class="string">"/usr/bin/rsync --daemon"</span> &gt;&gt;<span class="regexp">/etc/</span>rc.local</span><br></pre></td></tr></table></figure></p>
<p>注：修改配置文件和用户密码不需要重启服务</p>
<h3 id="客户端测试">客户端测试</h3><p>客户端测试：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># vim /home/svn/rsyncd/conf/rsyncd.passwd</span></span><br><span class="line">kksvn</span><br><span class="line"><span class="preprocessor"># chmod <span class="number">600</span> /home/svn/rsyncd/conf/rsyncd.passwd</span></span><br><span class="line"><span class="preprocessor"># rsync -avzp --progress --delete --exclude=.svn --password-file=/home/svn/rsyncd/conf/rsyncd.passwd kksvn@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>::kksvn /tmp/kk</span></span><br></pre></td></tr></table></figure></p>
<h3 id="SVN配置">SVN配置</h3><p>配置钩子：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/home/</span>svn<span class="regexp">/repos/</span>kk<span class="regexp">/hooks/</span>post-commit</span><br><span class="line">chmod +x <span class="regexp">/home/</span>svn<span class="regexp">/repos/</span>kk<span class="regexp">/hooks/</span>post-commit</span><br></pre></td></tr></table></figure></p>
<p>post-commit内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.UTF-<span class="number">8</span></span><br><span class="line">/usr/bin/svn update /home/svn/rsyncd/kke</span><br><span class="line"><span class="keyword">if</span> [ $? <span class="operator">-eq</span> <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /bin/bash /home/svn/rsyncd/scripts/kke_rsync.sh &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p>kke_rsync.sh内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line">IP=<span class="string">"127.0.0.1"</span></span><br><span class="line">Auth_module=<span class="string">"kksvn"</span></span><br><span class="line">Localdir=<span class="string">"/tmp/kk"</span></span><br><span class="line">Auth_user=<span class="string">"kksvn"</span></span><br><span class="line">Passwd_file=<span class="string">"/home/svn/rsyncd/conf/rsyncd.passwd"</span></span><br><span class="line">Exc=<span class="string">" --exclude=.svn"</span></span><br><span class="line">/usr/bin/rsync -vrtopgl --progress --delete <span class="variable">$&#123;Exc&#125;</span> --password-file=<span class="variable">$&#123;Passwd_file&#125;</span> <span class="variable">$Auth_user</span>@<span class="variable">$&#123;IP&#125;</span>::<span class="variable">$&#123;Auth_module&#125;</span> <span class="variable">$&#123;Localdir&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="拓展">拓展</h2><h3 id="通过exclude排除多个文件/目录">通过exclude排除多个文件/目录</h3><p>使用rsync -av –exclude=.svn /home/hwangjr/t1 /home/hwangjr/t2 只能排除.svn文件/目录。但如果要排除多个文件/目录，就需要新建个exclude.list，然后rsync -av –exclude-from=”exclude.list”指定不需要同步的文件/目录。<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将/home/hwangjr/t1目录拷贝到/home/hwangjr/t2目录下，/home/hwangjr/exclude.list中指定文件不拷贝</span></span><br><span class="line">rsync -av --exclude-from=<span class="regexp">/home/hwangjr</span><span class="regexp">/exclude.list /home</span><span class="regexp">/hwangjr/t</span>1 /home/hwangjr/t2</span><br></pre></td></tr></table></figure></p>
<p>exclude.list里面填写要排除的文件/目录，一行一个，直接写文件名即可。如果要排除a,b.1,b.2,tmp/g，那么exclude.list里就应该写：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">a</span></span><br><span class="line"><span class="regexp">b.*</span></span><br><span class="line">tmp/g</span><br></pre></td></tr></table></figure></p>
<p>不应该写成：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>a</span><br><span class="line"><span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>b.*</span><br><span class="line"><span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>tmp<span class="regexp">/g</span></span><br></pre></td></tr></table></figure></p>
<p>也不应该写成：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>a</span><br><span class="line">.<span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>b.*</span><br><span class="line">.<span class="regexp">/home/</span>hwangjr<span class="regexp">/t1/</span>tmp<span class="regexp">/g</span></span><br></pre></td></tr></table></figure></p>
<p>SO：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">–<span class="keyword">exclude</span>=PATTERN <span class="keyword">exclude</span> files matching PATTERN</span><br><span class="line">–<span class="keyword">exclude</span>-<span class="keyword">from</span>=<span class="keyword">FILE</span> <span class="keyword">read</span> <span class="keyword">exclude</span> patterns <span class="keyword">from</span> <span class="keyword">FILE</span></span><br><span class="line">–<span class="keyword">include</span>=PATTERN don’t <span class="keyword">exclude</span> files matching PATTERN</span><br><span class="line">–<span class="keyword">include</span>-<span class="keyword">from</span>=<span class="keyword">FILE</span> <span class="keyword">read</span> <span class="keyword">include</span> patterns <span class="keyword">from</span> <span class="keyword">FILE</span></span><br></pre></td></tr></table></figure></p>
<h2 id="REF">REF</h2><p><a href="https://download.samba.org/pub/rsync/src/" target="_blank" rel="external">Index of /pub/rsync/src</a><br><a href="https://rsync.samba.org/" target="_blank" rel="external">rsync</a><br><a href="http://pkgs.repoforge.org/rsync/" target="_blank" rel="external">Index of /rsync</a><br><a href="http://segmentfault.com/a/1190000002502991" target="_blank" rel="external">CentOS 6.5下rsync服务器安装配置 - SegmentFault</a><br><a href="http://my.oschina.net/duguaoxue/blog/496228" target="_blank" rel="external">CentOS 6.3下rsync服务器的安装与配置 - longjian的个人页面 - 开源中国社区</a><br><a href="http://wjw7702.blog.51cto.com/5210820/1148808" target="_blank" rel="external">Rsync常见错误及命令详细参数 - 彼岸 - 51CTO技术博客</a><br><a href="http://sndapk.blog.51cto.com/5385144/1360384" target="_blank" rel="external">svn+rsync实时发布程序 - notepad - 51CTO技术博客</a><br><a href="http://www.ttlsa.com/svn/linux-svn-rsync-inotify/" target="_blank" rel="external">linux下svn+rsync+inotify实现代码自动同步 - 运维生存时间</a></p>
]]></content>
    <summary type="html">
    <![CDATA[配置SVN版本控制之后，需要实时发布代码到线上，人懒，故有了此工具。]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[阿里CentOS 6 iptables配置]]></title>
    <link href="https://hwangjr.github.io/2015/10/23/%E9%98%BF%E9%87%8CCentOS-6-iptables%E9%85%8D%E7%BD%AE/"/>
    <id>https://hwangjr.github.io/2015/10/23/阿里CentOS-6-iptables配置/</id>
    <published>2015-10-23T10:31:08.000Z</published>
    <updated>2015-10-23T10:31:31.333Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>就是，配置防火墙，防止被鲁。</p>
<p>iptables的命令格式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables [-t table] <span class="built_in">command</span> [chain] [rules] [-j target]</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>[-t table] ：用来指明使用的表， 有三种选项: filter, nat 和 mangle，如果未指定，则使用filter作为缺省表。 事实上，对于单个服务器的防火墙配置，一般来讲，我们只需要对filter表进行配件就OK了。filter表包括 INPUT, OUTPUT,和FORWARD三个chain.</p>
</li>
<li><p>command 表明iptables命名要做什么，比如</p>
</li>
<li><p>-A （–append): 该命令会把一条规则附件到chain的末尾。</p>
</li>
<li><p>-D（–delete)用来删除某个规则。</p>
</li>
<li><p>-F （–flush) 如果指定了chain, 删除该chain中的所有规则，如果未指定chain, 则删除所有chain中的所有规则。</p>
</li>
<li><p>target: 是由规则指定的操作。 包括下面几种：</p>
</li>
<li><p>ACCEPT: 接收信息包(允许它前往目的地），并且将停止遍历chain.</p>
</li>
<li><p>DROP：  拒绝，</p>
</li>
</ul>
<p>此外还有REJECT, RETURN, LOG, REDIRECT, MARK, MIRROR, MAQUERADE等。</p>
<p>具体的iptables的语法和概念就不再多说了，请参照<a href="http://linux.die.net/man/8/iptables" target="_blank" rel="external">iptables man page</a>官方文档 .</p>
<p>简单来说，iptables防火墙是由一系列的规则(rule)组成，  一个数据请求进来， 会依次和这些规则进行比较，如果正好符合规则的定义，那这个数据请求要么会被接收ACCEPT，要么被拒绝DRIP。如果不符合任何规则的定义，最后缺省的规则会被应用。</p>
<h2 id="配置">配置</h2><p>SSH的端口22自然是需要开放的，否则我们就无法登录服务器了。CentOS的VPS经常作为用LAMP搭建的Web服务器，FTP服务器， Mail服务器等。</p>
<ul>
<li><p>对于Web服务来说，需要开放80端口，如果是HTTPS/SSL协议的话，还需用开放443端口。</p>
</li>
<li><p>对于Mail服务来说，由于涉及SMTP, POP3, IMAP协议，需要开放的端口：SMTP : 25   Secure SMTP:465  POP3: 110   Secure POP3: 995   IMAP: 143   IMAP over SSL: 993。</p>
</li>
<li><p>对于FTP服务来说，需要开放 20, 21两个端口。</p>
</li>
</ul>
<h3 id="屏蔽常见攻击">屏蔽常见攻击</h3><p>缺省情况下，CentOS的iptables的设置是允许任何数据通过的。我们首先要清空iptables中的所有的规则：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></p>
<p>然后我们加上阻止简单扫描和攻击的规则：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP             <span class="comment">#NONE 包(所有标识bit都没有设置)主要是扫描类的数据包</span></span><br><span class="line">iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP     <span class="comment">#防止sync-flood 攻击</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP              <span class="comment">#ALL包（所有的标注bit都被设置了）也是网络扫描的数据包</span></span><br></pre></td></tr></table></figure></p>
<p>关于sync-flood, 请参照<a href="http://en.wikipedia.org/wiki/SYN_flood" target="_blank" rel="external">wikipedia</a>的解释。</p>
<h3 id="相应服务开放端口">相应服务开放端口</h3><p>首先我们应该接受本机localhost的任何请求，否则，数据库连接等将无法工作：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>对于不同的服务需要开放不同的端口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT      <span class="comment"># SSH</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT      <span class="comment"># HTTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">443</span> -j ACCEPT     <span class="comment">#HTTPS</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">25</span> -j ACCEPT   <span class="comment">#SMTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">465</span>  -j ACCEPT <span class="comment">#Secure SMTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">110</span> -j ACCEPT   <span class="comment">#POP3</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">995</span> -j ACCEPT   <span class="comment">#Secure POP3</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">143</span> -j ACCEPT   <span class="comment">#IMAP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">993</span> -j ACCEPT   <span class="comment">#Secure IMAP</span></span><br></pre></td></tr></table></figure></p>
<h3 id="通用规则">通用规则</h3><p>首先要允许所有从服务器端发起的连接，由此返回的响应数据应该是允许的！比如VPS发起的yum update , 必须要允许外部的update数据进来：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -m <span class="keyword">state</span>  --state ESTABLISHED, RELATED -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>最后，设置缺省的策略：屏蔽任何进入的数据请求，允许所有从Server发出的请求<br><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br><span class="line">iptables -<span class="keyword">P</span> INPUT DROP</span><br></pre></td></tr></table></figure></p>
<h3 id="保存设置">保存设置</h3><p>首先通过下面的命令查看一下我们的设置是否正确！<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptable -<span class="keyword">L</span> -<span class="keyword">n</span></span><br></pre></td></tr></table></figure></p>
<p>确认没有问题后，执行下面的命令<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables <span class="keyword">save</span></span><br></pre></td></tr></table></figure></p>
<p>执行上述命令后，相应的规则会写入 /etc/sysconfig/iptables这个文件，你可以检查一下看看。</p>
<p>最后执行<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> iptables restart</span><br></pre></td></tr></table></figure></p>
<p>重新启动iptables防火墙，以使上述设置生效。</p>
<h3 id="自动化">自动化</h3><p>为了更方便的修改和维护自己的iptables的设置，我一般是把所有的iptables的设置先写到一个单独文件中，测试没有问题后。然后再保存到iptable的配置文件中。</p>
<p>放大招，sh配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># A simple iptables firewall configuration</span></span><br><span class="line"></span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin; <span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">#flush/erase original rules</span></span><br><span class="line">iptables -F <span class="comment">#清除所有已制定的rule</span></span><br><span class="line">iptables -X <span class="comment">#清除用户自定义的chain/table</span></span><br><span class="line">iptables -Z <span class="comment">#将所有的chain的计数和流量统计归零</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Accept localhost connetting, no matter what it is</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#Accept any response package which is initiated from inside</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#block most common network attacks(recon packets and syn-flood attack)</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span><br><span class="line">iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#open ports for different services</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT <span class="comment">#SSH</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT <span class="comment">#HTTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 443 -j ACCEPT #HTTPS</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 25 -j ACCEPT #SMTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 465 -j ACCEPT #Secure SMTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 110 -j ACCEPT #POP3</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 995 -j ACCEPT #Secure POP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ICMP configuration</span></span><br><span class="line"><span class="comment">#To prevent ICMP DDOS,we do not allow ICMP type 8(echo-request) or limit this request with 1/second</span></span><br><span class="line"><span class="comment">#some ICMP requests are allowed.</span></span><br><span class="line">icmp_<span class="built_in">type</span>=<span class="string">"0 3 4 11 12 14 16 18"</span></span><br><span class="line"><span class="keyword">for</span> ticmp <span class="keyword">in</span> <span class="variable">$icmp_type</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    iptables -A INPUT -p icmp --icmp-type <span class="variable">$ticmp</span> -j ACCEPT</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p icmp --icmp-type 8 -m limit --limit 1/second -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#default policies</span></span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#save to /etc/sysconfig/iptables</span></span><br><span class="line">/etc/init.d/iptables save</span><br></pre></td></tr></table></figure></p>
<h2 id="常用命令">常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables</span><br><span class="line"><span class="comment"># 检测状态</span></span><br><span class="line">service iptables status</span><br><span class="line">service iptables start</span><br><span class="line"><span class="comment"># 查看当前配置</span></span><br><span class="line">iptables -L -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接受一切请求</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空默认所有规则</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="comment"># 清空自定义所有规则</span></span><br><span class="line">iptables -X</span><br><span class="line"><span class="comment"># 清除计数器</span></span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line">service iptables save</span><br><span class="line">chkconfig iptables on</span><br></pre></td></tr></table></figure>
<h2 id="REF">REF</h2><p><a href="http://www.androiddev.net/centos-6-iptables-firewall/" target="_blank" rel="external">为CentOS 6设置IPTables防火墙 | 码农日记</a></p>
]]></content>
    <summary type="html">
    <![CDATA[在CentOS 6.5服务器上配置iptables。]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Gradle查询/排除依赖]]></title>
    <link href="https://hwangjr.github.io/2015/10/23/Gradle%E6%9F%A5%E8%AF%A2-%E6%8E%92%E9%99%A4%E4%BE%9D%E8%B5%96/"/>
    <id>https://hwangjr.github.io/2015/10/23/Gradle查询-排除依赖/</id>
    <published>2015-10-23T10:29:58.000Z</published>
    <updated>2015-10-23T10:30:16.389Z</updated>
    <content type="html"><![CDATA[<p>使用Gradle编译项目时，可使用此排查依赖包冲突。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看项目库依赖</span></span><br><span class="line">gradle -q dependencies plugin_framework:dependencies —configuration compile</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[在使用Gradle编译项目时，时常遇到引用包冲突，可用此方法来进行排除。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOS6.5 配置Subversion]]></title>
    <link href="https://hwangjr.github.io/2015/10/23/CentOS6-5-%E9%85%8D%E7%BD%AESubversion/"/>
    <id>https://hwangjr.github.io/2015/10/23/CentOS6-5-配置Subversion/</id>
    <published>2015-10-23T10:28:24.000Z</published>
    <updated>2015-10-23T10:28:49.357Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>需要部署Subversion进行版本控制，团队习惯用Subversion，自然Git也有部署，后续慢慢切入。<br>不基于Apache，也就是http无法访问，只通过svn访问。<br>不源码编译，版本兼容会有问题。</p>
<blockquote>
<p>Subversion目录说明：<br><em>dav目录：是提供apache与mod_dav_svn使用的目录，让他们存储内部数据
</em>db目录：就是所有版本控制的数据存放文件<br><em>hooks目录：放置hook脚本文件的目录
</em>locks目录：用来放置subversion锁定数据的目录，追踪存取文件库的客户端<br><em>format文件：是一个文本文件，里面只放了一个整数。表示当前文件库配置的版本号
</em>conf目录：是这个仓库的配置文件（仓库的用户访问账号、权限等）</p>
</blockquote>
<h2 id="安装">安装</h2><p>查询是否已经有安装，并查询安装信息：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询是否安装及版本</span></span><br><span class="line">rpm -qa subversion</span><br><span class="line"><span class="comment"># 移除</span></span><br><span class="line">yum remove subversion</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install subversion</span><br><span class="line"><span class="comment"># 查询安装目录</span></span><br><span class="line">rpm -ql subversion</span><br></pre></td></tr></table></figure></p>
<h2 id="基本配置">基本配置</h2><p>本次配置将针对多个版本库，其访问统一为：<code>svn://ip/project1</code>，可在下面分别创建多个库。</p>
<h3 id="创建svn库并初始化">创建svn库并初始化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建版本库路径</span></span><br><span class="line">mkdir -p /home/svn/repos/project1</span><br><span class="line"><span class="comment"># 新建一个版本仓库</span></span><br><span class="line">svnadmin create /home/svn/repos/project1</span><br><span class="line"><span class="comment"># 初始化版本库中目录</span></span><br><span class="line">mkdir project project/server project/server/branches project/server/tags project/server/trunk project/android project/android/branches project/android/tags project/android/trunk project/ios project/ios/branches project/ios/tags project/ios/trunk</span><br><span class="line">svn import project/ file:///home/svn/repos/project1 -m <span class="string">'init svn folder'</span></span><br><span class="line"><span class="comment"># 可删除临时创建文件，或者保留以后创建其他版本库继续使用</span></span><br><span class="line">rm -rf project</span><br><span class="line"><span class="comment"># 保留以后继续使用</span></span><br><span class="line">mv project /home/svn/projectTemp</span><br></pre></td></tr></table></figure>
<p>其中project目录为：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">project</span>/</span><br><span class="line">├── <span class="keyword">android</span><br><span class="line"></span>│   ├── <span class="keyword">branches</span><br><span class="line"></span>│   ├── tags</span><br><span class="line">│   └── trunk</span><br><span class="line">├── ios</span><br><span class="line">│   ├── <span class="keyword">branches</span><br><span class="line"></span>│   ├── tags</span><br><span class="line">│   └── trunk</span><br><span class="line">└── server</span><br><span class="line">    ├── <span class="keyword">branches</span><br><span class="line"></span>    ├── tags</span><br><span class="line">    └── trunk</span><br></pre></td></tr></table></figure></p>
<p><code>/home/svn/repos</code>目录为：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/home/svn/repos/</span><br><span class="line">└── project1</span><br><span class="line">    ├── <span class="keyword">conf</span></span><br><span class="line">    ├── <span class="keyword">db</span></span><br><span class="line">    ├── <span class="keyword">format</span></span><br><span class="line">    ├── hooks</span><br><span class="line">    ├── locks</span><br><span class="line">    └── README.txt</span><br></pre></td></tr></table></figure></p>
<h3 id="配置svn">配置svn</h3><p>版本库用户统一管理，故这里会直接在<code>/home/svn</code>目录创建<code>conf</code>文件并保存其配置。<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建配置目录</span></span><br><span class="line"><span class="keyword">mkdir</span> /home/svn/conf</span><br></pre></td></tr></table></figure></p>
<h4 id="配置用户">配置用户</h4><p>移动用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /home/svn/repos/project1/conf/passwd /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/passwd</span><br></pre></td></tr></table></figure></p>
<p>修改里面用户，格式<code>username = passwd</code>的条目即可。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[users]</span></span><br><span class="line"><span class="setting">hwangjr = <span class="value">hwangjr</span></span></span><br></pre></td></tr></table></figure></p>
<h4 id="修改访问策略">修改访问策略</h4><p>移动用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /home/svn/repos/project1/conf/authz /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/authz</span><br></pre></td></tr></table></figure></p>
<p>修改里面配置，<code>groups</code>为定义用户群组，其他为配置访问权限，<strong>需要注意是<code>* =</code>表示除了上面配置的用户组之外，任何人都被禁止访问本目录，此必须加上</strong>。<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[groups]</span></span><br><span class="line">dev = hwangjr</span><br><span class="line"></span><br><span class="line"><span class="string">[project1:/]</span></span><br><span class="line">@dev = rw</span><br><span class="line">* =</span><br></pre></td></tr></table></figure></p>
<h4 id="修改svnserve，让配置生效">修改svnserve，让配置生效</h4><p>拷贝用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /home/svn/repos/project1/conf/svnserve.conf /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/svnserve.conf</span><br></pre></td></tr></table></figure></p>
<p>修改里面配置。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = <span class="keyword">write</span></span><br><span class="line">password-db = <span class="regexp">/home/</span>svn<span class="regexp">/conf/</span>passwd</span><br><span class="line">authz-db = <span class="regexp">/home/</span>svn<span class="regexp">/conf/</span>authz</span><br></pre></td></tr></table></figure></p>
<h4 id="启动/停止svn">启动/停止svn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svnserve <span class="operator">-d</span> -r /home/svn/repos</span><br><span class="line"><span class="comment"># 指定port</span></span><br><span class="line">svnserve <span class="operator">-d</span> -r /home/svn/repos --listen-port <span class="number">3391</span></span><br><span class="line"><span class="comment"># 停止svn</span></span><br><span class="line">killall svnserve</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">ps -ef | grep svnserve</span><br><span class="line"><span class="built_in">kill</span> -<span class="number">9</span> pid</span><br><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -tlnp | grep svn</span><br></pre></td></tr></table></figure>
<h3 id="测试访问">测试访问</h3><p>本地测试即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn co svn://<span class="number">127.0</span>.<span class="number">0.1</span>/project1 --username hwangjr --password hwangjr</span><br></pre></td></tr></table></figure></p>
<h3 id="新增一个版本库">新增一个版本库</h3><p>本次配置可管理多个版本库，且用户共用，新增一个版本库很简单：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/svn/repos/project2</span><br><span class="line">svnadmin create /home/svn/repos/project2</span><br><span class="line">rm -rf /home/svn/repos/project2/conf/passwd /home/svn/repos/project2/conf/authz</span><br><span class="line">cp /home/svn/conf/svnserve.conf /home/svn/repos/project2/conf/</span><br></pre></td></tr></table></figure></p>
<p>此版本库已经新增完毕，如果需要初始化目录，则可采用上面方式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn import /home/svn/projectTemp/  file:///home/svn/repos/project2 -m <span class="string">'init svn folder'</span></span><br></pre></td></tr></table></figure></p>
<p>可编辑<code>/home/svn/conf/passwd</code>来新增/删除用户，可编辑<code>/home/svn/conf/authz</code>来控制权限。举个authz栗子：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[project1:/]</span><br><span class="line"><span class="comment">@dev = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br><span class="line"></span><br><span class="line">[project2:/]</span><br><span class="line"><span class="comment">@dev = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br></pre></td></tr></table></figure></p>
<h3 id="自启动">自启动</h3><p>通过服务来启动即可，编辑<code>vim /etc/init.d/svnserve</code>，修改OPTIONS为<code>-r /home/svn/repos</code>，片段为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### <span class="operator"><span class="keyword">END</span> INIT INFO</span><br><span class="line"></span><br><span class="line">OPTIONS=<span class="string">"-r /home/svn/repos"</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">Source</span> <span class="keyword">function</span> <span class="keyword">library</span>.</span><br><span class="line">. /etc/rc.<span class="keyword">d</span>/init.<span class="keyword">d</span>/functions</span></span><br></pre></td></tr></table></figure></p>
<p>设置服务自启动：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig svnserve on</span><br></pre></td></tr></table></figure></p>
<h3 id="防火墙">防火墙</h3><p>如果对防火墙有疑问，可以参考另一篇iptables，开放所需端口即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -tlnp | grep svn</span><br><span class="line"><span class="comment"># 开放端口</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">3690</span> -j ACCEPT <span class="comment"># SVN</span></span><br><span class="line">/etc/init.d/iptables save</span><br></pre></td></tr></table></figure></p>
<p>或者编辑配置文件：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"><span class="constant">A</span> <span class="constant">INPUT</span> -p tcp -m tcp --dport <span class="number">3690</span> -j <span class="constant">ACCEPT</span></span><br><span class="line"></span>service iptables restart</span><br></pre></td></tr></table></figure></p>
<h2 id="常用配置">常用配置</h2><h3 id="强制提交写LOG">强制提交写LOG</h3><p>配置pre-comit文件，要求用户提交前必须写LOG。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/repos/project1/hooks</span><br><span class="line"><span class="keyword">vim</span> <span class="keyword">pre</span>-commit</span><br><span class="line">chmod +<span class="keyword">x</span> <span class="keyword">pre</span>-commit</span><br></pre></td></tr></table></figure></p>
<p>pre-commit文件内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">TXN=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">SVNLOOK=/usr/bin/svnlook</span><br><span class="line">LOGMSG=`<span class="variable">$SVNLOOK</span> <span class="built_in">log</span> -t <span class="string">"<span class="variable">$TXN</span>"</span> <span class="string">"<span class="variable">$REPOS</span>"</span> | grep <span class="string">"[a-zA-Z0-9]"</span> | wc -c`</span><br><span class="line"><span class="comment"># 5(要求的LOG长度，依实际需要修改)</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$LOGMSG</span>"</span> <span class="operator">-lt</span> <span class="number">5</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">"\nEmpty log message not allowed. Commit aborted!"</span> <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<h3 id="可修改LOG">可修改LOG</h3><p>配置pre-revprop-change文件，此文件在show log中修改log时会运行，得到修改的权限，否则会报错：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DAV request failed; it’s possible that the repository’s pre-revprop-<span class="operator"><span class="keyword">change</span> hook either <span class="keyword">failed</span> <span class="keyword">or</span> <span class="keyword">is</span> non-existent. <span class="keyword">At</span> <span class="keyword">least</span> one property <span class="keyword">change</span> <span class="keyword">failed</span>;</span> repository is unchanged</span><br></pre></td></tr></table></figure></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/repos/project1/hooks/</span><br><span class="line"><span class="keyword">vim</span> <span class="keyword">pre</span>-revprop-<span class="keyword">change</span></span><br><span class="line">chmod +<span class="keyword">x</span> <span class="keyword">pre</span>-revprop-<span class="keyword">change</span></span><br></pre></td></tr></table></figure>
<p>文件内容如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">USER=<span class="string">"<span class="variable">$3</span>"</span></span><br><span class="line">PROPNAME=<span class="string">"<span class="variable">$4</span>"</span></span><br><span class="line"><span class="keyword">if</span> [<span class="string">"<span class="variable">$PROPNAME</span>"</span> = <span class="string">"svn:log"</span>];<span class="keyword">then</span> <span class="built_in">exit</span> <span class="number">0</span>;<span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="HTTP服务器（未进行验证_）">HTTP服务器（未进行验证 ）</h2><h3 id="转换密码">转换密码</h3><p>HTTP不支持明文，Perl脚本来进行转化密码，脚本目录下会多一个<code>webpasswd</code>文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/svn/conf/</span><br><span class="line">vim ptopw.pl</span><br><span class="line">chmod +x ptopw.pl</span><br><span class="line">./ptopw.pl</span><br></pre></td></tr></table></figure></p>
<p>脚本内容：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"></span><br><span class="line"><span class="comment">#open the svn passwd file</span></span><br><span class="line"><span class="keyword">open</span> (FILE, <span class="string">"../conf/passwd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the passwd file!!!\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#clear the apache passwd file</span></span><br><span class="line"><span class="keyword">open</span> (OUT_FILE, <span class="string">"&gt;webpasswd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the webpasswd file!!!\n"</span>);</span><br><span class="line"><span class="keyword">close</span> (OUT_FILE);</span><br><span class="line"></span><br><span class="line"><span class="comment">#begin</span></span><br><span class="line"><span class="keyword">foreach</span> (&lt;FILE&gt;) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_</span> =~ <span class="regexp">m/^[^#].*=/</span>) &#123;</span><br><span class="line"><span class="variable">$_</span> =~ <span class="regexp">s/=//</span>;</span><br><span class="line"><span class="string">`htpasswd -b webpasswd $_`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="修改httpd配置">修改httpd配置</h3><p>编辑<code>/etc/httpd/conf/httpd.conf</code>，在末尾添加svn：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Location /repos&gt;</span><br><span class="line">DAV svn</span><br><span class="line">SVNPath /home/svn/repos/</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName <span class="string">"svn for repos"</span></span><br><span class="line">AuthUserFile /home/svn/conf/webpasswd</span><br><span class="line">AuthzSVNAccessFile /home/svn/conf/authz</span><br><span class="line">Satisfy all</span><br><span class="line">Require valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="修改权限">修改权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R apache.apache /home/svn/repos</span><br></pre></td></tr></table></figure>
<h3 id="重启服务">重启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/httpd restart</span><br></pre></td></tr></table></figure>
<h3 id="测试">测试</h3><p>浏览器打开<code>http://ip/repos/server</code>测试。</p>
<h2 id="邮件提醒（未验证）">邮件提醒（未验证）</h2><ul>
<li><p>安装Perl模块Module::Build</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/D/DA/DAGOLDEN/Module-Build-0.36_11.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Module-Build-0.36_11.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Module-Build-0.36_11</span></span><br><span class="line"><span class="preprocessor"># perl Build.PL</span></span><br><span class="line"><span class="preprocessor"># ./Build</span></span><br><span class="line"><span class="preprocessor"># ./Build test</span></span><br><span class="line"><span class="preprocessor"># ./Build install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块Authen::SASL</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/G/GB/GBARR/Authen-SASL-2.15.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Authen-SASL-2.15.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Authen-SASL-2.15</span></span><br><span class="line"><span class="preprocessor"># perl Makefile.PL</span></span><br><span class="line"><span class="preprocessor"># make test</span></span><br><span class="line"><span class="preprocessor"># make install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块Net::SMTP_auth</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/A/AP/APLEINER/Net-SMTP_auth-0.08.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Net-SMTP_auth-0.08.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Net-SMTP_auth-0.08</span></span><br><span class="line"><span class="preprocessor"># perl Makefile.PL</span></span><br><span class="line"><span class="preprocessor"># make test</span></span><br><span class="line"><span class="preprocessor"># make install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块SVN::Notify</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/D/DW/DWHEELER/SVN-Notify-2.80.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf SVN-Notify-2.80.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd SVN-Notify-2.80</span></span><br><span class="line"><span class="preprocessor"># perl Build.PL</span></span><br><span class="line"><span class="preprocessor"># ./Build</span></span><br><span class="line"><span class="preprocessor"># ./Build test</span></span><br><span class="line"><span class="preprocessor"># ./Build install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动邮件服务器</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service sendmail restart</span></span><br><span class="line"><span class="keyword">Shutting</span> down sendmail:                                   <span class="sqbracket"> [FAILED]</span></span><br><span class="line"><span class="keyword">Starting</span> sendmail:                                        <span class="sqbracket"> [  OK  ]</span></span><br><span class="line"><span class="keyword">Starting</span> sm-client:                                       <span class="sqbracket"> [  OK  ]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置自动发邮件脚本<br>修改post-commit脚本，以支持邮件通知功能。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># cd /home/svn/repos/project1/hooks/</span></span><br><span class="line"><span class="preprocessor"># vim post-commit</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>内容如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line"></span><br><span class="line">/usr/bin/svnnotify –repos-path “<span class="variable">$1</span>″ –revision “<span class="variable">$2</span>″ –to huangjianrong2010@gmail.com –from project1@svn.com –handler “HTML::ColorDiff”  –with-diff –smtp localhost –smtp-user root –smtp-pass passwd -c “UTF-<span class="number">8</span>″ -g zh_CN -o raw –svnlook /usr/bin/svnlook –subject-prefix ‘[SVN Update]‘</span><br></pre></td></tr></table></figure></p>
<p>to参数代表接收邮件的地址，可以有多个。from参数是虚拟的，代表你的发送地址，一般情况下，这个参数 不重要，但如果接收者的邮件服务器有反垃圾邮件的功能，需要判定源地址的话，这个参数是否合法就显得很重要了</p>
<p>再给该脚本添加可执行权限<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># chmod +x post-commit</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>再次提交时，就会给指定邮件地址发信了。ALL DONE！</li>
</ul>
<h2 id="备份管理">备份管理</h2><p>采用简单方式，定时备份仓库目录。</p>
<ul>
<li><p>新建备份目录</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /home/svn/backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写备份脚本</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/scripts</span><br><span class="line"><span class="keyword">vim</span> backup.<span class="keyword">sh</span></span><br><span class="line">chmod +<span class="keyword">x</span> backup.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>backup.sh内容：<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cd /home/svn/repos</span><br><span class="line">now=`/bin/date +%Y%m%d`</span><br><span class="line">/bin/tar czvf <span class="string">"project_backup_$now.tar.gz"</span> project1/ &amp;&amp; rm -rf /home/svn/backup/* &amp;&amp; /bin/mv project_backup_*.tar.gz /home/svn/backup/</span><br><span class="line"><span class="keyword">if</span> [ $? == <span class="number">0</span> ]</span><br><span class="line">then</span><br><span class="line"><span class="literal">result</span>=”<span class="type">OK</span>!!”</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="literal">result</span>=”<span class="type">False</span>!!”</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">#send mail to administrator</span></span><br><span class="line">/bin/mail mail@gmail.com -s “project_backup_$now” &lt;&lt;<span class="type">MESSAGE</span></span><br><span class="line"><span class="type">Result</span>: `/bin/echo $<span class="literal">result</span>`</span><br><span class="line"><span class="type">MESSAGE</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>设置每日执行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab <span class="operator">-e</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输入：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 每晚<span class="number">23</span>点备份</span></span><br><span class="line"><span class="number">0</span> <span class="number">23</span> * * * /home/svn/scripts/backup.sh</span><br></pre></td></tr></table></figure></p>
<h2 id="svnstat分析svn数据（未验证）">svnstat分析svn数据（未验证）</h2><ul>
<li><p>安装JAVA</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x jre-xxx-rpm<span class="class">.bin</span></span><br><span class="line">./jre-xxx-rpm.bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载svnstat</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">http:</span>/<span class="regexp">/iweb.dl.sourceforge.net/project</span><span class="regexp">/svnstat/svnstat</span><span class="regexp">/Release-1.1-beta/</span><span class="constant">SvnStat</span>-<span class="number">1.1</span>-beta.zip</span><br><span class="line">unzip <span class="constant">SvnStat</span>-<span class="number">1.1</span>-beta.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新代码</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn co <span class="string">svn:</span><span class="comment">//ip/project1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成数据</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pwd</span></span><br><span class="line"># /root</span><br><span class="line">svn <span class="keyword">log</span> project1 -v -xml -non-interactive &gt; project1.<span class="literal">log</span></span><br><span class="line"><span class="keyword">cd</span> SvnStat-1.1-beta</span><br><span class="line">java -classpath SvnStat-all.jar <span class="keyword">de</span>.agentlab.svnstat.SvnStat -jar SvnStat-all.jar -r /root/project.<span class="keyword">log</span> -<span class="keyword">d</span> /<span class="keyword">var</span>/www/html/</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<br>打开浏览器即可查看</p>
</li>
</ul>
<h2 id="statsvn分析svn数据（未验证）">statsvn分析svn数据（未验证）</h2><ul>
<li><p>下载statsvn</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//downloads.sourceforge.net/project/statsvn/statsvn/0.7.0/statsvn-0.7.0.zip?use_mirror=jaist</span></span><br><span class="line">unzip statsvn-<span class="number">0.7</span><span class="number">.0</span>.zip</span><br><span class="line">cd statsvn-<span class="number">0.7</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成statsvn数据</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="regexp">/var/</span>www<span class="regexp">/html/</span>statsvn</span><br><span class="line">java -jar statsvn.jar -verbose -output-dir <span class="regexp">/var/</span>www<span class="regexp">/html/</span>statsvn<span class="regexp">/ /</span>root<span class="regexp">/project.log /</span>root<span class="regexp">/project</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<br>打开浏览器查看</p>
</li>
</ul>
<h2 id="配置codestriker（未验证）">配置codestriker（未验证）</h2><ul>
<li><p>依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MCPAN <span class="operator">-e</span> <span class="string">'install "Template"'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>下载</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http:<span class="comment">//downloads.sourceforge.net/project/codestriker/codestriker/1.9.10/codestriker-1.9.10.tar.gz?use_mirror=jaist&amp;ts=1279246587</span></span></span><br><span class="line"><span class="preprocessor"># mkdir /var/www/codestriker</span></span><br><span class="line"><span class="preprocessor"># cd /var/www/codestriker</span></span><br><span class="line"><span class="preprocessor"># tar xvf /path/codestriker-<span class="number">1.9</span><span class="number">.10</span>.tar.gz</span></span><br><span class="line"><span class="preprocessor"># chown -R apache.apache codestriker-<span class="number">1.9</span><span class="number">.10</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据库</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># service mysqld restart</span></span><br><span class="line"><span class="preprocessor"># mysql -uroot mysql</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>执行:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> codestrikerdb <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span></span><br><span class="line"><span class="operator"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">INSERT</span>,<span class="keyword">UPDATE</span>,<span class="keyword">DELETE</span>,<span class="keyword">INDEX</span>,<span class="keyword">ALTER</span>,<span class="keyword">CREATE</span>,<span class="keyword">DROP</span>,<span class="keyword">REFERENCES</span> <span class="keyword">ON</span> codestrikerdb.* <span class="keyword">TO</span> codestriker@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> ‘cspasswd’;</span></span><br><span class="line"><span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure></p>
<ul>
<li>配置codestriker<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># cd codestriker-<span class="number">1.9</span><span class="number">.10</span>/</span></span><br><span class="line"><span class="preprocessor"># vim codestriker.conf</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意以下几点(详细可查看codestriker的安装文档)<br>a.数据库的用户名密码要配对<br>b.svn的数据仓库要配对，如下：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@valid</span>_repositories =</span><br><span class="line">(</span><br><span class="line"><span class="symbol">'svn</span>:file:<span class="comment">///home/svn/repos/project1',</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>执行安装脚本</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> bin/</span><br><span class="line">./install.<span class="keyword">pl</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置http支持</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">vim</span> /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在最后面加上如下内容:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Alias <span class="regexp">/codestriker/</span>  <span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/cgi-bin/</span></span><br><span class="line">Alias <span class="regexp">/codestrikerhtml/</span>  <span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/html/</span></span><br><span class="line"></span><br><span class="line">&lt;Directory “<span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/cgi-bin/</span>”&gt;</span><br><span class="line">SetHandler perl-script</span><br><span class="line">PerlHandler <span class="string">ModPerl:</span>:Registry</span><br><span class="line">Options +ExecCGI</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory “<span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/html/</span>”&gt;</span><br><span class="line">AllowOverride None</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>查看<br>重启httpd服务：<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> httpd restart</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>浏览器输入<code>http://ip/codestriker/codestriker.pl</code>。</p>
<h2 id="REFS">REFS</h2><p><a href="http://www.ha97.com/4467.html" target="_blank" rel="external">CentOS Linux搭建SVN Server配置详解</a><br><a href="http://www.hi-docs.com/article/detail-MTA4.html" target="_blank" rel="external">Centos 6.5+ 搭建SVN服务器（实用简写版）-LINUX技术文章,经验分享,HI-DOCS</a></p>
]]></content>
    <summary type="html">
    <![CDATA[在CentOS 6.5服务器上部署配置Subversion。]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Supervisor Basic Usage]]></title>
    <link href="https://hwangjr.github.io/2015/10/09/Supervisor-Basic-Usage/"/>
    <id>https://hwangjr.github.io/2015/10/09/Supervisor-Basic-Usage/</id>
    <published>2015-10-09T06:38:05.000Z</published>
    <updated>2015-10-09T06:38:44.370Z</updated>
    <content type="html"><![CDATA[<p><a href="http://supervisord.org/" target="_blank" rel="external">Supervisor</a> is a process control system, it is a client/server system that allows its users to monitor and control a number of processes on UNIX-like operating systems.</p>
<p>It shares some of the same goals of programs like <a href="http://supervisord.org/glossary.html#term-launchd" target="_blank" rel="external">launchd</a>, <a href="http://supervisord.org/glossary.html#term-daemontools" target="_blank" rel="external">daemontools</a>, and <a href="http://supervisord.org/glossary.html#term-runit" target="_blank" rel="external">runit</a>. Unlike some of these programs, it is not meant to be run as a substitute for init as “process id 1”. Instead it is meant to be used to control processes related to a project or a customer, and is meant to start like any other program at boot time.</p>
<h2 id="Install">Install</h2><p>Sample for centos:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Maybe u need to install python-setuptools or pip</span></span><br><span class="line"><span class="comment">## yum install python-setuptools &amp;&amp; easy_install pip</span></span><br><span class="line">easy_install supervisor</span><br><span class="line"><span class="comment">## or </span></span><br><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure></p>
<h2 id="Commands">Commands</h2><p>This is some common commands:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for all service</span></span><br><span class="line">supervisorctl start all</span><br><span class="line">supervisorctl stop all</span><br><span class="line">supervisorctl restart all</span><br><span class="line"></span><br><span class="line"><span class="comment"># for service 'ss'</span></span><br><span class="line">supervisorctl stop ss</span><br><span class="line">supervisorctl start ss</span><br><span class="line">supervisorctl restart ss</span><br></pre></td></tr></table></figure></p>
<h2 id="Usage">Usage</h2><p><strong>STEP 1: Init the config file </strong></p>
<p>First of all, we need a config file, supervisor provider us a sample:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## This will create a supervisord.conf file under /etc folder</span></span><br><span class="line"><span class="built_in">echo</span>_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p>
<p><strong>STEP 2: Setup config </strong></p>
<p>Second, we need to config the file, add the code below to the end of conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if this config is not correct, it may occur supervisor start fail</span></span><br><span class="line">[program:ss]</span><br><span class="line"><span class="built_in">command</span> = ssserver -c /etc/ss.json</span><br><span class="line">user = root</span><br><span class="line">autostart = <span class="literal">true</span></span><br><span class="line">autorestart = <span class="literal">true</span></span><br><span class="line">stderr_logfile = /var/<span class="built_in">log</span>/supervisor/ss.stderr.log</span><br><span class="line">stdout_logfile = /var/<span class="built_in">log</span>/supervisor/ss.stdout.log</span><br></pre></td></tr></table></figure></p>
<p>More info see : <a href="http://supervisord.org/configuration.html#programx-section" target="_blank" rel="external">Configuration File — Supervisor 3.1.3 documentation</a></p>
<p><strong>STEP 3: Run Supervisor</strong></p>
<p>Finally, run the supervisor:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># run supervisor with conf file</span></span><br><span class="line">supervisord -c /etc/supervisord.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># run without conf file, will search for the default conf file by:</span></span><br><span class="line"><span class="comment"># $CWD/supervisord.conf</span></span><br><span class="line"><span class="comment"># $CWD/etc/supervisord.conf</span></span><br><span class="line"><span class="comment"># /etc/supervisord.conf</span></span><br><span class="line">supervisord</span><br></pre></td></tr></table></figure></p>
<p>If we modify the conf file, we also can update the conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl update</span><br></pre></td></tr></table></figure></p>
<h2 id="Run_on_startup">Run on startup</h2><p>If you are using a distribution-packaged version of Supervisor, it should already be integrated into the service management infrastructure of your distribution.</p>
<p>There are user-contributed scripts for various operating systems at: <a href="https://github.com/Supervisor/initscripts" target="_blank" rel="external">Supervisor/initscripts</a></p>
<p>OR :<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># add this before exit</span></span><br><span class="line">supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p>
<h2 id="Manage_on_web">Manage on web</h2><p>U can manage the service remote, just modify the conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9001</span>        ; (ip_address:port specifier, *:port <span class="keyword">for</span> all iface)</span><br><span class="line">username=user              ; (default is no username (open server))</span><br><span class="line">password=<span class="number">123</span>               ; (default is no password (open server))</span><br></pre></td></tr></table></figure></p>
<p>and reload conf:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl reload</span><br></pre></td></tr></table></figure></p>
<h2 id="END">END</h2><p>Just so easy, Supervisor is very fantastic, enjoy it.</p>
]]></content>
    <summary type="html">
    <![CDATA[Introduction about supervisor.]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[将SOCKET代理转化为HTTP代理]]></title>
    <link href="https://hwangjr.github.io/2015/08/21/%E5%B0%86SOCKET%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8C%96%E4%B8%BAHTTP%E4%BB%A3%E7%90%86/"/>
    <id>https://hwangjr.github.io/2015/08/21/将SOCKET代理转化为HTTP代理/</id>
    <published>2015-08-21T07:39:01.000Z</published>
    <updated>2015-08-21T07:39:25.302Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>众所周知，中国伟大的墙阻碍了很多前进的脚步，特别是ANDROID SDK的更新（node啥的都不说了）。特别是最近管控比较严，就只能使用朋友的SOCKET5的服务器代理，而ANDROID SDK是无法使用SOCKET5代理，只支持HTTP代理，类似<a href="http://www.androiddevtools.cn/" target="_blank" rel="external">AndroidDevTools</a>的站点也不是很好使了，只能寻找SOCKET5转换成HTTP的方式。</p>
<h2 id="SOCKET转HTTP">SOCKET转HTTP</h2><h3 id="DeleGate介绍">DeleGate介绍</h3><p>这里要使用到<a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>软件，支持各个平台。<br><a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>是一个多平台的简单代理服务器软件，通过本地建立各种代理服务器，包括HTTP，FTP，SOCKET等。</p>
<blockquote>
<p>This is a private and voluntary site that is independent of AIST, for providing support information and redistribution of DeleGate, a general purpose proxy server software developed in AIST and, more specifically, for providing voluntary-based support for users in forums, supplementary contents for guide, some experimental services and demonstrations, as well as contents mirroring some of those in the official site of DeleGate of AIST. </p>
</blockquote>
<h3 id="安装软件">安装软件</h3><p>新版没有找到源码，但是<a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>提供了编译之后的可执行程序。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://delegate.hpcc.jp/pub/DeleGate/bin/linux/<span class="number">9.9</span>.<span class="number">13</span>/linux2.<span class="number">6</span>-dg9_9_13.tar.gz</span><br><span class="line">tar xzf linux2.<span class="number">6</span>-dg9_9_13.tar.gz</span><br><span class="line"><span class="built_in">cd</span> dg9_9_13</span><br><span class="line">tree .</span><br></pre></td></tr></table></figure></p>
<p>在bin目录下就是可执行程序和配置文件，整个文件目录很简洁，在subin里面也提供了setup-subin.sh脚本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bin</span><br><span class="line">│   ├── dg9_9_13</span><br><span class="line">│   ├── dg9_9_13.conf</span><br><span class="line">subin</span><br><span class="line">│   ├── dgbind</span><br><span class="line">│   ├── dgchroot</span><br><span class="line">│   ├── dgcpnod</span><br><span class="line">│   ├── dgdate</span><br><span class="line">│   ├── dgforkpty</span><br><span class="line">│   ├── dgpam</span><br><span class="line">│   └── setup-subin.sh</span><br></pre></td></tr></table></figure></p>
<p>setup-subin.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line">SUBINS=<span class="string">"dgpam dgbind dgchroot dgcpnod"</span></span><br><span class="line">sudo sh -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">  su root -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">  su root -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">ls <span class="operator">-l</span> <span class="variable">$SUBINS</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用">使用</h3><p>使用方式也很简单，通过编辑bin目录下的conf文件来完成，这里以SOCKET转HTTP为例，具体需求自己查看配置文件。<br>编辑dg9_9_13.conf，新增：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mail-address of the administrator of this DeleGat</span></span><br><span class="line">ADMIN=email@email.com</span><br><span class="line"><span class="comment"># the protocol DeleGate speaks with its clients</span></span><br><span class="line">SERVER=http</span><br><span class="line"><span class="comment"># the entrance port on which DeleGate waits clients</span></span><br><span class="line">-P8080</span><br><span class="line"><span class="comment"># forwarding to a SOCKS server</span></span><br><span class="line">SOCKS=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure></p>
<p>配置完成后，直接执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./dg9_9_13</span><br><span class="line"><span class="comment"># 如果没有权限，给权限即可</span></span><br><span class="line">sudo chmod +x dg9_9_13</span><br></pre></td></tr></table></figure></p>
<p>查看是否在运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep dg9</span><br><span class="line">hwangjr   <span class="number">4595</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">53340</span>  <span class="number">3436</span> ?        Ss   <span class="number">11</span>:<span class="number">10</span>   <span class="number">0</span>:<span class="number">00</span> ./dg9_9_13 -&#123;<span class="number">000</span>&#125;[RPM=<span class="number">0.00</span>(<span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>),IDLE=<span class="number">15</span>s]-P8080 -- --------------------</span><br><span class="line">hwangjr   <span class="number">4601</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">15952</span>   <span class="number">940</span> pts/<span class="number">14</span>   S+   <span class="number">11</span>:<span class="number">10</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto dg9</span><br></pre></td></tr></table></figure></p>
<p>停止运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./dg9_9_13 -P8080 -F<span class="built_in">kill</span></span><br><span class="line"><span class="comment"># 暴力</span></span><br><span class="line"><span class="built_in">kill</span> -<span class="number">9</span> <span class="number">4595</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置ANDROID_SDK">配置ANDROID SDK</h3><p>回到我们的场景，配置ANDROID SDK，基本按照我们的思路，直接配置本地的路由和端口即可。<br>打开ANDROID SDK，Tools -&gt; Options，配置HTTP PROXY SERVER为：127.0.0.1，端口为8080，然后即可畅游谷歌网络。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">12</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52791</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">15</span> INFO     connecting dl-ssl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52796</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">17</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52799</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52809</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">18</span>:<span class="number">57</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52821</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">02</span> INFO     connecting ssl.google-analytics.com:<span class="number">443</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52962</span></span><br></pre></td></tr></table></figure></p>
<h3 id="ShadowSocks">ShadowSocks</h3><p>顺带简单介绍下<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">shadowsocks/shadowsocks</a>，其功能在官网已经介绍：</p>
<blockquote>
<p>A fast tunnel proxy that helps you bypass firewalls.<br>Features:<br>TCP &amp; UDP support<br>User management API<br>TCP Fast Open<br>Workers and graceful restart<br>Destination IP blacklist</p>
</blockquote>
<p>安装（ubuntu）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">usage: sslocal [OPTION]...</span><br><span class="line">A fast tunnel proxy that helps you bypass firewalls.</span><br><span class="line"></span><br><span class="line">You can supply configurations via either config file or <span class="built_in">command</span> line arguments.</span><br><span class="line"></span><br><span class="line">Proxy options:</span><br><span class="line">  -c CONFIG              path to config file</span><br><span class="line">  <span class="operator">-s</span> SERVER_ADDR         server address</span><br><span class="line">  -p SERVER_PORT         server port, default: <span class="number">8388</span></span><br><span class="line">  -b LOCAL_ADDR          <span class="built_in">local</span> binding address, default: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">  <span class="operator">-l</span> LOCAL_PORT          <span class="built_in">local</span> port, default: <span class="number">1080</span></span><br><span class="line">  -k PASSWORD            password</span><br><span class="line">  -m METHOD              encryption method, default: aes-<span class="number">256</span>-cfb</span><br><span class="line">  -t TIMEOUT             timeout <span class="keyword">in</span> seconds, default: <span class="number">300</span></span><br><span class="line">  --fast-open            use TCP_FASTOPEN, requires Linux <span class="number">3.7</span>+</span><br><span class="line"></span><br><span class="line">General options:</span><br><span class="line">  -h, --help             show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">  <span class="operator">-d</span> start/stop/restart  daemon mode</span><br><span class="line">  --pid-file PID_FILE    pid file <span class="keyword">for</span> daemon mode</span><br><span class="line">  --log-file LOG_FILE    <span class="built_in">log</span> file <span class="keyword">for</span> daemon mode</span><br><span class="line">  --user USER            username to run as</span><br><span class="line">  -v, -vv                verbose mode</span><br><span class="line">  -q, -qq                quiet mode, only show warnings/errors</span><br><span class="line">  --version              show version information</span><br><span class="line"></span><br><span class="line">Online <span class="built_in">help</span>: &lt;https://github.com/shadowsocks/shadowsocks&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">sudo sslocal <span class="operator">-s</span> SERVER_ADDR -p SERVER_PORT -b LOCAL_ADDR <span class="operator">-l</span> LOCAL_PORT -k PASSWORD -m METHOD</span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG</span></span><br><span class="line">sudo less /var/<span class="built_in">log</span>/shadowsocks.log</span><br></pre></td></tr></table></figure>
<p>更多详细可以参考文档<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">shadowsocks/shadowsocks</a>。</p>
<h2 id="总结">总结</h2><p>伟大的墙。</p>
<h2 id="REF">REF</h2><p><a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a><br><a href="http://www.delegate.org/documents/" target="_blank" rel="external">Documents on DeleGate</a><br><a href="ftp://ftp.delegate.org/pub/DeleGate/" target="_blank" rel="external">FTP on DeleGate</a><br><a href="http://www.delegate.org/delegate/build.shtml" target="_blank" rel="external">Building DeleGate</a></p>
]]></content>
    <summary type="html">
    <![CDATA[由于ANDROID SDK只能接受HTTP代理，而我使用的只支持SOCKET5，故只能转化为HTTP代理。]]>
    
    </summary>
    
      <category term="Linux" scheme="https://hwangjr.github.io/tags/Linux/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Linux" scheme="https://hwangjr.github.io/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[GitHub + GitBook + Markdown来写一本自己的书]]></title>
    <link href="https://hwangjr.github.io/2015/08/18/GitHub-GitBook-Markdown%E6%9D%A5%E5%86%99%E4%B8%80%E6%9C%AC%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B9%A6/"/>
    <id>https://hwangjr.github.io/2015/08/18/GitHub-GitBook-Markdown来写一本自己的书/</id>
    <published>2015-08-18T09:32:23.000Z</published>
    <updated>2015-08-18T09:33:22.890Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>近期想要自己沉淀，而且也有意学习下如何贡献自己的知识，给更多人分享我的所得，所以就萌生自己写一个系列的入门书。<br>本次主要通过GitHub上面来进行源码托管，通过GitBook来进行排版及线上阅读下载等，利用Markdown语法来进行撰写。所以最好有一些GitHub及Markdown使用经验最嘉。</p>
<h2 id="作案工具准备">作案工具准备</h2><p>很简单：</p>
<ol>
<li>GitHub帐号</li>
<li>GitBook帐号（可利用GitHub帐号登录，也可申请）</li>
</ol>
<h3 id="GitHub配置">GitHub配置</h3><p>新建一个repo，比如<a href="https://github.com/hwangjr/simple-android" target="_blank" rel="external">hwangjr/simple-android</a>，ignore可以选择git book，READ ME等自己可以配置。</p>
<h3 id="GitBook配置">GitBook配置</h3><p>新建一本书籍<a href="https://www.gitbook.com/book/hwangjr/simple-android/welcome" target="_blank" rel="external">简易Android</a>。</p>
<h4 id="将代码托管到GitHub上">将代码托管到GitHub上</h4><p>点击Settings，选择右侧GitHub，会让你先与你的GitHub帐号进行关联（如果还未进行关联的话），然后设置成你在GitHub上新建的项目即可，即hwangjr/simple-android。</p>
<h4 id="绑定自定义域名">绑定自定义域名</h4><p>你可以绑定自己的自定义域名来进行解析到你的书籍。<br>1.在GitBook上设置你的域名。<br>点击右侧的Domains设置，即/settings/domains，然后输入你的HomePage及content的domain，这边设置为：<br>For homepage: simple-android.hwangjr.com<br>For content: content.simple-android.hwangjr.com</p>
<p>2.在域名解析商那边进行解析配置。<br>这里主要以万网解析进行配置，其他配置可参考，大同小异。<br>新增两条解析规则：<br>CNAME   simple-android   默认   www.gitbook.com<br>CNAME   content.simple-android   默认   www.gitbook.com<br>这里需要注意，记录值需要设置为www.gitbook.com，不能设置为gitbook.com等其他。<br>绑定完可以测试下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nslookup simple-android.hwangjr.com</span><br><span class="line">Server:		<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line">Address:	<span class="number">192.168</span>.<span class="number">1.1</span><span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">simple-android.hwangjr.com	canonical name = www.gitbook.com.</span><br><span class="line">www.gitbook.com	canonical name = saga-<span class="number">4658</span>.herokussl.com.</span><br><span class="line">saga-<span class="number">4658</span>.herokussl.com	canonical name = elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com.</span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.83</span>.<span class="number">21.67</span></span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.243</span>.<span class="number">203.15</span></span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.197</span>.<span class="number">223.43</span></span><br></pre></td></tr></table></figure></p>
<p>具体也可参考：<a href="http://help.gitbook.com/platform/domains.html" target="_blank" rel="external">Custom Domains</a></p>
<h4 id="GitBook软件安装">GitBook软件安装</h4><p>首先需要Node.js环境，才能安装GitBook软件。简单说明下软件安装。<br>安装Node.js最好用<a href="https://github.com/creationix/nvm" target="_blank" rel="external">creationix/nvm</a>来进行版本管理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.github.com/creationix/nvm/master/install.sh | sh</span><br><span class="line">nvm install <span class="number">0.12</span></span><br><span class="line">nvm use <span class="number">0.12</span></span><br><span class="line">npm install gitbook -g</span><br></pre></td></tr></table></figure></p>
<p>NPM较慢可以参考：<a href="https://npm.taobao.org/" target="_blank" rel="external">淘宝 NPM 镜像</a><br>之后即可用git book在本地进行书籍调试。</p>
<h3 id="Markdown配置">Markdown配置</h3><p>Markdown目前一般用stackedit.io进行编写，之后进行同步~也有很多其他的软件，类似MarkdownPad等，都可以进行本地编写，VIM也有相应的Markdown插件。</p>
<h3 id="总结">总结</h3><p>这里还可以设置书籍主题(/theme)等操作，这里就不详细说明了。<br>接下来就可以用Markdown进行书籍编写了~</p>
]]></content>
    <summary type="html">
    <![CDATA[如何用Gitbook和Github，再利用Markdown来写一本属于自己的书，方便在线阅读或下载等。]]>
    
    </summary>
    
      <category term="Books" scheme="https://hwangjr.github.io/tags/Books/"/>
    
      <category term="Books" scheme="https://hwangjr.github.io/categories/Books/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[V8和项目SO库冲突]]></title>
    <link href="https://hwangjr.github.io/2015/08/12/V8%E5%92%8C%E9%A1%B9%E7%9B%AESO%E5%BA%93%E5%86%B2%E7%AA%81/"/>
    <id>https://hwangjr.github.io/2015/08/12/V8和项目SO库冲突/</id>
    <published>2015-08-12T07:19:46.000Z</published>
    <updated>2015-08-12T07:20:13.468Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>在<a href="http://blog.hwangjr.com/2015/07/10/Android-%E5%AE%9E%E7%8E%B0%E6%AF%9B%E7%8E%BB%E7%92%83%E6%95%88%E6%9E%9C/" target="_blank" rel="external">毛玻璃效果</a>中，项目加入了毛玻璃，相应的会引入V8库。V8库有加入对底层的支持，包括so库等。<br>由于项目中也有加入百度推送，包括so库，在加入V8之后，启动应用会收到一个error，加载推送的so库错误。</p>
<h2 id="初步诊断，so库加入方式冲突">初步诊断，so库加入方式冲突</h2><h3 id="加入V8方式">加入V8方式</h3><p>如果是android studio的话：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    renderscriptTargetApi <span class="number">22</span></span><br><span class="line">    renderscriptSupportModeEnabled <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="集成SO库方式">集成SO库方式</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    <span class="keyword">sourceSets</span> &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="结论">结论</h3><p>是render script的加入方式和jniLibs.srcDirs冲突，很可能被重写了，导致没有加入。</p>
<h2 id="解决方法">解决方法</h2><p>知道是什么原因引起的，那就很好解决了。</p>
<h3 id="修改V8引入方式">修改V8引入方式</h3><p>既然是引入V8导致的问题，那么相应的，我们可以显示的引入V8包。V8在SDK中的位置（不同版本的V8在相应的build tools的版本下）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/android-sdk-linux/build-tools/<span class="number">22.0</span>.1</span><br></pre></td></tr></table></figure></p>
<p>我们拷贝lib下面的jar包和packaged下面的so库，显示导入V8包，即可解决问题。</p>
<h3 id="第三方插件">第三方插件</h3><p>有需求就有市场，强大的GITHUB上面有了GRADLE NATIVE插件<a href="https://github.com/nhachicha/android-native-dependencies" target="_blank" rel="external">android-native-dependencies</a>，专门解决so库的集成问题，包括Maven等仓库的so库拉取等。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">  <span class="keyword">repositories</span> &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.0.0'</span></span><br><span class="line">    <span class="keyword">classpath</span> <span class="string">'com.nabilhachicha:android-native-dependencies:0.1.2'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'android'</span></span><br><span class="line">apply plugin: <span class="string">'android-native-dependencies'</span></span><br><span class="line"></span><br><span class="line">native_dependencies &#123;</span><br><span class="line">    artifact <span class="string">'com.snappydb:snappydb-native:0.2.+:armeabi'</span></span><br><span class="line">    artifact <span class="string">'com.snappydb:snappydb-native:0.2.+:x86'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">//regular Jar dependencies ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Gradle任务方式">Gradle任务方式</h3><p>其实so库就是将so库copy到特定的目录下面，来进行打包即可，那么我们直接写copy的task执行也是可以的。但是有个问题就是随着gradle的升级，很多方法可能会丢弃，那么我们就得随着gradle升级不断升级。<br><a href="https://gist.github.com/khernyo/4226923" target="_blank" rel="external">参考代码</a>：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This hack works with com.android.tools.build:gradle:1.0.0, won't work in later version without modification</span></span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'android'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">targetCompatibility</span> = <span class="number">1.6</span></span><br><span class="line"><span class="keyword">sourceCompatibility</span> = <span class="number">1.6</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">	target = <span class="string">'android-14'</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">sourceSets</span> &#123;</span><br><span class="line">		main &#123;</span><br><span class="line">			manifest.srcFile <span class="string">'AndroidManifest.xml'</span></span><br><span class="line">			java.srcDir <span class="string">'src'</span></span><br><span class="line">			res.srcDir <span class="string">'res'</span></span><br><span class="line">			assets.srcDir <span class="string">'assets'</span></span><br><span class="line">			resources.srcDir <span class="string">'src'</span></span><br><span class="line">		&#125;</span><br><span class="line">		test &#123;</span><br><span class="line">			java.srcDir <span class="string">'tests/src'</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':main'</span>)</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'../main/libs'</span>, <span class="keyword">include</span>: <span class="string">'*.jar'</span>)</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'../thirdparty/actionbar-sherlock/library/libs'</span>, <span class="keyword">include</span>: <span class="string">'*.jar'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> copyNativeLibs(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">	<span class="keyword">from</span>(<span class="keyword">new</span> <span class="keyword">File</span>(<span class="keyword">project</span>(<span class="string">':main'</span>).buildDir, <span class="string">'native-libs'</span>)) &#123; <span class="keyword">include</span> <span class="string">'**/*.so'</span> &#125;</span><br><span class="line">	<span class="keyword">into</span> <span class="keyword">new</span> <span class="keyword">File</span>(buildDir, <span class="string">'native-libs'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123; javaCompileTask -&gt; javaCompileTask.dependsOn copyNativeLibs &#125;</span><br><span class="line"></span><br><span class="line">clean.dependsOn <span class="string">'cleanCopyNativeLibs'</span></span><br><span class="line"></span><br><span class="line">tasks.withType(com.android.build.gradle.PackageApplicationTask) &#123; pkgTask -&gt;</span><br><span class="line">	pkgTask.jniDir <span class="keyword">new</span> <span class="keyword">File</span>(buildDir, <span class="string">'native-libs'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Ref">Ref</h2><p><a href="https://github.com/nhachicha/android-native-dependencies" target="_blank" rel="external">android-native-dependencies</a><br><a href="https://nhachicha.wordpress.com/2014/05/27/android-gradle-add-native-so-dependencies/" target="_blank" rel="external">Android Gradle, add native .so dependencies</a><br><a href="http://tools.android.com/tech-docs/new-build-system" target="_blank" rel="external">New Build System - Android Tools Project Site</a><br><a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental" target="_blank" rel="external">Experimental Plugin User Guide</a><br><a href="https://github.com/googlesamples/android-ndk" target="_blank" rel="external">googlesamples/android-ndk</a><br><a href="http://zhengxiaopeng.com/2014/12/13/Android-Studio-jar%E3%80%81so%E3%80%81library%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96/" target="_blank" rel="external">Android Studio Jar、so、library项目依赖</a></p>
]]></content>
    <summary type="html">
    <![CDATA[在使用V8库的时候，发现打包完的APK里面竟然没有加入SO库（libs目录下的so库）。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[AndroidStudio 快捷键]]></title>
    <link href="https://hwangjr.github.io/2015/08/12/AndroidStudio-%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <id>https://hwangjr.github.io/2015/08/12/AndroidStudio-快捷键/</id>
    <published>2015-08-12T07:18:55.000Z</published>
    <updated>2015-08-12T07:19:23.860Z</updated>
    <content type="html"><![CDATA[<h2 id="IDE">IDE</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F1</td>
<td>帮助</td>
</tr>
<tr>
<td>Alt+F1</td>
<td>查找文件所在目录位置</td>
</tr>
<tr>
<td>Alt+1</td>
<td>快速打开或隐藏工程面板</td>
</tr>
<tr>
<td>Ctrl+Alt+S</td>
<td>打开设置对话框</td>
</tr>
<tr>
<td>Alt+Home</td>
<td>跳转到导航栏</td>
</tr>
<tr>
<td>Esc</td>
<td>光标返回编辑框</td>
</tr>
<tr>
<td>Shift+Esc</td>
<td>光标返回编辑框,关闭无用的窗口</td>
</tr>
<tr>
<td>Shift+Click</td>
<td>关闭标签页</td>
</tr>
<tr>
<td>F12</td>
<td>把焦点从编辑器移到最近使用的工具窗口</td>
</tr>
<tr>
<td>Ctrl+Alt+Y</td>
<td>同步</td>
</tr>
<tr>
<td>Ctrl+Alt+S</td>
<td>打开设置对话框</td>
</tr>
<tr>
<td>Alt+Shift+Inert</td>
<td>开启/关闭列选择模式</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+S</td>
<td>打开当前项目/模块属性</td>
</tr>
<tr>
<td>Alt+Shift+C</td>
<td>查看文件的变更历史</td>
</tr>
<tr>
<td>Ctrl+Shift+F10</td>
<td>运行</td>
</tr>
<tr>
<td>Ctrl+Shift+F9</td>
<td>debug运行</td>
</tr>
<tr>
<td>Ctrl+Alt+F12</td>
<td>资源管理器打开文件夹</td>
</tr>
</tbody>
</table>
<h2 id="编辑">编辑</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alt+J</td>
<td>多行编辑</td>
</tr>
<tr>
<td>Alt+MouseDrag</td>
<td>鼠标选中区域</td>
</tr>
<tr>
<td>Ctrl+C</td>
<td>复制当前行或选中的内容</td>
</tr>
<tr>
<td>Ctrl+D</td>
<td>粘贴当前行或选中的内容到下一行</td>
</tr>
<tr>
<td>Ctrl+X</td>
<td>剪切当前行或选中的内容</td>
</tr>
<tr>
<td>Ctrl+Y</td>
<td>删除行</td>
</tr>
<tr>
<td>Ctrl+Z</td>
<td>倒退</td>
</tr>
<tr>
<td>Ctrl+Shift+Z</td>
<td>向前</td>
</tr>
<tr>
<td>Alt+Enter</td>
<td>自动修正</td>
</tr>
<tr>
<td>Ctrl+Alt+L</td>
<td>格式化代码</td>
</tr>
<tr>
<td>Ctrl+Alt+I</td>
<td>将选中的代码进行自动缩进编排</td>
</tr>
<tr>
<td>Ctrl+Alt+O</td>
<td>优化导入的类和包</td>
</tr>
<tr>
<td>Ctrl+Alt+D</td>
<td>对选中内容添加包围代码</td>
</tr>
<tr>
<td>Ctrl+Alt+J</td>
<td>用动态模板环绕</td>
</tr>
<tr>
<td>Alt+Insert</td>
<td>得到一些Intention Action，可以生成构造器、Getter、Setter、将 == 改为 equals() 等</td>
</tr>
<tr>
<td>Ctrl+Shift+V</td>
<td>选最近使用的剪贴板内容并插入</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+V</td>
<td>简单粘贴</td>
</tr>
<tr>
<td>Ctrl+Shift+Insert</td>
<td>选最近使用的剪贴板内容并插入（同Ctrl+Shift+V）</td>
</tr>
<tr>
<td>Ctrl+Enter</td>
<td>在当前行的上面插入新行，并移动光标到新行（此功能光标在行首时有效）</td>
</tr>
<tr>
<td>Shift+Enter</td>
<td>在当前行的下面插入新行，并移动光标到新行</td>
</tr>
<tr>
<td>Ctrl+J</td>
<td>自动代码</td>
</tr>
<tr>
<td>Ctrl+Alt+T</td>
<td>把选中的代码放在 try{} 、if{} 、 else{} 里</td>
</tr>
<tr>
<td>Shift+Alt+Insert</td>
<td>竖编辑模式</td>
</tr>
<tr>
<td>Ctrl+ /</td>
<td>注释 //</td>
</tr>
<tr>
<td>Ctrl+Shift+ /</td>
<td>注释 /<em>…</em>/</td>
</tr>
<tr>
<td>Ctrl+Shift+J</td>
<td>合并成一行</td>
</tr>
<tr>
<td>F2/Shift+F2</td>
<td>跳转到下/上一个错误语句处</td>
</tr>
<tr>
<td>Ctrl+Shift+Back</td>
<td>跳转到上次编辑的地方</td>
</tr>
<tr>
<td>Ctrl+Alt+Space</td>
<td>类名自动完成</td>
</tr>
<tr>
<td>Shift+Alt+Up/Down</td>
<td>内容向上/下移动</td>
</tr>
<tr>
<td>Ctrl+Shift+Up/Down</td>
<td>语句向上/下移动</td>
</tr>
<tr>
<td>Ctrl+Shift+U</td>
<td>大小写切换</td>
</tr>
<tr>
<td>Tab</td>
<td>代码标签输入完成后，按 Tab，生成代码</td>
</tr>
<tr>
<td>Ctrl+Backspace</td>
<td>按单词删除</td>
</tr>
<tr>
<td>Ctrl+Shift+Enter</td>
<td>语句完成</td>
</tr>
</tbody>
</table>
<h2 id="文件">文件</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl+F12</td>
<td>显示当前文件的结构</td>
</tr>
<tr>
<td>Ctrl+H</td>
<td>显示类继承结构图</td>
</tr>
<tr>
<td>Ctrl+Q</td>
<td>显示注释文档</td>
</tr>
<tr>
<td>Ctrl+P</td>
<td>方法参数提示</td>
</tr>
<tr>
<td>Ctrl+U</td>
<td>打开当前类的父类或者实现的接口</td>
</tr>
<tr>
<td>Alt+Left/Right</td>
<td>切换代码视图</td>
</tr>
<tr>
<td>Ctrl+Alt+Left/Right</td>
<td>返回上次编辑的位置</td>
</tr>
<tr>
<td>Alt+Up/Down</td>
<td>在方法间快速移动定位</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>快速打开光标处的类或方法</td>
</tr>
<tr>
<td>Ctrl+W</td>
<td>选中代码，连续按会有其他效果</td>
</tr>
<tr>
<td>Ctrl+Shift+W</td>
<td>取消选择光标所在词</td>
</tr>
<tr>
<td>Ctrl+ - / +</td>
<td>折叠/展开代码</td>
</tr>
<tr>
<td>Ctrl+Shift+ - / +</td>
<td>折叠/展开全部代码</td>
</tr>
<tr>
<td>Ctrl+Shift+.</td>
<td>折叠/展开当前花括号中的代码</td>
</tr>
<tr>
<td>Ctrl+ ] / [</td>
<td>跳转到代码块结束/开始处</td>
</tr>
<tr>
<td>F2 或 Shift+F2</td>
<td>高亮错误或警告快速定位</td>
</tr>
<tr>
<td>Ctrl+Shift+C</td>
<td>复制路径</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+C</td>
<td>复制引用，必须选择类名</td>
</tr>
<tr>
<td>Alt+Up/Down</td>
<td>在方法间快速移动定位</td>
</tr>
<tr>
<td>Shift+F1</td>
<td>要打开编辑器光标字符处使用的类或者方法 Java 文档的浏览器</td>
</tr>
<tr>
<td>Ctrl+G</td>
<td>定位行</td>
</tr>
</tbody>
</table>
<h2 id="查找">查找</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl+F</td>
<td>在当前窗口查找文本</td>
</tr>
<tr>
<td>Ctrl+Shift+F</td>
<td>在指定环境下查找文本</td>
</tr>
<tr>
<td>F3</td>
<td>向下查找关键字出现位置</td>
</tr>
<tr>
<td>Shift+F3</td>
<td>向上一个关键字出现位置</td>
</tr>
<tr>
<td>Ctrl+R</td>
<td>在当前窗口替换文本</td>
</tr>
<tr>
<td>Ctrl+Shift+R</td>
<td>在指定窗口替换文本</td>
</tr>
<tr>
<td>Ctrl+N</td>
<td>查找类</td>
</tr>
<tr>
<td>Ctrl+Shift+N</td>
<td>查找文件</td>
</tr>
<tr>
<td>Ctrl+Shift+Alt+N</td>
<td>查找项目中的方法或变量</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>查找变量的来源</td>
</tr>
<tr>
<td>Ctrl+Alt+B</td>
<td>快速打开光标处的类或方法</td>
</tr>
<tr>
<td>Ctrl+Shift+B</td>
<td>跳转到类或方法实现处</td>
</tr>
<tr>
<td>Ctrl+E</td>
<td>最近打开的文件</td>
</tr>
<tr>
<td>Alt+F3</td>
<td>快速查找，效果和Ctrl+F相同</td>
</tr>
<tr>
<td>F4</td>
<td>跳转至定义变量的位置</td>
</tr>
<tr>
<td>Alt+F7</td>
<td>查询当前元素在工程中的引用</td>
</tr>
<tr>
<td>Ctrl+F7</td>
<td>查询当前元素在当前文件中的引用，然后按 F3 可以选择</td>
</tr>
<tr>
<td>Ctrl+Alt+F7</td>
<td>选中查询当前元素(方法或元素)在工程中的引用</td>
</tr>
<tr>
<td>Ctrl+Alt+H</td>
<td>打开方法调用结构层级的窗口</td>
</tr>
<tr>
<td>Ctrl+Shift+F7</td>
<td>高亮显示匹配的字符，按 Esc 高亮消失</td>
</tr>
<tr>
<td>Ctrl+Shift+Alt+N</td>
<td>查找类中的方法或变量</td>
</tr>
<tr>
<td>Ctrl+F12</td>
<td>查找类中的方法</td>
</tr>
<tr>
<td>Ctrl+Shift+O</td>
<td>弹出显示查找内容</td>
</tr>
<tr>
<td>Ctrl+Alt+Up/Down</td>
<td>快速跳转搜索结果</td>
</tr>
<tr>
<td>Ctrl+Shift+S</td>
<td>高级搜索、搜索结构</td>
</tr>
</tbody>
</table>
<h2 id="重构">重构</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F5</td>
<td>复制</td>
</tr>
<tr>
<td>F6</td>
<td>移动</td>
</tr>
<tr>
<td>Alt+Delete</td>
<td>安全删除</td>
</tr>
<tr>
<td>Ctrl+U</td>
<td>转到父类</td>
</tr>
<tr>
<td>Ctrl+O</td>
<td>重写父类的方法</td>
</tr>
<tr>
<td>Ctrl+I</td>
<td>实现方法</td>
</tr>
<tr>
<td>Ctrl+Alt+N</td>
<td>内联</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+T</td>
<td>弹出重构菜单</td>
</tr>
<tr>
<td>Shift+F6</td>
<td>重构-重命名</td>
</tr>
<tr>
<td>Ctrl+Alt+M</td>
<td>提取代码组成方法</td>
</tr>
<tr>
<td>Ctrl+Alt+C</td>
<td>将变量更改为常量</td>
</tr>
<tr>
<td>Ctrl+Alt+V</td>
<td>定义变量引用当前对象或者方法的返回值</td>
</tr>
<tr>
<td>Ctrl+Alt+F</td>
<td>将局部变量更改为类的成员变量</td>
</tr>
<tr>
<td>Ctrl+Alt+P</td>
<td>将变量更改为方法的参数</td>
</tr>
</tbody>
</table>
<h2 id="调试">调试</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F8</td>
<td>跳到下一步</td>
</tr>
<tr>
<td>Shift+F8</td>
<td>跳出函数、跳到下一个断点</td>
</tr>
<tr>
<td>Alt+Shift+F8</td>
<td>强制跳出函数</td>
</tr>
<tr>
<td>F7</td>
<td>进入代码</td>
</tr>
<tr>
<td>Shift+F7</td>
<td>智能进入代码</td>
</tr>
<tr>
<td>Alt+Shift+F7</td>
<td>强制进入代码</td>
</tr>
<tr>
<td>Alt+F9</td>
<td>运行至光标处</td>
</tr>
<tr>
<td>Ctrl+Alt+F9</td>
<td>强制运行至光标处</td>
</tr>
<tr>
<td>Ctrl+F2</td>
<td>停止运行</td>
</tr>
<tr>
<td>Alt+F8</td>
<td>计算变量值</td>
</tr>
</tbody>
</table>
<h2 id="VCS">VCS</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alt+ ~    VCS</td>
<td>操作菜单</td>
</tr>
<tr>
<td>Ctrl+K</td>
<td>提交更改</td>
</tr>
<tr>
<td>Ctrl+T</td>
<td>更新项目</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+D</td>
<td>显示变化</td>
</tr>
</tbody>
</table>
<h2 id="Others">Others</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>(Ctrl+)F11</td>
<td>标记书签</td>
</tr>
<tr>
<td>Shift+F11</td>
<td>显示书签</td>
</tr>
</tbody>
</table>
<h2 id="REF">REF</h2><p><a href="http://zhengxiaopeng.com/2014/12/13/Android-Studio-jar%E3%80%81so%E3%80%81library%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96/" target="_blank" rel="external">Android Studio Jar、so、library项目依赖</a></p>
]]></content>
    <summary type="html">
    <![CDATA[AndroidStudio快捷键备忘。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[创业团队股权分配]]></title>
    <link href="https://hwangjr.github.io/2015/08/05/%E5%88%9B%E4%B8%9A%E5%9B%A2%E9%98%9F%E8%82%A1%E6%9D%83%E5%88%86%E9%85%8D/"/>
    <id>https://hwangjr.github.io/2015/08/05/创业团队股权分配/</id>
    <published>2015-08-05T07:33:39.000Z</published>
    <updated>2015-08-05T07:34:05.710Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>团队分配股权，根本上来说，是需要创始人在分配和讨论过程中，整个团队感觉到合理、公平的一个分配方案，需要让各方达成共识。但是股权分配肯定无法替代信任的建立。<br>另外，股权分配一旦确定，很多在执行力上不足，这也是很多创业团队现有的问题，这时大家必须坐到一块，兑现股权约定。<br>本文从互联网资料参考，并进行总结，希望能让大家有所收获。</p>
<h2 id="阶梯分配">阶梯分配</h2><p>将其取名为阶梯，是因为这个分配是从进入团队的不同时期来进行分配，越迟加入公司的员工风险越低。</p>
<h3 id="原则">原则</h3><p>为了简单，假设所有创始人都全职创业。<br>随着公司的不断壮大，新员工不断加入，公司的也将一批一批的加入新员工，当你进行第一批招人时，很可能你已经获取到现金流（投资或者客户），所以除了创始人（第一批）之外，其他都不是创始人，他们是加入公司打工，因为他们不需要冒很大风险且从工作第一天就开始拿工资了。<br>那么当你的公司大到可以上市或者其他，这时你的公司也许已经有了6批，员工大约5批，第二批有5个，第三批25个，第四批200，ETC。<br>综上：创始人应该最终拿整个公司大约50%的股份，首批下面的5批员工每一批最终都分别分到大约10%的公司股份，每一批员工都将平分这10%股份。<br>基本思路就是，你设立不同的资历，最高的员工承受最大风险，最低员工风险最低，每批员工平均分配给这个这批股份，也就是让越早加入员工获得越多股份。<br>现在，你还需用执行一个重要的原则：股份绑定（vesting）。绑定期最好是4-5年，任何人在公司起码1年才可持有股份（包括创始人）。一般头一年25%，接下来每月落实2%。没有股份绑定条款，派股给任何人都是不靠谱的！<br>最后需要解决一个问题，当有新的投资进来时，将如何分割股份？答案很简单：新的投资将稀释所有人的股份。<br>另外，千万不要用分配股权来解决一些薪资或其他问题，比如：</p>
<ol>
<li>创业构想提出者，需要多拿股份吗？</li>
<li>创始人之一不是全职投入？（那创始人就不是创始人了）</li>
<li>为公司提供设备或其他有价值（专利等）东西，如何处理？<br>这些问题，都可通过类似补发工资等方式来解决，在公司现金流运转正常之后，对每个创始人薪资进行补发，避免因此引起的纠纷。<br>投资人、创始人和雇员分别拥有多少股份？这个需要市场来确定，现实地看，如果投资人最终获得50%以上，创始人重要性将被削弱，从而丧失动力。而如果创始人和员工如果持有100%股份，也会给投资人带来很大的压力，以平衡投资人和创始人/员工之间分配。正常公司上市时，投资人将拥有50%股份，创始人+员工将拥有50%股份。<h3 id="总结">总结</h3>虽然创业公司股权分配原则没有一刀切的解决方案，但是尽可能简单化、透明化、公平化！</li>
</ol>
<h2 id="常规分配">常规分配</h2><p>股权分配最错误的做法是股权五五分，五五分的结果是没有分配决定权。在开始的蜜月期可能不会产生争执，正所谓可以共患难，难以同甘苦。到了一定阶段，出现分歧的时候，如果有没有一个人拥有绝对的控制权，可能谁也不服气谁，最终的结果就是分道扬镳，创业失败。基于公司法规定的的股权1/2的决议规则和2/3的特别决议规则，相对理想的股权分配是持1/2以上股权，更理想是2/3以上。<br>这边分为三个部分。<br>一是创始人的股权。<br>二是员工的股权。<br>三是众筹的股权。</p>
<h3 id="创始人的股权">创始人的股权</h3><h4 id="确定创始人">确定创始人</h4><p>创始人是承担了风险的人。判断创始人的简单方法是拿不拿工资，如果在最开始，都不能支付工资给你，那你就是创始人。<br>按照下面标准来进行股权增减：</p>
<ol>
<li>初始(每人均分100份股权)。</li>
<li>召集人(股权增加5%)。</li>
<li>创业点子及执行很重要(股权增加5%)。提供了最初的创业点子并执行成功。</li>
<li>迈出第一步最难(股权增加5%-25%)。如果某个创始人提出的概念已经着手实施，比如已经开始申请专利、已经有一个演示原型、已经有一个产品的早期版本，或者其他对吸引投资或贷款有利的事情，那么这个创始人额外可以得到的股权，从5%到 25%不等。</li>
<li>CEO，即总经理应该持股更多(股权增加5%)。</li>
<li>全职创业是最最有价值的(股权增加200%)。</li>
<li>信誉是最重要的资产(股权增加50-500%)。如果创始人是第一次创业，而他的合伙人里有人曾经参与过风投投资成功了的项目，那么这个合伙人比创始人更有投资价值。在某些极端情况 下，某些创始人会让投资人觉得非常值得投资，这些超级合伙人基本上消除了“创办阶段”的所有风险，所以最好让他们在这个阶段获得最多的股权。</li>
<li>现金投入参照投资人投资。很可能是某个合伙人投入的资金相对而言多的多。这样的投资应该获较多的股权，因为最早期的投资，风险也往往最大，所以应该获得更多的股权。</li>
<li>最后进行计算。假设最后计算的三个创始人的股份是为200/150/250，那么将他们的股份数相加(即为600份)作为总数，再计算他们每个人的持股比例：33%/25%/42%。<h4 id="创始人股权的退出机制">创始人股权的退出机制</h4>作为创业企业，如果创始人离开创业团队就涉及股权的退出机制。如果不设定退出机制，允许中途退出的合伙人带走股权，对退出合伙人的公平，但却是对其它长期参与创业的合伙人最大的不公平，对其它合伙人也没有安全感。<br>对于退出的合伙人，一方面，可以全部或部分收回股权；另一方面，必须承认合伙人的历史贡献，按照一定溢价/或折价回购股权。对于如何确定具体的退出价格，涉及两个因素，一个是退出价格基数，一个是溢价/或折价倍数。可以考虑按照：</li>
<li>合伙人掏钱买股权的购买价格的一定溢价回购</li>
<li>退出合伙人按照其持股比例可参与分配公司净资产或净利润的一定溢价</li>
<li>按照公司最近一轮融资估值的一定折扣价回购</li>
<li>有些退出价格是当时投入的本金，加合理利息回报。至于退出价格，不同公司会存在差异。<h4 id="股权与分红权的分离">股权与分红权的分离</h4>分红权和股权可以分离，表决权理论上也可以分离。对于出资较大的合伙人，可以给与较大的分红权，但对于承担风险较大的，应给与较大的股权。<h4 id="股权协议的约定">股权协议的约定</h4>一些公司出现拥有股权的合伙人在创业过程中出现了，违背创业企业利益的行为，比如泄密或者携带知识产权另立门户等，为了保护创业企业其他合伙人的利益，最好在协议中约定这些对股权的限制条款。还可制定股权实现的考核标准，不达到考核标准不拥有股权。<h3 id="员工的股权">员工的股权</h3>什么是员工？谁是员工的判断标准是看其是否是具有员工心态的人。在创业企业，有些合伙人希望把员工当做合伙人，也给与股权激励。这样的做法，负面作用是：</li>
<li>过早的分散了股权</li>
<li>拥有员工心态的人，希望得到的是稳定的现金收入，而不是未来可能增值的股权。<br>因此，即使是作为激励作用的股权也不应当份额过大。员工管理问题不应单纯利用股权解决。一般来说，VC会要求员工持股计划在VC投资进来之前执行，这样VC就可以减少稀释。不过不能认为这是A轮VC自私，要知道B轮VC到时候也会要求在他们进来之前再执行一次员工持股计划，这时A轮VC和创始股东将一起稀释。 员工的期权比例应该留多少？一般来说是5-15%。<h3 id="众筹的股权">众筹的股权</h3><strong>众筹从概念逐渐变为实践，“股权众筹是否构成非法集资”已经不再是法律角度的焦点。</strong>股权众筹，既然是“众”筹，就说明股东数量非常多。不过，公司法规定，有限责任公司的股东不超过50人，非上市的股份有限公司股东不超过200人。法律对公司股东人数的限制，导致大部分众筹股东不能直接出现在企业工商登记的股东名册中。这一问题的解决方案一般有两种：</li>
<li><strong>委托持股，或者说是代持股。</strong>一个实名股东分别与几个乃至几十个隐名的众筹股东签订代持股协议，代表众筹股东持有众筹公司股份。在这种模式下，众筹股东并不亲自持有股份，而是由某一个实名股东持有，并且在工商登记里只体现出该实名股东的身份。中国国内法律已经认可了保护真实股东的合法利益，也就是即使股东名册里面没有出现众筹股东的名字，只要有协议证明真实股东是真实的出资人，其权益也是被保障的。</li>
<li><strong>持股平台持股。</strong>比如，先设立一个持股平台，五十个众筹股东作为这个持股平台的投资人，把资金投入持股平台。然后，持股平台把这笔款再投入众筹公司，由持股平台作为众筹公司的股东。这样五十个众筹股东在众筹公司里只体现为一个股东，即持股平台。持股平台可以是有限责任公司，也可以是有限合伙。两者对于众筹股东来说都是有限责任的。按照合伙企业法，通常有限合伙人不参与管理，由普通合伙人负责管理。这样，众筹发起人就可以其普通合伙人的身份，管理和控制持股平台，进而控制持股平台在众筹公司的股份，也就实际上控制了众筹股东的投资及股份。<br><strong>期权池</strong>是在融资前为未来引进高级人才而预留的一部分股份，用于激励员工(包括创始人自己、高管、骨干、普通员工)，是初创企业实施股权激励计划(Equity Incentive Plan)最普通采用的形式，在欧美等国家被认为是驱动初创企业发展必要的关键要素之一。硅谷的惯例是预留公司全部股份的10%-20%作为期权池，较大的期权池对员工和VC具更大吸引力。 VC一般要求期权池在它进入前设立，并要求在它进入后达到一定比例。由于每轮融资都会稀释期权池的股权比例，因此一般在每次融资时均调整(扩大)期权池，以不断吸引新的人才。<h3 id="案例">案例</h3>苹果，起始阶段的股权比例是乔布斯和沃兹尼亚克各45%，韦恩10%；谷歌，佩吉和布林一人一半；Facebook，扎克伯格65%，萨维林30%，莫斯科维茨5%。<br>苹果电脑是沃兹尼亚克开发的，但乔布斯和沃兹股份一样（沃兹的父亲对此非常不满），因为乔布斯不仅是个营销天才，而且拥有领导力，对公司未来意志坚定激情四射。而沃兹生性内敛，习惯于一个人工作，并且只愿意兼职为新公司工作，乔布斯和他的朋友家人百般劝说才同意全职。至于韦恩，他拥有10%是因为其他两人在运营公司方面完全是新手，需要他的经验。由于厌恶风险，韦恩很快就退股了，他一直声称自己从未后悔过。<br>Facebook是扎克伯格开发的，他又是个意志坚定的领导者，因此占据65%，萨维林懂得怎样把产品变成钱，莫斯科维茨则在增加用户上贡献卓著。不过，Facebook起始阶段的股权安排埋下了日后隐患。由于萨维林不愿意和其他人一样中止学业全情投入新公司，而他又占有1/3的股份。因此，当莫斯科维茨和新加入但创业经验丰富的帕克贡献与日俱增时，就只能稀释萨维林的股份来增加后两者的持股，而萨维林则以冻结公司账号作为回应。A轮融资完成后，萨维林的股份降至不到10%，怒火中烧的他干脆将昔日伙伴们告上了法庭。萨维林之所以拿那么高股份是因为他能为公司赚到钱，而公司每天都得花钱。但扎克伯格的理念是“让网站有趣比让它赚钱更重要”，萨维林想的则是如何满足广告商要求从而多赚钱。短期看萨维林是对的，但这么做不可能成就一家伟大的公司，扎克伯格对此心知肚明。Facebook正确的办法应当是早一点寻找天使投资，就像苹果和谷歌曾经做过的那样。在新公司确定产品方向之后，就需要天使投资来帮助自己把产品和商业模式稳定下，避免立即赚钱的压力将公司引入歧途。Facebook的天使投资人是帕克的朋友介绍的彼得·泰尔，他注资50万美元，获得 10%股份。这之后，Facebook的发展可谓一帆风顺，不到一年就拿到了A轮融资——阿克塞尔公司投资1270万美元，公司估值1亿美元。7年后的2012年，Facebook上市，此时公司8岁。谷歌从天使到A轮的时间差不多是一年。硅谷著名风投公司KPCB和红杉资本各注入谷歌125万美元，分别获得10%股份。5后的2004年，也就是公司创立6年后，谷歌上市，近2000名员工获得配股。 苹果公司在马库拉投资后没有经历后续融资，4年之后上市，上百名员工成了百万富翁，此时公司5岁。<h3 id="总结-1">总结</h3>创业团队在组建过程中需要制定股权分配方案。随着公司逐渐变大，资本需求会越来越旺，后续融资不可避免，引进经验丰富的运营人才也必须授予其股权或期权，这些都会稀释创始人的股权。事实上，创始人在公司长大之后如何不被董事会踢出自己创办的公司，早已是硅谷的经典话题之一。乔布斯在苹果上市4年半后被赶出了苹果公司，没有一个创始人愿意失去自己的公司，而他们也有办法做到这一点，那就是采用双层股权结构（就是前文提到的表决权和分红权分离的做法）。<br>苹果当年是单一股权结构，同股同权，苹果上市后，乔布斯的股权下降到11%，董事会里也没有他的铁杆盟友（他本以为马库拉会是），触犯众怒后的结局可想而知。 谷歌则在上市时重拾美国资本市场消失已久的AB股模式，佩吉、布林、施密特等公司创始人和高管持有B类股票，每股表决权等于A类股票10股的表决权。2012年，谷歌又增加了不含投票权的C类股用于增发新股。这样，即使总股本继续扩大，即使创始人减持了股票，他们也不会丧失对公司的控制力。预计到2015年，佩吉、布林、施密特持有谷歌股票将低于总股本的20%，但仍拥有近60%的投票权。Facebook前年上市时同样使用了投票权1：10的AB股模式，这样扎克伯格一人就拥有28.2的表决权。此外，扎克伯格还和主要股东签订了表决权代理协议，在特定情况下，扎克伯格可代表这些股东行使表决权，这意味着他掌握了56.9%的表决权。<br>在中国，公司法规定同股同权，不允许直接实施双层或三层股权结构，但公司法允许公司章程对投票权进行特别约定（有限责任公司），允许股东在股东大会上将自己的投票权授予其他股东代为行使（股份有限公司）。</li>
</ol>
<h2 id="总结-2">总结</h2><p>股权分配问题是一种博弈，是不同角色之间的讨价还价，也取决于不同人的性格，没有一个标准答案。</p>
<h2 id="Ref">Ref</h2><p><a href="http://www.zhihu.com/question/19551070" target="_blank" rel="external">几个朋友合伙创业，如何分配股权？ - 知乎</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19906816" target="_blank" rel="external">杜国栋：联合创始人退出，他手里的股权怎么办？ - 创思舍 - 知乎专栏</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19970947" target="_blank" rel="external">创始人之间如何分股权：按贡献估值 - 创思舍 - 知乎专栏</a><br><a href="http://wenku.baidu.com/view/cd30202c453610661ed9f410.html" target="_blank" rel="external">华为股权分配政策(幻灯片)_百度文库</a><br><a href="http://www.tmtpost.com/172112.html" target="_blank" rel="external">联合创始人股权分配，五五分是最糟糕的做法</a><br><a href="http://blog.sina.com.cn/s/blog_61b925fa0100foie.html" target="_blank" rel="external">(3)11.18.09 期权：为什么给，给多少，怎么给？<em>邵亦波</em>新浪博客</a><br><a href="http://36kr.com/p/22890.html" target="_blank" rel="external">Joel Spolsky: 创业公司如何公平分配股权？</a></p>
]]></content>
    <summary type="html">
    <![CDATA[对于创业团队，股权分配是一个严肃的事情，如何在进行激情的创业之前将利益/股权进行分配，关系到团队能否成功等问题。本文只进行探讨，不进行对错分析。]]>
    
    </summary>
    
      <category term="创业" scheme="https://hwangjr.github.io/tags/%E5%88%9B%E4%B8%9A/"/>
    
      <category term="创业" scheme="https://hwangjr.github.io/categories/%E5%88%9B%E4%B8%9A/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[HTML In TextView]]></title>
    <link href="https://hwangjr.github.io/2015/07/29/HTML-In-TextView/"/>
    <id>https://hwangjr.github.io/2015/07/29/HTML-In-TextView/</id>
    <published>2015-07-29T07:50:06.000Z</published>
    <updated>2015-07-29T07:50:24.708Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>往往我们会遇到效果图中需要展示多个颜色的文字，不同的大小，甚至有可能会遇到多个排版，这时候，如果我们全部用TextView，有时候一个字就因为颜色不同就得新建一个TextView，是很浪费。这时候，我们可以适当考虑HTML来排版并显示在TextView中。<br>目前在GITHUB上面已经开源一个Html TextView库，有学习价值，有兴趣可以参考：<a href="https://github.com/sufficientlysecure/html-textview" target="_blank" rel="external">html-textview</a></p>
<h2 id="HTML在string-xml中">HTML在string.xml中</h2><p>在string.xml中是无法直接写html，下面实例包括字符替换和HTML示例。<br>string.xml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name=<span class="string">"format_temp"</span>&gt;&lt;![CDATA[&lt;font color=\<span class="string">"#9d9d9d\"&gt;%1<span class="variable">$s</span>&lt;/font&gt; 收到@&lt;font color=\"#dd3a37\"&gt;%2<span class="variable">$s</span>&lt;/font&gt;的示例]]&gt;&lt;/string&gt;</span><br><span class="line">// 或者使用转意</span><br><span class="line">&lt;string name="</span>format_temp<span class="string">"&gt;Text: &amp;lt;b&gt;%s&amp;lt;/b&gt;&lt;/string&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.format(getString(R.string.format_temp)), <span class="string">"刚刚"</span>, <span class="string">"大胖"</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="在TextView中的使用">在TextView中的使用</h2><h3 id="文本展示">文本展示</h3><p>单纯文本展示直接使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动</span></span><br><span class="line">TextView.setMovementMethod(ScrollingMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure></p>
<h3 id="超链接展示">超链接展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure>
<p>或者设置TextView的autoLink为all<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"all"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"web|email"</span> /&gt;</span><br><span class="line"></span><br><span class="line">TextView.setAutoLinkMask(Linkify.ALL);</span><br><span class="line">TextView.setAutoLinkMask(Linkify.EMAIL_ADDRESSES|Linkify.WEB_URLS);</span><br></pre></td></tr></table></figure></p>
<h3 id="图片展示">图片展示</h3><p>在Html的fromHtml方法中，可以传入Html的ImageGetter。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TextView.setText(Html.fromHtml(html, <span class="keyword">new</span> ImageGetter(), <span class="keyword">null</span>));</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageGetter</span> <span class="keyword">implements</span> <span class="title">Html</span>.<span class="title">ImageGetter</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">		Drawable d = getResources().getDrawable(R.drawable.ic_launch);</span><br><span class="line">		d.setBounds(<span class="number">0</span>,<span class="number">0</span>,d.getIntrinsicWidth(),d.getIntrinsicHeight());</span><br><span class="line">		<span class="keyword">return</span> d;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="自定义TAG展示">自定义TAG展示</h3><p>这时，我们需要用到我们最后一个传入参数，<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Html.TagHandler.html" target="_blank" rel="external">Html.TagHandler</a>。简单示例一个size的标签。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SizeLabel</span> <span class="keyword">implements</span> <span class="title">TagHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SizeLabel</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTag</span><span class="params">(<span class="keyword">boolean</span> opening, String tag, Editable output,</span><br><span class="line">                          XMLReader xmlReader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * 参数： </span><br><span class="line">         * opening：为true时表示开始解析,为false时表示解析完 </span><br><span class="line">         * tag:当前解析的标签 </span><br><span class="line">         * output:文本中的内容 </span><br><span class="line">         * xmlReader:xml解析器 </span><br><span class="line">         */</span></span><br><span class="line">        <span class="comment">// 判断当前解析的tag是否为size,并且已经解析完毕(在没有解析完毕之前output中没有数据)  </span></span><br><span class="line">        <span class="keyword">if</span> (tag.toLowerCase().equals(<span class="string">"size"</span>) &amp;&amp; !opening) &#123;</span><br><span class="line">            <span class="comment">// 通过output调用setSpan方法,改变文本的0下标到最后的下标的大小;  </span></span><br><span class="line">            <span class="comment">// 最后的参数用来标识在span范围内的文本前后输入新的字符时是否也改变它们的效果;  </span></span><br><span class="line">            output.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(size), <span class="number">0</span>, output.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="支持的HTML标签">支持的HTML标签</h2><p>并不是所有的HTML标签都支持，目前支持的标签分为两类：<br>1 . 静态string资源中，解析是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/content/res/StringBlock.java" target="_blank" rel="external">android.content.res.StringBlock</a>类来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：支持href属性</span><br><span class="line"><span class="tag">&lt;<span class="title">annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：支持height, size, fgcolor和bicolor</span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2 . Html.fromHtml方法中支持是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/text/Html.java" target="_blank" rel="external">Html.java</a>来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：href</span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">cite</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dfn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">em</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：color和face属性</span><br><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> - <span class="tag">&lt;<span class="title">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span>&gt;</span>：支持src属性，需要实现ImageGetter接口</span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>另外，font的color属性除了直接支持颜色色值之外，还支持一些颜色的直接名字，<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/graphics/java/android/graphics/Color.java" target="_blank" rel="external">Color.java</a>的getHtmlColor方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">black</span><br><span class="line">darkgray</span><br><span class="line">gray</span><br><span class="line">lightgray</span><br><span class="line">white</span><br><span class="line">red</span><br><span class="line">green</span><br><span class="line">blue</span><br><span class="line">yellow</span><br><span class="line">cyan</span><br><span class="line">magenta</span><br><span class="line">aqua</span><br><span class="line">fuchsia</span><br><span class="line">darkgrey</span><br><span class="line">grey</span><br><span class="line">lightgrey</span><br><span class="line">lime</span><br><span class="line">maroon</span><br><span class="line">navy</span><br><span class="line">olive</span><br><span class="line">purple</span><br><span class="line">silver</span><br><span class="line">teal</span><br></pre></td></tr></table></figure></p>
<h2 id="简单原理剖析">简单原理剖析</h2><p>其实这主要是用到了<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Spannable.html" target="_blank" rel="external">Spannable</a>接口。里面已经实现了SpannableString及setSpan即可得到我们想要的风格。</p>
<h3 id="简单使用">简单使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpannableString text = <span class="keyword">new</span> SpannableString(<span class="string">"Test"</span>);</span><br><span class="line">TextView.setText(text);</span><br></pre></td></tr></table></figure>
<h3 id="字体样式">字体样式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setSpan会将start到end这间的文本设置成创建的span格式。span可以是图片格式。</span></span><br><span class="line"><span class="comment">// 设置字体(default,default-bold,monospace,serif,sans-serif)</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"monospace"</span>), <span class="number">0</span>, <span class="number">2</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 等宽字体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"serif"</span>), <span class="number">2</span>, <span class="number">4</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 衬线字体</span></span><br></pre></td></tr></table></figure>
<h3 id="字体绝对大小">字体绝对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体绝对大小（绝对值,单位：像素）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>), <span class="number">4</span>, <span class="number">6</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 第二个参数boolean dip，如果为true，表示前面的字体大小单位为dip，否则为像素，同上。</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>, <span class="keyword">true</span>), <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="字体相对大小">字体相对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体相对大小（相对值,单位：像素） 参数表示为默认字体大小的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">0.5f</span>), <span class="number">8</span>, <span class="number">10</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 0.5f表示默认字体大小的一半</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">2.0f</span>), <span class="number">10</span>, <span class="number">12</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体大小的两倍</span></span><br></pre></td></tr></table></figure>
<h3 id="前景色和背景色">前景色和背景色</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体前景色 ，Color.MAGENTA为紫红</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ForegroundColorSpan(Color.MAGENTA), <span class="number">12</span>, <span class="number">15</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置前景色为洋红色</span></span><br><span class="line"><span class="comment">// 设置字体背景色 ，Color.CYAN为青绿色</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> BackgroundColorSpan(Color.CYAN), <span class="number">15</span>, <span class="number">18</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置背景色为青色</span></span><br></pre></td></tr></table></figure>
<h3 id="设置字体粗体、斜体、粗斜体">设置字体粗体、斜体、粗斜体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体样式正常，粗体，斜体，粗斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.NORMAL), <span class="number">18</span>, <span class="number">20</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 正常</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD), <span class="number">20</span>, <span class="number">22</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.ITALIC), <span class="number">22</span>, <span class="number">24</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD_ITALIC), <span class="number">24</span>, <span class="number">27</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗斜体</span></span><br></pre></td></tr></table></figure>
<h3 id="设置下划线和删除线">设置下划线和删除线</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置下划线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> UnderlineSpan(), <span class="number">27</span>, <span class="number">30</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 设置删除线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">30</span>, <span class="number">33</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="设置下标和上标">设置下标和上标</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text.setSpan(<span class="keyword">new</span> SubscriptSpan(), <span class="number">34</span>, <span class="number">35</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 下标</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> SuperscriptSpan(), <span class="number">36</span>, <span class="number">37</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 上标</span></span><br></pre></td></tr></table></figure>
<h3 id="设置超链接">设置超链接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超级链接（需要添加setMovementMethod方法附加响应）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"tel:13888888888"</span>), <span class="number">37</span>, <span class="number">39</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 电话</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mailto:google@google.com"</span>), <span class="number">39</span>, <span class="number">41</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 邮件</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"http://www.google.com"</span>), <span class="number">41</span>, <span class="number">43</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// URL</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"sms:13888888888"</span>), <span class="number">43</span>, <span class="number">45</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 短信，使用sms:或者smsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mms:13888888888"</span>), <span class="number">45</span>, <span class="number">47</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 彩信，使用mms:或者mmsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"geo:38.899533,-77.036476"</span>), <span class="number">47</span>, <span class="number">49</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 地图</span></span><br></pre></td></tr></table></figure>
<h3 id="拉伸字体">拉伸字体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体大小（相对值,单位：像素） 参数表示为默认字体宽度的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ScaleXSpan(<span class="number">2.0f</span>), <span class="number">49</span>, <span class="number">51</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体宽度的两倍，即X轴方向放大为默认字体的两倍，而高度不变</span></span><br></pre></td></tr></table></figure>
<h2 id="Ref">Ref</h2><p><a href="http://aichixihongshi.iteye.com/blog/1207503" target="_blank" rel="external">android中用Spannable在TextView中设置超链接、颜色、字体</a><br><a href="https://commonsware.com/blog/Android/2010/05/26/html-tags-supported-by-textview.html" target="_blank" rel="external">HTML Tags Supported By TextView</a><br><a href="http://daniel-codes.blogspot.com/2011/04/html-in-textviews.html" target="_blank" rel="external">HTML in TextViews</a></p>
]]></content>
    <summary type="html">
    <![CDATA[HTML样式在展示方面可以方便很多，比如文本的颜色、图片获取等，在TextView中也是可以展示HTML的，只不过需要做一定的处理即可。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[破解Beyond Compare]]></title>
    <link href="https://hwangjr.github.io/2015/07/13/%E7%A0%B4%E8%A7%A3Beyond-Compare/"/>
    <id>https://hwangjr.github.io/2015/07/13/破解Beyond-Compare/</id>
    <published>2015-07-13T10:15:26.000Z</published>
    <updated>2015-09-15T10:14:42.219Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>好吧，要支持原版<a href="http://www.scootersoftware.com/download.php" target="_blank" rel="external">BCompare</a>！</p>
<h2 id="Linux破解">Linux破解</h2><p>破解相对简单：</p>
<ol>
<li>修改BCompare的KEY，让它可以使用生成的KEY就可以了。<br>ubuntu下安装deb，目录在/usr/lib/beyondcompare/下。<br>将：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keexjEP3t4Mue23hrnuPtY4TdcsqNiJL-<span class="number">5174</span>TsUdLmJSIXKfG2NGPwBL6vnRPddT7tH29qpkneX63DO9ECSPE9rzY1zhThHERg8lHM9IBFT+rVuiY823aQJuqzxCKIE1bcDqM4wgW01FH6oCBP1G4ub01xmb4BGSUG6ZrjxWHJyNLyIlGvOhoY2HAYzEtzYGwxFZn2JZ66o4RONkXjX0DF9EzsdUef3UAS+JQ+fCYReLawdjEe6tXCv88GKaaPKWxCeaUL9PejICQgRQOLGOZtZQkLgAelrOtehxz5ANOOqCaJgy2mJLQVLM5SJ9Dli909c5ybvEhVmIC0dc9dWH+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>修改为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N9KmiLVlKMU7RJqnE+WXEEPI1SgglmfmLc1yVH7dqBb9ehOoKG9UE+HAE1YvH1XX2XVGeEqYUY-Tsk7YBTz0WpSpoYyPgx6Iki5KLtQ5G<span class="operator">-a</span>KP9eysnkuOAkrvHU8bLbGtZteGwJarev03PhfCioJL4OSqsmQGEvDbHFEbNl1qJtdwEriR+VNZts9vNNLk7UGfeNwIiqpxjk4Mn09nmSd8FhM4ifvcaIbNCRoMPGl6KU12iseSe+w+<span class="number">1</span>kFsLhX+OhQM8WXcWV10cGqBzQE9OqOLUcg9n0krrR3KrohstS9smTwEx9olyLYppvC0p5i7dAx2deWvM1ZxKNs0BvcXGukR+</span><br></pre></td></tr></table></figure></p>
<p>Linux命令为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">"s/keexjEP3t4Mue23hrnuPtY4TdcsqNiJL-5174TsUdLmJSIXKfG2NGPwBL6vnRPddT7tH29qpkneX63DO9ECSPE9rzY1zhThHERg8lHM9IBFT+rVuiY823aQJuqzxCKIE1bcDqM4wgW01FH6oCBP1G4ub01xmb4BGSUG6ZrjxWHJyNLyIlGvOhoY2HAYzEtzYGwxFZn2JZ66o4RONkXjX0DF9EzsdUef3UAS+JQ+fCYReLawdjEe6tXCv88GKaaPKWxCeaUL9PejICQgRQOLGOZtZQkLgAelrOtehxz5ANOOqCaJgy2mJLQVLM5SJ9Dli909c5ybvEhVmIC0dc9dWH+/N9KmiLVlKMU7RJqnE+WXEEPI1SgglmfmLc1yVH7dqBb9ehOoKG9UE+HAE1YvH1XX2XVGeEqYUY-Tsk7YBTz0WpSpoYyPgx6Iki5KLtQ5G-aKP9eysnkuOAkrvHU8bLbGtZteGwJarev03PhfCioJL4OSqsmQGEvDbHFEbNl1qJtdwEriR+VNZts9vNNLk7UGfeNwIiqpxjk4Mn09nmSd8FhM4ifvcaIbNCRoMPGl6KU12iseSe+w+1kFsLhX+OhQM8WXcWV10cGqBzQE9OqOLUcg9n0krrR3KrohstS9smTwEx9olyLYppvC0p5i7dAx2deWvM1ZxKNs0BvcXGukR+/g"</span> BCompare</span><br></pre></td></tr></table></figure></p>
<p>如果有权限问题：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">755</span> BCompare</span><br></pre></td></tr></table></figure></p>
<ol>
<li>打开软件，会提示Trial Mode Error！表示成功！输入Team ZWT生成的密钥，即可注册成功！</li>
</ol>
<h2 id="其他系统">其他系统</h2><p>此方法适用所有系统，包括win和os x！</p>
<h2 id="下载">下载</h2><p>Beyond Compare 4破解<a href="http://pan.baidu.com/s/1eQuGh6E" target="_blank" rel="external">下载地址</a>。</p>
]]></content>
    <summary type="html">
    <![CDATA[利用Team ZWT来进行各个版本破解。]]>
    
    </summary>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/categories/tech/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android Fragment - No View Found For ID Error]]></title>
    <link href="https://hwangjr.github.io/2015/07/13/Android-Fragment-No-View-Found-For-ID-Error/"/>
    <id>https://hwangjr.github.io/2015/07/13/Android-Fragment-No-View-Found-For-ID-Error/</id>
    <published>2015-07-13T03:26:23.000Z</published>
    <updated>2015-07-13T03:27:06.948Z</updated>
    <content type="html"><![CDATA[<h2 id="说明">说明</h2><p>项目中很经常用到TAB，TAB不可避免就用到了ViewPager和FragmentPagerAdapter，这里不讨论<a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/app/FragmentPagerAdapter.html" target="_blank" rel="external">FragmentPagerAdapter</a>和<a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/app/FragmentStatePagerAdapter.html" target="_blank" rel="external">FragmentStatePagerAdapter</a>的<a href="http://stackoverflow.com/questions/18747975/difference-between-fragmentpageradapter-and-fragmentstatepageradapter" target="_blank" rel="external">区别</a>。<br>目前我遇到的问题，是在Pager Resume之后，会导致无法找到View ID，目前确认是因为View的Resume顺序导致的问题，在pager的fragment还未resume，而fragment下面的fragment已经开始恢复，导致视图找不到。目前还未有好的解决方案，故直接Pager持有，后面再解决。</p>
<h2 id="问题原因">问题原因</h2><h3 id="IDE问题">IDE问题</h3><p>在发生View问题时，如果是Eclipse或者是AS，都可以尝试clean下，然后再试试，特别是Eclipse比较经常发生这类问题！</p>
<h3 id="真的没ID">真的没ID</h3><p>再确认下自身XML布局，只有在content view中有这个ID，才能找到对应的View ID。<br>另外，也需要确认就是，R.id，而不是R.layout。</p>
<h3 id="FragmentManager获取错误">FragmentManager获取错误</h3><p>如果是在Fragment里面使用Fragment，那么要用<a href="http://developer.android.com/reference/android/app/Fragment.html#getChildFragmentManager(" target="_blank" rel="external">getChildFragmentManager()</a>)替代getSupportFragmentManager()，这会为当前Fragment创建一个FragmentManager，并与当前的Fragment生命周期相关联起来。具体可以参考<a href="http://developer.android.com/intl/zh-cn/about/versions/android-4.2.html#NestedFragments" target="_blank" rel="external">NestedFragments</a>。需要注意的是，如果使用Nested Fragments，是无法使用XML布局实现，需要在代码中动态添加Fragment。<br>如果需要其他的解决方案，网上也有一些可以参考的<a href="http://stackoverflow.com/questions/15608935/best-practice-for-nested-fragments-in-android-4-0-4-1-4-2-without-using-the" target="_blank" rel="external">事例</a>和<a href="https://gist.github.com/chrisjenx/3405429" target="_blank" rel="external">代码</a>。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You can now embed fragments inside fragments. This is useful <span class="keyword">for</span> a variety of situations <span class="keyword">in</span> <span class="built_in">which</span> you want to place dynamic and re-usable UI components into a UI component that is itself dynamic and re-usable. For example, <span class="keyword">if</span> you use ViewPager to create fragments that swipe left and right and consume a majority of the screen space, you can now insert fragments into each fragment page.</span><br></pre></td></tr></table></figure></p>
<h3 id="找不到的ID是0xFFFFFFFF">找不到的ID是0xFFFFFFFF</h3><p>ViewPager是一定要设置ID的，如果没有设置ID就会有这个问题。具体可以参考<a href="http://setohide.blogspot.se/2012/03/no-view-found-for-id-0xffffffff-for.html" target="_blank" rel="external">这里</a>。</p>
<h3 id="ID混乱">ID混乱</h3><p>如果你的视图中，有多个相同ID，那么也有可能会造成混乱，所以ID最好是唯一的，酱紫可以方便问题排查。</p>
<h3 id="旋转屏幕时错误">旋转屏幕时错误</h3><p>如果是在旋转屏幕时候有这个错误，那么可以考虑是否忘记移除setRetainInstance(true)的调用了。屏幕旋转如果没有处理，会重新初始化视图，那么有可能多个视图就会找不到ID了。</p>
<h3 id="DialogFragment里有ViewPager时错误">DialogFragment里有ViewPager时错误</h3><p>在使用Fragment的时候，如果里面有ViewPager的话，是需要传入getChildFragmentManager的，而不是getSupportFragmentManager，否则就会导致这个错误。</p>
<h3 id="视图还未建立，而ViewPager已经开始加载了">视图还未建立，而ViewPager已经开始加载了</h3><p>这个问题比较麻烦，所以才放到最后。<br>1、放到onActivityCreated的时候再操作Fragment，而不是在onCreateView的时候操作。<br>2、如果是ViewPager里面有ViewPager的话，那么考虑延迟恢复ViewPager视图，具体可参考<a href="http://stackoverflow.com/questions/19888539/illegalargumentexception-no-view-found-for-id-for-fragment-viewpager-in-vie" target="_blank" rel="external">这里</a>，关键代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerViewPager</span> <span class="keyword">extends</span> <span class="title">ViewPager</span> </span>&#123;</span><br><span class="line">    PagerAdapter mPagerAdapter;</span><br><span class="line"> </span><br><span class="line">    <span class="annotation">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow(); </span><br><span class="line">        <span class="keyword">if</span> (mPagerAdapter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">super</span>.setAdapter(mPagerAdapter);</span><br><span class="line">            mPageIndicator.setViewPager(<span class="keyword">this</span>);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="annotation">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PagerAdapter adapter)</span> </span>&#123;</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeAdapter</span><span class="params">(PagerAdapter pagerAdapter)</span> </span>&#123;</span><br><span class="line">        mPagerAdapter = pagerAdapter;</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BannerViewPager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BannerViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        convertView = getBannerView(mParent);</span><br><span class="line">    &#125; </span><br><span class="line">    mViewPager = (ViewPager) convertView;</span><br><span class="line">    <span class="keyword">if</span> (mBanners != <span class="keyword">null</span> &amp;&amp; !mBanners.isEmpty()) &#123; </span><br><span class="line">        <span class="keyword">if</span> (mPagerAdapter == <span class="keyword">null</span>) &#123; </span><br><span class="line">            FragmentManager childFM = mFragment.getChildFragmentManager(); </span><br><span class="line">            removeOldFragment(childFM); </span><br><span class="line">            mPagerAdapter = <span class="keyword">new</span> ScreenSlidePagerAdapter(childFM, mBanners); </span><br><span class="line">            mViewPager.setAdapter(mPagerAdapter); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeOldFragment</span><span class="params">(FragmentManager fm)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">        Field added = fm.getClass().getDeclaredField(<span class="string">"mAdded"</span>);</span><br><span class="line">        added.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        added.set(fm, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">        Field active = fm.getClass().getDeclaredField(<span class="string">"mActive"</span>);</span><br><span class="line">        active.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        active.set(fm, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ref">Ref</h2><p><a href="http://solvedstack.com/questions/android-fragment-no-view-found-for-id" target="_blank" rel="external">android-fragment-no-view-found-for-id</a><br><a href="http://stackoverflow.com/questions/19888539/illegalargumentexception-no-view-found-for-id-for-fragment-viewpager-in-vie" target="_blank" rel="external">IllegalArgumentException: No view found for id for fragment — ViewPager in ViewPager</a></p>
]]></content>
    <summary type="html">
    <![CDATA[在使用Android Fragment的时候，配合新的ViewPager、FragmentPagerAdapter，会经常发生No View Found For ID Error，本文总结下此错误经常是什么原因导致。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android 实现毛玻璃效果]]></title>
    <link href="https://hwangjr.github.io/2015/07/10/Android-%E5%AE%9E%E7%8E%B0%E6%AF%9B%E7%8E%BB%E7%92%83%E6%95%88%E6%9E%9C/"/>
    <id>https://hwangjr.github.io/2015/07/10/Android-实现毛玻璃效果/</id>
    <published>2015-07-10T12:05:22.000Z</published>
    <updated>2015-07-10T12:05:49.253Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>由于项目需要，需要实现毛玻璃效果，就是高斯模糊效果，实现方式如下。</p>
<h2 id="利用V_8包提供Render接口实现">利用V 8包提供Render接口实现</h2><p>利用现有ANDROID结构，通过RenderScript调用底层接口来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">blur</span><span class="params">(Bitmap bkg, View view)</span> </span>&#123;</span><br><span class="line">    …</span><br><span class="line">    RenderScript rs = RenderScript.create(getActivity());</span><br><span class="line">    Allocation overlayAlloc = Allocation.createFromBitmap(rs, overlay);</span><br><span class="line">    ScriptIntrinsicBlur blur = </span><br><span class="line">        ScriptIntrinsicBlur.create(rs, overlayAlloc.getElement());</span><br><span class="line">    blur.setInput(overlayAlloc);</span><br><span class="line">    blur.setRadius(radius);</span><br><span class="line">    blur.forEach(overlayAlloc);</span><br><span class="line">    overlayAlloc.copyTo(overlay);</span><br><span class="line">    view.setBackground(<span class="keyword">new</span> BitmapDrawable(getResources(), overlay));</span><br><span class="line">    rs.destroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这种方法直接利用Android系统提供的机制，从代码实现上是最简单也相对高效的实现。在此过程中遇到的很现实的问题是，直接使用ScriptIntrinsicBlur不能得到模糊程度较高的图片：</p>
<ol>
<li>当模糊半径 (radius)变大后会直接出现计算性能问题。</li>
<li>ScriptIntrinsicBlur脚本模糊半径不能大于25。<br>考虑到高斯模糊是计算周边像素平均值，在模糊程度很高的情况下，逐点计算平均值从显示效果上优势并不明显。可以通过将图片压缩成小图，计算小图的高斯模糊，再将小图放大的方法来模拟大半径高斯模糊的效果。</li>
</ol>
<h2 id="Java版实现">Java版实现</h2><p>这种方式通过在Java层中直接实现高斯模糊算法。在大模糊半径和大图片情况下，性能会出现问题。基本目前只作为对低版本Android客户端的兼容性方案使用。<br><a href="https://github.com/paveldudka/blurring/blob/master/app/src/main/java/com/paveldudka/util/FastBlur.java" target="_blank" rel="external">blurring/FastBlur.java</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/** </span><br><span class="line"> * Created by paveld on 3/6/14. </span><br><span class="line"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastBlur</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">doBlur</span><span class="params">(Bitmap sentBitmap, <span class="keyword">int</span> radius, <span class="keyword">boolean</span> canReuseInBitmap)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Stack Blur v1.0 from </span></span><br><span class="line">        <span class="comment">// http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// Java Author: Mario Klingemann &lt;mario at quasimondo.com&gt; </span></span><br><span class="line">        <span class="comment">// http://incubator.quasimondo.com </span></span><br><span class="line">        <span class="comment">// created Feburary 29, 2004 </span></span><br><span class="line">        <span class="comment">// Android port : Yahel Bouaziz &lt;yahel at kayenko.com&gt; </span></span><br><span class="line">        <span class="comment">// http://www.kayenko.com </span></span><br><span class="line">        <span class="comment">// ported april 5th, 2012 </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// This is a compromise between Gaussian Blur and Box blur </span></span><br><span class="line">        <span class="comment">// It creates much better looking blurs than Box Blur, but is </span></span><br><span class="line">        <span class="comment">// 7x faster than my Gaussian Blur implementation. </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// I called it Stack Blur because this describes best how this </span></span><br><span class="line">        <span class="comment">// filter works internally: it creates a kind of moving stack </span></span><br><span class="line">        <span class="comment">// of colors whilst scanning through the image. Thereby it </span></span><br><span class="line">        <span class="comment">// just has to add one new block of color to the right side </span></span><br><span class="line">        <span class="comment">// of the stack and remove the leftmost color. The remaining </span></span><br><span class="line">        <span class="comment">// colors on the topmost layer of the stack are either added on </span></span><br><span class="line">        <span class="comment">// or reduced by one, depending on if they are on the right or </span></span><br><span class="line">        <span class="comment">// on the left side of the stack. </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// If you are using this algorithm in your code please add </span></span><br><span class="line">        <span class="comment">// the following line: </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// Stack Blur Algorithm by Mario Klingemann &lt;mario@quasimondo.com&gt; </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        Bitmap bitmap;</span><br><span class="line">        <span class="keyword">if</span> (canReuseInBitmap) &#123;</span><br><span class="line">            bitmap = sentBitmap;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            bitmap = sentBitmap.copy(sentBitmap.getConfig(), <span class="keyword">true</span>);</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (radius &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">null</span>); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> w = bitmap.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h = bitmap.getHeight();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span>[] pix = <span class="keyword">new</span> <span class="keyword">int</span>[w * h];</span><br><span class="line">        bitmap.getPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> wm = w - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> hm = h - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> wh = w * h;</span><br><span class="line">        <span class="keyword">int</span> div = radius + radius + <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> r[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> g[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> b[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> rsum, gsum, bsum, x, y, i, p, yp, yi, yw;</span><br><span class="line">        <span class="keyword">int</span> vmin[] = <span class="keyword">new</span> <span class="keyword">int</span>[Math.max(w, h)];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> divsum = (div + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        divsum *= divsum;</span><br><span class="line">        <span class="keyword">int</span> dv[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span> * divsum];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span> * divsum; i++) &#123;</span><br><span class="line">            dv[i] = (i / divsum);</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        yw = yi = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span>[][] stack = <span class="keyword">new</span> <span class="keyword">int</span>[div][<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> stackpointer;</span><br><span class="line">        <span class="keyword">int</span> stackstart;</span><br><span class="line">        <span class="keyword">int</span>[] sir;</span><br><span class="line">        <span class="keyword">int</span> rbs;</span><br><span class="line">        <span class="keyword">int</span> r1 = radius + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> routsum, goutsum, boutsum;</span><br><span class="line">        <span class="keyword">int</span> rinsum, ginsum, binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                p = pix[yi + Math.min(wm, Math.max(i, <span class="number">0</span>))];</span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line">                rsum += sir[<span class="number">0</span>] * rbs;</span><br><span class="line">                gsum += sir[<span class="number">1</span>] * rbs;</span><br><span class="line">                bsum += sir[<span class="number">2</span>] * rbs;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            stackpointer = radius;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                r[yi] = dv[rsum];</span><br><span class="line">                g[yi] = dv[gsum];</span><br><span class="line">                b[yi] = dv[bsum];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[x] = Math.min(x + radius + <span class="number">1</span>, wm);</span><br><span class="line">                &#125; </span><br><span class="line">                p = pix[yw + vmin[x]];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[(stackpointer) % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                yi++;</span><br><span class="line">            &#125; </span><br><span class="line">            yw += w;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            yp = -radius * w;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                yi = Math.max(<span class="number">0</span>, yp) + x;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = r[yi];</span><br><span class="line">                sir[<span class="number">1</span>] = g[yi];</span><br><span class="line">                sir[<span class="number">2</span>] = b[yi];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += r[yi] * rbs;</span><br><span class="line">                gsum += g[yi] * rbs;</span><br><span class="line">                bsum += b[yi] * rbs;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (i &lt; hm) &#123;</span><br><span class="line">                    yp += w;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            yi = x;</span><br><span class="line">            stackpointer = radius;</span><br><span class="line">            <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">                <span class="comment">// Preserve alpha channel: ( 0xff000000 &amp; pix[yi] ) </span></span><br><span class="line">                pix[yi] = (<span class="number">0xff000000</span> &amp; pix[yi]) | (dv[rsum] &lt;&lt; <span class="number">16</span>) | (dv[gsum] &lt;&lt; <span class="number">8</span>) | dv[bsum];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[y] = Math.min(y + r1, hm) * w;</span><br><span class="line">                &#125; </span><br><span class="line">                p = x + vmin[y];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = r[p];</span><br><span class="line">                sir[<span class="number">1</span>] = g[p];</span><br><span class="line">                sir[<span class="number">2</span>] = b[p];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[stackpointer];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                yi += w;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        bitmap.setPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> (bitmap);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二个方式通过直接计算高斯并直接在视图画布上实现。<br>BlurLinearLayout.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BlurCalculate mBlurCalculate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurLinearLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        mBlurCalculate = <span class="keyword">new</span> BlurCalculate(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurLinearLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * radius for linearlayout**</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBlurCalculate != <span class="keyword">null</span>)</span><br><span class="line">            mBlurCalculate.setRadius(radius);</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow();</span><br><span class="line">        mBlurCalculate.onAttachedToWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">        mBlurCalculate.bluronDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBlurCalculate.isCanvasChanged(canvas))</span><br><span class="line">            mBlurCalculate.blurCanvas();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            mBlurCalculate.drawCanvas(canvas);</span><br><span class="line">            <span class="keyword">super</span>.dispatchDraw(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>BlurCalculate.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.Allocation;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.Element;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.RenderScript;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.ScriptIntrinsicBlur;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewTreeObserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurCalculate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> BITMAP_RATIO = <span class="number">0.1f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View mView;</span><br><span class="line">    <span class="keyword">private</span> Bitmap mBitmap;</span><br><span class="line">    <span class="keyword">private</span> Canvas mCanvas;</span><br><span class="line">    <span class="keyword">private</span> Rect mRect;</span><br><span class="line">    <span class="keyword">private</span> Matrix mMatrix;</span><br><span class="line">    <span class="keyword">private</span> Matrix mDrawMatrix;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRealHeight, mRealWidth;</span><br><span class="line">    <span class="keyword">private</span> RenderScript mRenderScript;</span><br><span class="line">    <span class="keyword">private</span> Allocation mInput;</span><br><span class="line">    <span class="keyword">private</span> Allocation mOutput;</span><br><span class="line">    <span class="keyword">private</span> ScriptIntrinsicBlur mScript;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRadius = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mAction = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurCalculate</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mView = view;</span><br><span class="line">        mRenderScript = RenderScript.create(view.getContext());</span><br><span class="line">        mCanvas = <span class="keyword">new</span> Canvas();</span><br><span class="line">        mRect = <span class="keyword">new</span> Rect();</span><br><span class="line">        mMatrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">        mDrawMatrix = <span class="keyword">new</span> Matrix();</span><br><span class="line"></span><br><span class="line">        mDrawMatrix.setScale(<span class="number">10.0f</span>, <span class="number">10.0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAction</span><span class="params">(<span class="keyword">int</span> action)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mAction = action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCanvasChanged</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> canvas == mCanvas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getViewTreeObserver().addOnPreDrawListener(onPreDrawListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bluronDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getViewTreeObserver().removeOnPreDrawListener(onPreDrawListener);</span><br><span class="line">        <span class="keyword">if</span> (mBitmap != <span class="keyword">null</span>)</span><br><span class="line">            mBitmap.recycle();</span><br><span class="line">        mBitmap = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCanvas</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBitmap != <span class="keyword">null</span>)</span><br><span class="line">            canvas.drawBitmap(mBitmap, mDrawMatrix, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blurCanvas</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mInput = Allocation.createFromBitmap(mRenderScript, mBitmap, Allocation.MipmapControl.MIPMAP_NONE,</span><br><span class="line">                Allocation.USAGE_SCRIPT);</span><br><span class="line">        mOutput = Allocation.createTyped(mRenderScript, mInput.getType());</span><br><span class="line">        mScript = ScriptIntrinsicBlur.create(mRenderScript, Element.U8_4(mRenderScript));</span><br><span class="line">        mScript.setRadius(mRadius);</span><br><span class="line">        mScript.setInput(mInput);</span><br><span class="line">        mScript.forEach(mOutput);</span><br><span class="line">        mOutput.copyTo(mBitmap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mRadius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getScreenBitmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getGlobalVisibleRect(mRect);</span><br><span class="line">        mRealHeight = mView.getHeight();</span><br><span class="line">        mRealWidth = mView.getWidth();</span><br><span class="line">        <span class="keyword">int</span> w = Math.round(mRealWidth * BITMAP_RATIO) + <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">int</span> h = Math.round(mRealHeight * BITMAP_RATIO) + (mAction == <span class="number">0</span> ? -<span class="number">4</span> : <span class="number">4</span>);</span><br><span class="line">        w = w &amp; ~<span class="number">0x03</span>;</span><br><span class="line">        h = h &amp; ~<span class="number">0x03</span>;</span><br><span class="line">        <span class="keyword">if</span> (w &lt;= <span class="number">0</span> || h &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (mBitmap == <span class="keyword">null</span> || mBitmap.getWidth() != w || mBitmap.getHeight() != h) &#123;</span><br><span class="line">            mBitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">            mMatrix.setScale(BITMAP_RATIO, BITMAP_RATIO);</span><br><span class="line">            mMatrix.invert(mDrawMatrix);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(mView.getBottom()-mView.getTop())</span></span><br><span class="line">        <span class="keyword">float</span> dx = -(Math.min(<span class="number">0</span>, mView.getLeft()) + mRect.left);</span><br><span class="line">        <span class="keyword">float</span> dy = mAction == <span class="number">0</span> ? (-(Math.min(<span class="number">0</span>, mView.getTop()) + mRect.top)) : -(mRect.bottom - ((mView.getBottom() - mView.getTop())));</span><br><span class="line">        mCanvas.restoreToCount(<span class="number">1</span>);</span><br><span class="line">        mCanvas.setBitmap(mBitmap);</span><br><span class="line">        mCanvas.setMatrix(mMatrix);</span><br><span class="line">        mCanvas.translate(dx, dy);</span><br><span class="line">        mCanvas.save();</span><br><span class="line">        mView.getRootView().draw(mCanvas);</span><br><span class="line">        <span class="comment">//mCanvas.setBitmap(null);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ViewTreeObserver.OnPreDrawListener onPreDrawListener = <span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (mView.getVisibility() == View.VISIBLE)</span><br><span class="line">                getScreenBitmap();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果是android studio的话，添加V8包方法：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    renderscriptTargetApi <span class="number">18</span></span><br><span class="line">    renderscriptSupportModeEnabled <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="第三方库实现">第三方库实现</h2><p><a href="https://github.com/harism/android_anndblur" target="_blank" rel="external">android_anndblur</a>:<br>Project for implementing background blur effect for Android devices<br><a href="https://github.com/kikoso/android-stackblur" target="_blank" rel="external">android-stackblur</a>:<br>Android StackBlur is a library that can perform a blurry effect on a Bitmap based on a gradient or radius, and return the result. The library is based on the code of Mario Klingemann.</p>
<h2 id="OpenGL实现">OpenGL实现</h2><p>无论从效果和实时性来讲都是最好的，但需要根据需求来看是否真的有这样的实时性要求。这种方式从显示效果上会优于第一种方法，甚至可以达到渐变的效果，但这些计算都是以耗电作为代价的。作为Launcher这种系统级别的应用，在显示效果差异并不明显的情况下，建议综合考虑耗电量，以及内存和计算性能的消耗。</p>
<h2 id="Ref">Ref</h2><p><a href="https://github.com/paveldudka/blurring" target="_blank" rel="external">blurring</a><br><a href="http://www.zhihu.com/question/27017363" target="_blank" rel="external">Android（Android5.0）下毛玻璃（磨砂）效果如何实现？</a><br><a href="http://blog.jobbole.com/63894/" target="_blank" rel="external">Android高级模糊技术</a><br><a href="https://github.com/harism/android_anndblur" target="_blank" rel="external">android_anndblur</a><br><a href="https://github.com/kikoso/android-stackblur" target="_blank" rel="external">android-stackblur</a><br><a href="https://developer.android.com/intl/zh-cn/tools/support-library/features.html#v8" target="_blank" rel="external">v8 Support Library</a></p>
]]></content>
    <summary type="html">
    <![CDATA[Android下实现毛玻璃效果的几种方式。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android ToolBar Widget Usage]]></title>
    <link href="https://hwangjr.github.io/2015/07/10/Android-ToolBar-Widget-Usage/"/>
    <id>https://hwangjr.github.io/2015/07/10/Android-ToolBar-Widget-Usage/</id>
    <published>2015-07-10T08:03:39.000Z</published>
    <updated>2015-07-29T07:49:36.944Z</updated>
    <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>从2014年Google I/O大会发表了Material Design之后，其也开始陆陆续续更新了Android APP的界面设计接口，在ActionBar之后，Android在support library里面也提供了更多的API给开发者使用。在Material Design之中有一个名称为App Bar，用来取代过去的Action Bar控件，本篇就以此为引，为大家介绍下Tool Bar的使用和自定义。<br>在推出Material Design之后，官方在某些方面也感觉到ActionBar限制了应用开发的弹性，接下来，将分为基本用法、自定义控件及针对ToolBar的总结，为大家介绍下这个控件。</p>
<h2 id="基本用法">基本用法</h2><p>ToolBar已经集成在V7支持包中，要使用也相对较为简单，基本可分为三步：</p>
<ol>
<li>新增ToolBar样式</li>
<li>XML布局中新增ToolBar</li>
<li>在程序中替代ActionBar</li>
</ol>
<h3 id="一、新增ToolBar样式">一、新增ToolBar样式</h3><p>在低版本中，我们需要禁用windowActionBar及window title，在V21以上（5.0以上）可不用。<br>value/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme.Base"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat"</span>&gt;</span><span class="css"></span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowActionBar</span>"&gt;<span class="tag">false</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">windowNoTitle<span class="string">"&gt;true&lt;/item&gt;</span><br><span class="line">  </span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在新版本中，也可直接继承自Theme.AppCompat.NoActionBar。<br>values-v21/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="二、XML布局中新增ToolBar">二、XML布局中新增ToolBar</h3><p>新增布局文件toolbar_actionbar.xml文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"?actionBarSize"</span></span><br><span class="line">    <span class="attribute">android:background</span>=<span class="value">"@null"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>之后，在主XML布局文件中，即可以include方式集成：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">include</span> <span class="attribute">layout</span>=<span class="value">"@layout/toolbar_actionbar"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在使用过程中，也可自定义样式，比如text appearance等，增加对ToolBar的定制。</p>
<h3 id="三、程序中替代ActionBar">三、程序中替代ActionBar</h3><p>关键代码只有一行，即替代原有目前的ActionBar。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">setSupportActionBar(mActionBarToolbar);</span><br></pre></td></tr></table></figure></p>
<p>之后，即可使用mActionBarToolBar进行操作，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mActionBarToolbar.setTitle();</span><br><span class="line">mActionBarToolbar.setSubtitle();</span><br><span class="line">mActionBarToolbar.setNavigationIcon()</span><br><span class="line">mActionBarToolbar.setLogo()</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h3 id="四、单独使用而不与ActionBar进行关联">四、单独使用而不与ActionBar进行关联</h3><p>在前一节中设置与ActionBar进行关联，如果不进行关联也是可以使用。即执行方法：setSupportActionBar，那么Menu的操作也不用在onCreateOptionsMenu方法，直接使用ToolBar的inflateMenu方法，Menu的事件也是独立的，需要通过设置ToolBar的setOnMenuItemClickListener来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">toolbar.setOnMenuItemClickListener(<span class="keyword">new</span> Toolbar.OnMenuItemClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> id = menuItem.getItemId();</span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_add_new_item) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="自定义ToolBar">自定义ToolBar</h2><p>自定义ToolBar我们将从配色开始，到自定义我们的布局，比如Title居中等要求。</p>
<ol>
<li>自定义配色</li>
<li>ToolBar控件</li>
<li>自定义布局</li>
</ol>
<h3 id="一、自定义配色">一、自定义配色</h3><p>基本分为四块配色：<br>1、状态栏底色（看电量时间的那栏）：在style中设置主题的colorPrimaryDark属性<br>2、AppBar底色（应用栏）：分为两种，一个是ActionBar的话，在style中设置主题的colorPrimary属性；第二个是如果使用Tool Bar的话，直接设置ToolBar的background属性。<br>3、主窗口底色（就是我们AppBar下方的应用界面）：style设置主题windowBackground属性。<br>4、导航列底色：在V 21之后，在应用底部有新增导航列，即左右切换等快捷操作。在values-v21/style中设置主题的navigationBarColor属性。<br>values/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme.Base"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat"</span>&gt;</span><span class="css"></span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowActionBar</span>"&gt;<span class="tag">false</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">windowNoTitle<span class="string">"&gt;true&lt;/item&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;!-- Actionbar color --&gt;</span><br><span class="line">  &lt;item name="</span>colorPrimary<span class="string">"&gt;@color/accent_material_dark&lt;/item&gt;</span><br><span class="line">  &lt;!--Status bar color--&gt;</span><br><span class="line">  &lt;item name="</span>colorPrimaryDark<span class="string">"&gt;@color/accent_material_light&lt;/item&gt;</span><br><span class="line">  &lt;!--Window color--&gt;</span><br><span class="line">  &lt;item name="</span>android:windowBackground<span class="string">"&gt;@color/dim_foreground_material_dark&lt;/item&gt;</span><br><span class="line"></span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>values-v21/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">  &lt;!<span class="tag">--Navigation</span> <span class="tag">bar</span> <span class="tag">color--</span>&gt;</span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">navigationBarColor<span class="string">"&gt;@color/accent_material_light&lt;/item&gt;</span><br><span class="line"></span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Tool Bar背景色：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">  <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">  <span class="attribute">android:layout_height</span>=<span class="value">"?attr/actionBarSize"</span></span><br><span class="line">  <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">  <span class="attribute">android:background</span>=<span class="value">"?attr/colorPrimary"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="二、ToolBar控件">二、ToolBar控件</h3><p>从做到右依次为：<br>Icon —- Logo —- Title —- —- —- —- Menu</p>
<ol>
<li>Icon：设置向上的图标，即在二级页面时候，返回上级图标，调用setNavigationIcon方法设置，在Material Design上，新的向上图标也有别于ActionBar。</li>
<li>Logo：应用的LOGO，setLogo方法。</li>
<li>Title：标题，调用setTitle方法。还有副标题可设置，setSubtitle方法。</li>
<li>Menu：设置菜单按钮及事件，setOnMenuItemClickListener方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar_actionbar);</span><br><span class="line"><span class="comment">// App Logo</span></span><br><span class="line">toolbar.setLogo(R.drawable.ic_launcher);</span><br><span class="line"><span class="comment">// Title</span></span><br><span class="line">toolbar.setTitle(<span class="string">"My Title"</span>);</span><br><span class="line"><span class="comment">// Sub Title</span></span><br><span class="line">toolbar.setSubtitle(<span class="string">"Sub title"</span>);</span><br><span class="line">setSupportActionBar(toolbar);</span><br><span class="line"><span class="comment">// Navigation Icon 设置需要在设置完 setSupoortActionBar 之后</span></span><br><span class="line"><span class="comment">// 否则会出现 back button</span></span><br><span class="line">toolbar.setNavigationIcon(R.drawable.ab_android);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Menu的设置也很简单：<br>首先设置menu.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">menu</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">      <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">      <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">      <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_edit"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_edit"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"80"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/ab_edit"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"ifRoom"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_share"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_edit"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"90"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/ab_share"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"ifRoom"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_settings"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_settings"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"never"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其次代码中设置监听：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Toolbar.OnMenuItemClickListener onMenuItemClick = <span class="keyword">new</span> Toolbar.OnMenuItemClickListener() &#123;</span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (menuItem.getItemId()) &#123;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_edit:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_share:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_settings:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Menu item click 的监听事件要在设置完 setSupportActionBar 之后才可以</span></span><br><span class="line">toolbar.setOnMenuItemClickListener(onMenuItemClick);</span><br></pre></td></tr></table></figure></p>
<h3 id="三、自定义布局">三、自定义布局</h3><p>如果想将title修改为居中，此时系统自带的ToolBar的setTitle已经无法满足我们的需求了，此时需要自定义ToolBar布局及控件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"?actionBarSize"</span></span><br><span class="line">    <span class="attribute">android:background</span>=<span class="value">"@null"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_title"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/TextAppearance.AppCompat.Widget.ActionBar.Title"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_gravity</span>=<span class="value">"center"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重载setContentView(int resid)方法，并调用此方法，需要注意的是，因为我们使用自己的title视图，所以需要禁用系统的title显示，也就是setDisplayShowTitleEnabled方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Toolbar <span class="title">getActionBarToolbar</span><span class="params">(AppCompatActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mActionBarToolbar == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">        mTitleView = (TextView) mActionBarToolbar.findViewById(R.id.toolbar_title);</span><br><span class="line">        <span class="keyword">if</span> (mActionBarToolbar != <span class="keyword">null</span>) &#123;</span><br><span class="line">            activity.setSupportActionBar(mActionBarToolbar);</span><br><span class="line">            <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">                activity.getSupportActionBar().setDisplayShowTitleEnabled(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mActionBarToolbar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后，我们需要设置标题联动，这里可以使用activity里面的一个onTitleChanged监听，这个监听在Activity的onPostCreate和setTitle方法都会调用，在Fragment切换时候，也可以很方便的调用getActivity().setTitle()即可修改标题栏。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onTitleChanged</span><span class="params">(CharSequence title, <span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onTitleChanged(title, color);</span><br><span class="line">    <span class="keyword">if</span>(mToolBarHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mToolBarHelper.setTitle(title);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>附带上所有java代码：<br>activity中代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(<span class="keyword">int</span> layoutResID)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.setContentView(layoutResID);</span><br><span class="line">    mToolBarHelper = <span class="keyword">new</span> ToolBarHelper();</span><br><span class="line">    mToolBarHelper.getActionBarToolbar(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ToolBarHelper <span class="title">getToolBarHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mToolBarHelper;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onTitleChanged</span><span class="params">(CharSequence title, <span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onTitleChanged(title, color);</span><br><span class="line">    <span class="keyword">if</span>(mToolBarHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mToolBarHelper.setTitle(title);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ToolBarHelper.java代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToolBarHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Toolbar mActionBarToolbar;</span><br><span class="line">    <span class="keyword">private</span> TextView mTitleView;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Toolbar <span class="title">getActionBarToolbar</span><span class="params">(AppCompatActivity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mActionBarToolbar == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">            mTitleView = (TextView) mActionBarToolbar.findViewById(R.id.toolbar_title);</span><br><span class="line">            <span class="keyword">if</span> (mActionBarToolbar != <span class="keyword">null</span>) &#123;</span><br><span class="line">                activity.setSupportActionBar(mActionBarToolbar);</span><br><span class="line">                <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    activity.getSupportActionBar().setDisplayShowTitleEnabled(<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mActionBarToolbar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(<span class="keyword">int</span> resid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTitleView.setText(resid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(CharSequence title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTitleView.setText(title);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="结语">结语</h2><p>相比而言，ToolBar比ActionBar改进很多，而且其易用性方面也有很大提高，我们也可以不用再自己手动去制作应用标题了。</p>
<h2 id="Ref">Ref</h2><p><a href="http://angeldevil.me/2014/12/24/toolbar-as-actionbar-and-centered-title/" target="_blank" rel="external">Toolbar作为ActionBar与标题居中</a><br><a href="http://developer.android.com/intl/zh-cn/reference/android/support/v7/widget/Toolbar.html" target="_blank" rel="external">Class Toolbar</a><br><a href="http://blog.mosil.biz/2014/10/android-toolbar/" target="_blank" rel="external">ANDROID-TOOLBAR STEP BY STEP</a><br><a href="http://android-developers.blogspot.com/2014/10/appcompat-v21-material-design-for-pre.html" target="_blank" rel="external">Material Design for Pre-Lollipop Devices</a><br><a href="http://www.google.com/design/spec/layout/structure.html#structure-app-bar" target="_blank" rel="external">structure-app-bar</a></p>
]]></content>
    <summary type="html">
    <![CDATA[ToolBar基础用法及自定义ToolBar。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android Studio With SVN]]></title>
    <link href="https://hwangjr.github.io/2015/07/08/Android-Studio-With-SVN/"/>
    <id>https://hwangjr.github.io/2015/07/08/Android-Studio-With-SVN/</id>
    <published>2015-07-08T12:17:08.000Z</published>
    <updated>2015-07-08T12:17:42.289Z</updated>
    <content type="html"><![CDATA[<h2 id="环境">环境</h2><p>系统使用Ubuntu 12.04，SVN版本1.8.8，AS使用最新稳定1.2.2。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn, version <span class="number">1.8</span>.<span class="number">8</span> (r1568071)</span><br><span class="line">   compiled Aug <span class="number">13</span> <span class="number">2014</span>, <span class="number">17</span>:<span class="number">12</span>:<span class="number">39</span> on x86_64-pc-linux-gnu</span><br></pre></td></tr></table></figure></p>
<h2 id="配置AS">配置AS</h2><p>配置AS很简单。<br>1、配置SVN执行目录：<br>File -&gt; Settings -&gt; Version Control -&gt; Subversion -&gt; General Tab里面的Use command line client，如果你已经安装SVN，AS应该默认是配置好的。<br>2、上传你的文件到SVN：<br>VCS -&gt; Import into Version Control -&gt; Import into Subversion…之后就可在线上版本查看到文件已经同步。<br>3、为项目新增SVN管理：<br>VCS -&gt; Enable Version Control Integration… 简单配置，即可在面板上有UP和CI等版本操作的图标。<br>至此，AS配置完成。</p>
<h2 id="设置SVN_IGNORE">设置SVN IGNORE</h2><p>一直不知道SVN如何设置忽略命令，网上看的很多都是不准确或者理解有偏差。<br>1、设置全局忽略文件列表：<br>编辑~/.subversion/config文件，修改此文件中的global-ignores，里面也有提供实例。<br>当然，如果你想修改所有用户的ignore，文件目录在/etc/subversion/config。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global-ignores = *.o *.lo *.la *.al .libs *.so *.so.[0-9]* *.a *.pyc *.pyo</span></span><br><span class="line"><span class="comment">#   *.rej *~ #*# .#* .*.swp .DS_Store</span></span><br></pre></td></tr></table></figure></p>
<p>2、设置某目录svn ignore：<br>关键是使用svn的property set命令，此命令不可递归，只能设置当前目录下的ignore规则。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">svn pe svn:ignore path</span><br><span class="line"><span class="comment"># svn propedit svn:ignore path</span></span><br><span class="line">svn pd svn:ignore path</span><br><span class="line"><span class="comment"># svn propdel svn:ignore path</span></span><br><span class="line">svn ps svn:ignore path</span><br><span class="line"><span class="comment"># svn propset svn:ignore path</span></span><br></pre></td></tr></table></figure></p>
<p>如果当前目录结构为：<br>.<br>|<br>|-Android<br>|   |<br>|   - trunk<br>|   - branches<br>|   - tags<br>|-iOS<br>想要过滤trunk目录下某些文件或目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn pe svn:ignore Android/trunk</span><br></pre></td></tr></table></figure></p>
<p>之后会打开编辑窗口，输入下方文件即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.gradle</span><br><span class="line">local.properties</span><br><span class="line">.DS_Store</span><br><span class="line">build</span><br><span class="line">captures</span><br><span class="line">proguard</span><br></pre></td></tr></table></figure></p>
<p>附带完整svn ignore命令（svn st命令，可以查看当前状态）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> project-path</span><br><span class="line">svn pe Android/trunk</span><br><span class="line">svn pe Android/trunk/.idea</span><br><span class="line">svn pe Android/trunk/app</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.gradle</span><br><span class="line">local.properties</span><br><span class="line">.DS_Store</span><br><span class="line">build</span><br><span class="line">captures</span><br><span class="line">proguard</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk/.idea下的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workspace.xml</span><br><span class="line">libraries</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk/app下的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build</span><br></pre></td></tr></table></figure></p>
<p>设置完成，使用svn ci -m ‘ignore files’即可。<br>附带.ignore文件为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Built application files</span></span><br><span class="line">*.apk</span><br><span class="line">*.ap_</span><br><span class="line"></span><br><span class="line"><span class="comment"># Files for the Dalvik VM</span></span><br><span class="line">*.dex</span><br><span class="line"></span><br><span class="line"><span class="comment"># Java class files</span></span><br><span class="line">*.class</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated files</span></span><br><span class="line">bin/</span><br><span class="line">gen/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gradle files</span></span><br><span class="line">.gradle/</span><br><span class="line">build/</span><br><span class="line">/*/build/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Local configuration file (sdk path, etc)</span></span><br><span class="line">local.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># Proguard folder generated by Eclipse</span></span><br><span class="line">proguard/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log Files</span></span><br><span class="line">*.log</span><br><span class="line"></span><br><span class="line">/.idea/workspace.xml</span><br><span class="line">/.idea/libraries</span><br><span class="line">.DS_Store</span><br><span class="line">/capture</span><br></pre></td></tr></table></figure></p>
<p>附带命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svn ps svn:ignore <span class="string">'ignorefile'</span> dir</span><br><span class="line">svn up</span><br><span class="line">svn commit -m <span class="string">'ignore ignorefile'</span></span><br><span class="line"></span><br><span class="line">svn <span class="built_in">export</span> dir dir_bak</span><br><span class="line">svn rm dir</span><br><span class="line">svn commit -m <span class="string">'delete dir'</span></span><br><span class="line">mv dir-bak dir</span><br><span class="line">svn ps svn:ignore <span class="string">'ignorefile'</span> dir</span><br><span class="line">svn up</span><br><span class="line">svn commit -m <span class="string">'ignore ignorefile'</span></span><br><span class="line"></span><br><span class="line">svn ps svn:ignore <span class="string">'ignorefile1</span><br><span class="line">ignorefile2</span><br><span class="line">ignorefile3'</span> dir</span><br></pre></td></tr></table></figure></p>
<h2 id="SVN常用命令">SVN常用命令</h2><p>Show The Code:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">svn co svn://xxx</span><br><span class="line">svn checkout svn://</span><br><span class="line">svn <span class="built_in">export</span> [-r version] svn://</span><br><span class="line">svn add file</span><br><span class="line">svn commit -m <span class="string">''</span></span><br><span class="line">svn ci -m <span class="string">''</span></span><br><span class="line">svn up</span><br><span class="line">svn update</span><br><span class="line">svn update -r <span class="number">200</span> file</span><br><span class="line">svn delete svn:// -m <span class="string">''</span></span><br><span class="line">svn delete file</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[使用Android Studio来管理SVN版本，进行协同工作。]]>
    
    </summary>
    
      <category term="Android" scheme="https://hwangjr.github.io/tags/Android/"/>
    
      <category term="tech" scheme="https://hwangjr.github.io/tags/tech/"/>
    
      <category term="Android" scheme="https://hwangjr.github.io/categories/Android/"/>
    
  </entry>
  
</feed>