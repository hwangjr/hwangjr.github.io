
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>HwangJR&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="HwangJR">
    

    
    <meta name="description" content="Some stuff about tech etc..">
<meta property="og:type" content="website">
<meta property="og:title" content="HwangJR's Blog">
<meta property="og:url" content="https://hwangjr.github.io/index.html">
<meta property="og:site_name" content="HwangJR's Blog">
<meta property="og:description" content="Some stuff about tech etc..">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HwangJR's Blog">
<meta name="twitter:description" content="Some stuff about tech etc..">
<meta name="twitter:creator" content="@HuangJR">
<link rel="publisher" href="+JianrongHuang">

    
    <link rel="alternative" href="/atom.xml" title="HwangJR&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HwangJR&#39;s Blog" title="HwangJR&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HwangJR&#39;s Blog">HwangJR&#39;s Blog</a></h1>
				<h2 class="blog-motto">Life is wonderful!</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="ts-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/05/创业团队股权分配/" title="创业团队股权分配" itemprop="url">创业团队股权分配</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-05T07:33:39.000Z" itemprop="datePublished"> 发表于 2015-08-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>团队分配股权，根本上来说，是需要创始人在分配和讨论过程中，整个团队感觉到合理、公平的一个分配方案，需要让各方达成共识。但是股权分配肯定无法替代信任的建立。<br>另外，股权分配一旦确定，很多在执行力上不足，这也是很多创业团队现有的问题，这时大家必须坐到一块，兑现股权约定。<br>本文从互联网资料参考，并进行总结，希望能让大家有所收获。</p>
<h2 id="阶梯分配">阶梯分配</h2><p>将其取名为阶梯，是因为这个分配是从进入团队的不同时期来进行分配，越迟加入公司的员工风险越低。</p>
<h3 id="原则">原则</h3><p>为了简单，假设所有创始人都全职创业。<br>随着公司的不断壮大，新员工不断加入，公司的也将一批一批的加入新员工，当你进行第一批招人时，很可能你已经获取到现金流（投资或者客户），所以除了创始人（第一批）之外，其他都不是创始人，他们是加入公司打工，因为他们不需要冒很大风险且从工作第一天就开始拿工资了。<br>那么当你的公司大到可以上市或者其他，这时你的公司也许已经有了6批，员工大约5批，第二批有5个，第三批25个，第四批200，ETC。<br>综上：创始人应该最终拿整个公司大约50%的股份，首批下面的5批员工每一批最终都分别分到大约10%的公司股份，每一批员工都将平分这10%股份。<br>基本思路就是，你设立不同的资历，最高的员工承受最大风险，最低员工风险最低，每批员工平均分配给这个这批股份，也就是让越早加入员工获得越多股份。<br>现在，你还需用执行一个重要的原则：股份绑定（vesting）。绑定期最好是4-5年，任何人在公司起码1年才可持有股份（包括创始人）。一般头一年25%，接下来每月落实2%。没有股份绑定条款，派股给任何人都是不靠谱的！<br>最后需要解决一个问题，当有新的投资进来时，将如何分割股份？答案很简单：新的投资将稀释所有人的股份。<br>另外，千万不要用分配股权来解决一些薪资或其他问题，比如：</p>
<ol>
<li>创业构想提出者，需要多拿股份吗？</li>
<li>创始人之一不是全职投入？（那创始人就不是创始人了）</li>
<li>为公司提供设备或其他有价值（专利等）东西，如何处理？<br>这些问题，都可通过类似补发工资等方式来解决，在公司现金流运转正常之后，对每个创始人薪资进行补发，避免因此引起的纠纷。<br>投资人、创始人和雇员分别拥有多少股份？这个需要市场来确定，现实地看，如果投资人最终获得50%以上，创始人重要性将被削弱，从而丧失动力。而如果创始人和员工如果持有100%股份，也会给投资人带来很大的压力，以平衡投资人和创始人/员工之间分配。正常公司上市时，投资人将拥有50%股份，创始人+员工将拥有50%股份。<h3 id="总结">总结</h3>虽然创业公司股权分配原则没有一刀切的解决方案，但是尽可能简单化、透明化、公平化！</li>
</ol>
<h2 id="常规分配">常规分配</h2><p>股权分配最错误的做法是股权五五分，五五分的结果是没有分配决定权。在开始的蜜月期可能不会产生争执，正所谓可以共患难，难以同甘苦。到了一定阶段，出现分歧的时候，如果有没有一个人拥有绝对的控制权，可能谁也不服气谁，最终的结果就是分道扬镳，创业失败。基于公司法规定的的股权1/2的决议规则和2/3的特别决议规则，相对理想的股权分配是持1/2以上股权，更理想是2/3以上。<br>这边分为三个部分。<br>一是创始人的股权。<br>二是员工的股权。<br>三是众筹的股权。</p>
<h3 id="创始人的股权">创始人的股权</h3><h4 id="确定创始人">确定创始人</h4><p>创始人是承担了风险的人。判断创始人的简单方法是拿不拿工资，如果在最开始，都不能支付工资给你，那你就是创始人。<br>按照下面标准来进行股权增减：</p>
<ol>
<li>初始(每人均分100份股权)。</li>
<li>召集人(股权增加5%)。</li>
<li>创业点子及执行很重要(股权增加5%)。提供了最初的创业点子并执行成功。</li>
<li>迈出第一步最难(股权增加5%-25%)。如果某个创始人提出的概念已经着手实施，比如已经开始申请专利、已经有一个演示原型、已经有一个产品的早期版本，或者其他对吸引投资或贷款有利的事情，那么这个创始人额外可以得到的股权，从5%到 25%不等。</li>
<li>CEO，即总经理应该持股更多(股权增加5%)。</li>
<li>全职创业是最最有价值的(股权增加200%)。</li>
<li>信誉是最重要的资产(股权增加50-500%)。如果创始人是第一次创业，而他的合伙人里有人曾经参与过风投投资成功了的项目，那么这个合伙人比创始人更有投资价值。在某些极端情况 下，某些创始人会让投资人觉得非常值得投资，这些超级合伙人基本上消除了“创办阶段”的所有风险，所以最好让他们在这个阶段获得最多的股权。</li>
<li>现金投入参照投资人投资。很可能是某个合伙人投入的资金相对而言多的多。这样的投资应该获较多的股权，因为最早期的投资，风险也往往最大，所以应该获得更多的股权。</li>
<li>最后进行计算。假设最后计算的三个创始人的股份是为200/150/250，那么将他们的股份数相加(即为600份)作为总数，再计算他们每个人的持股比例：33%/25%/42%。<h4 id="创始人股权的退出机制">创始人股权的退出机制</h4>作为创业企业，如果创始人离开创业团队就涉及股权的退出机制。如果不设定退出机制，允许中途退出的合伙人带走股权，对退出合伙人的公平，但却是对其它长期参与创业的合伙人最大的不公平，对其它合伙人也没有安全感。<br>对于退出的合伙人，一方面，可以全部或部分收回股权；另一方面，必须承认合伙人的历史贡献，按照一定溢价/或折价回购股权。对于如何确定具体的退出价格，涉及两个因素，一个是退出价格基数，一个是溢价/或折价倍数。可以考虑按照：</li>
<li>合伙人掏钱买股权的购买价格的一定溢价回购</li>
<li>退出合伙人按照其持股比例可参与分配公司净资产或净利润的一定溢价</li>
<li>按照公司最近一轮融资估值的一定折扣价回购</li>
<li>有些退出价格是当时投入的本金，加合理利息回报。至于退出价格，不同公司会存在差异。<h4 id="股权与分红权的分离">股权与分红权的分离</h4>分红权和股权可以分离，表决权理论上也可以分离。对于出资较大的合伙人，可以给与较大的分红权，但对于承担风险较大的，应给与较大的股权。<h4 id="股权协议的约定">股权协议的约定</h4>一些公司出现拥有股权的合伙人在创业过程中出现了，违背创业企业利益的行为，比如泄密或者携带知识产权另立门户等，为了保护创业企业其他合伙人的利益，最好在协议中约定这些对股权的限制条款。还可制定股权实现的考核标准，不达到考核标准不拥有股权。<h3 id="员工的股权">员工的股权</h3>什么是员工？谁是员工的判断标准是看其是否是具有员工心态的人。在创业企业，有些合伙人希望把员工当做合伙人，也给与股权激励。这样的做法，负面作用是：</li>
<li>过早的分散了股权</li>
<li>拥有员工心态的人，希望得到的是稳定的现金收入，而不是未来可能增值的股权。<br>因此，即使是作为激励作用的股权也不应当份额过大。员工管理问题不应单纯利用股权解决。一般来说，VC会要求员工持股计划在VC投资进来之前执行，这样VC就可以减少稀释。不过不能认为这是A轮VC自私，要知道B轮VC到时候也会要求在他们进来之前再执行一次员工持股计划，这时A轮VC和创始股东将一起稀释。 员工的期权比例应该留多少？一般来说是5-15%。<h3 id="众筹的股权">众筹的股权</h3><strong>众筹从概念逐渐变为实践，“股权众筹是否构成非法集资”已经不再是法律角度的焦点。</strong>股权众筹，既然是“众”筹，就说明股东数量非常多。不过，公司法规定，有限责任公司的股东不超过50人，非上市的股份有限公司股东不超过200人。法律对公司股东人数的限制，导致大部分众筹股东不能直接出现在企业工商登记的股东名册中。这一问题的解决方案一般有两种：</li>
<li><strong>委托持股，或者说是代持股。</strong>一个实名股东分别与几个乃至几十个隐名的众筹股东签订代持股协议，代表众筹股东持有众筹公司股份。在这种模式下，众筹股东并不亲自持有股份，而是由某一个实名股东持有，并且在工商登记里只体现出该实名股东的身份。中国国内法律已经认可了保护真实股东的合法利益，也就是即使股东名册里面没有出现众筹股东的名字，只要有协议证明真实股东是真实的出资人，其权益也是被保障的。</li>
<li><strong>持股平台持股。</strong>比如，先设立一个持股平台，五十个众筹股东作为这个持股平台的投资人，把资金投入持股平台。然后，持股平台把这笔款再投入众筹公司，由持股平台作为众筹公司的股东。这样五十个众筹股东在众筹公司里只体现为一个股东，即持股平台。持股平台可以是有限责任公司，也可以是有限合伙。两者对于众筹股东来说都是有限责任的。按照合伙企业法，通常有限合伙人不参与管理，由普通合伙人负责管理。这样，众筹发起人就可以其普通合伙人的身份，管理和控制持股平台，进而控制持股平台在众筹公司的股份，也就实际上控制了众筹股东的投资及股份。<br><strong>期权池</strong>是在融资前为未来引进高级人才而预留的一部分股份，用于激励员工(包括创始人自己、高管、骨干、普通员工)，是初创企业实施股权激励计划(Equity Incentive Plan)最普通采用的形式，在欧美等国家被认为是驱动初创企业发展必要的关键要素之一。硅谷的惯例是预留公司全部股份的10%-20%作为期权池，较大的期权池对员工和VC具更大吸引力。 VC一般要求期权池在它进入前设立，并要求在它进入后达到一定比例。由于每轮融资都会稀释期权池的股权比例，因此一般在每次融资时均调整(扩大)期权池，以不断吸引新的人才。<h3 id="案例">案例</h3>苹果，起始阶段的股权比例是乔布斯和沃兹尼亚克各45%，韦恩10%；谷歌，佩吉和布林一人一半；Facebook，扎克伯格65%，萨维林30%，莫斯科维茨5%。<br>苹果电脑是沃兹尼亚克开发的，但乔布斯和沃兹股份一样（沃兹的父亲对此非常不满），因为乔布斯不仅是个营销天才，而且拥有领导力，对公司未来意志坚定激情四射。而沃兹生性内敛，习惯于一个人工作，并且只愿意兼职为新公司工作，乔布斯和他的朋友家人百般劝说才同意全职。至于韦恩，他拥有10%是因为其他两人在运营公司方面完全是新手，需要他的经验。由于厌恶风险，韦恩很快就退股了，他一直声称自己从未后悔过。<br>Facebook是扎克伯格开发的，他又是个意志坚定的领导者，因此占据65%，萨维林懂得怎样把产品变成钱，莫斯科维茨则在增加用户上贡献卓著。不过，Facebook起始阶段的股权安排埋下了日后隐患。由于萨维林不愿意和其他人一样中止学业全情投入新公司，而他又占有1/3的股份。因此，当莫斯科维茨和新加入但创业经验丰富的帕克贡献与日俱增时，就只能稀释萨维林的股份来增加后两者的持股，而萨维林则以冻结公司账号作为回应。A轮融资完成后，萨维林的股份降至不到10%，怒火中烧的他干脆将昔日伙伴们告上了法庭。萨维林之所以拿那么高股份是因为他能为公司赚到钱，而公司每天都得花钱。但扎克伯格的理念是“让网站有趣比让它赚钱更重要”，萨维林想的则是如何满足广告商要求从而多赚钱。短期看萨维林是对的，但这么做不可能成就一家伟大的公司，扎克伯格对此心知肚明。Facebook正确的办法应当是早一点寻找天使投资，就像苹果和谷歌曾经做过的那样。在新公司确定产品方向之后，就需要天使投资来帮助自己把产品和商业模式稳定下，避免立即赚钱的压力将公司引入歧途。Facebook的天使投资人是帕克的朋友介绍的彼得·泰尔，他注资50万美元，获得 10%股份。这之后，Facebook的发展可谓一帆风顺，不到一年就拿到了A轮融资——阿克塞尔公司投资1270万美元，公司估值1亿美元。7年后的2012年，Facebook上市，此时公司8岁。谷歌从天使到A轮的时间差不多是一年。硅谷著名风投公司KPCB和红杉资本各注入谷歌125万美元，分别获得10%股份。5后的2004年，也就是公司创立6年后，谷歌上市，近2000名员工获得配股。 苹果公司在马库拉投资后没有经历后续融资，4年之后上市，上百名员工成了百万富翁，此时公司5岁。<h3 id="总结-1">总结</h3>创业团队在组建过程中需要制定股权分配方案。随着公司逐渐变大，资本需求会越来越旺，后续融资不可避免，引进经验丰富的运营人才也必须授予其股权或期权，这些都会稀释创始人的股权。事实上，创始人在公司长大之后如何不被董事会踢出自己创办的公司，早已是硅谷的经典话题之一。乔布斯在苹果上市4年半后被赶出了苹果公司，没有一个创始人愿意失去自己的公司，而他们也有办法做到这一点，那就是采用双层股权结构（就是前文提到的表决权和分红权分离的做法）。<br>苹果当年是单一股权结构，同股同权，苹果上市后，乔布斯的股权下降到11%，董事会里也没有他的铁杆盟友（他本以为马库拉会是），触犯众怒后的结局可想而知。 谷歌则在上市时重拾美国资本市场消失已久的AB股模式，佩吉、布林、施密特等公司创始人和高管持有B类股票，每股表决权等于A类股票10股的表决权。2012年，谷歌又增加了不含投票权的C类股用于增发新股。这样，即使总股本继续扩大，即使创始人减持了股票，他们也不会丧失对公司的控制力。预计到2015年，佩吉、布林、施密特持有谷歌股票将低于总股本的20%，但仍拥有近60%的投票权。Facebook前年上市时同样使用了投票权1：10的AB股模式，这样扎克伯格一人就拥有28.2的表决权。此外，扎克伯格还和主要股东签订了表决权代理协议，在特定情况下，扎克伯格可代表这些股东行使表决权，这意味着他掌握了56.9%的表决权。<br>在中国，公司法规定同股同权，不允许直接实施双层或三层股权结构，但公司法允许公司章程对投票权进行特别约定（有限责任公司），允许股东在股东大会上将自己的投票权授予其他股东代为行使（股份有限公司）。</li>
</ol>
<h2 id="总结-2">总结</h2><p>股权分配问题是一种博弈，是不同角色之间的讨价还价，也取决于不同人的性格，没有一个标准答案。</p>
<h2 id="Ref">Ref</h2><p><a href="http://www.zhihu.com/question/19551070" target="_blank" rel="external">几个朋友合伙创业，如何分配股权？ - 知乎</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19906816" target="_blank" rel="external">杜国栋：联合创始人退出，他手里的股权怎么办？ - 创思舍 - 知乎专栏</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19970947" target="_blank" rel="external">创始人之间如何分股权：按贡献估值 - 创思舍 - 知乎专栏</a><br><a href="http://wenku.baidu.com/view/cd30202c453610661ed9f410.html" target="_blank" rel="external">华为股权分配政策(幻灯片)_百度文库</a><br><a href="http://www.tmtpost.com/172112.html" target="_blank" rel="external">联合创始人股权分配，五五分是最糟糕的做法</a><br><a href="http://blog.sina.com.cn/s/blog_61b925fa0100foie.html" target="_blank" rel="external">(3)11.18.09 期权：为什么给，给多少，怎么给？<em>邵亦波</em>新浪博客</a><br><a href="http://36kr.com/p/22890.html" target="_blank" rel="external">Joel Spolsky: 创业公司如何公平分配股权？</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/创业/">创业</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/创业/">创业</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/05/创业团队股权分配/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/29/HTML-In-TextView/" title="HTML In TextView" itemprop="url">HTML In TextView</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-29T07:50:06.000Z" itemprop="datePublished"> 发表于 2015-07-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>往往我们会遇到效果图中需要展示多个颜色的文字，不同的大小，甚至有可能会遇到多个排版，这时候，如果我们全部用TextView，有时候一个字就因为颜色不同就得新建一个TextView，是很浪费。这时候，我们可以适当考虑HTML来排版并显示在TextView中。<br>目前在GITHUB上面已经开源一个Html TextView库，有学习价值，有兴趣可以参考：<a href="https://github.com/sufficientlysecure/html-textview" target="_blank" rel="external">html-textview</a></p>
<h2 id="HTML在string-xml中">HTML在string.xml中</h2><p>在string.xml中是无法直接写html，下面实例包括字符替换和HTML示例。<br>string.xml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name=<span class="string">"format_temp"</span>&gt;&lt;![CDATA[&lt;font color=\<span class="string">"#9d9d9d\"&gt;%1<span class="variable">$s</span>&lt;/font&gt; 收到@&lt;font color=\"#dd3a37\"&gt;%2<span class="variable">$s</span>&lt;/font&gt;的示例]]&gt;&lt;/string&gt;</span><br><span class="line">// 或者使用转意</span><br><span class="line">&lt;string name="</span>format_temp<span class="string">"&gt;Text: &amp;lt;b&gt;%s&amp;lt;/b&gt;&lt;/string&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.format(getString(R.string.format_temp)), <span class="string">"刚刚"</span>, <span class="string">"大胖"</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="在TextView中的使用">在TextView中的使用</h2><h3 id="文本展示">文本展示</h3><p>单纯文本展示直接使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动</span></span><br><span class="line">TextView.setMovementMethod(ScrollingMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure></p>
<h3 id="超链接展示">超链接展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure>
<p>或者设置TextView的autoLink为all<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"all"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"web|email"</span> /&gt;</span><br><span class="line"></span><br><span class="line">TextView.setAutoLinkMask(Linkify.ALL);</span><br><span class="line">TextView.setAutoLinkMask(Linkify.EMAIL_ADDRESSES|Linkify.WEB_URLS);</span><br></pre></td></tr></table></figure></p>
<h3 id="图片展示">图片展示</h3><p>在Html的fromHtml方法中，可以传入Html的ImageGetter。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TextView.setText(Html.fromHtml(html, <span class="keyword">new</span> ImageGetter(), <span class="keyword">null</span>));</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageGetter</span> <span class="keyword">implements</span> <span class="title">Html</span>.<span class="title">ImageGetter</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">		Drawable d = getResources().getDrawable(R.drawable.ic_launch);</span><br><span class="line">		d.setBounds(<span class="number">0</span>,<span class="number">0</span>,d.getIntrinsicWidth(),d.getIntrinsicHeight());</span><br><span class="line">		<span class="keyword">return</span> d;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="自定义TAG展示">自定义TAG展示</h3><p>这时，我们需要用到我们最后一个传入参数，<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Html.TagHandler.html" target="_blank" rel="external">Html.TagHandler</a>。简单示例一个size的标签。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SizeLabel</span> <span class="keyword">implements</span> <span class="title">TagHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SizeLabel</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTag</span><span class="params">(<span class="keyword">boolean</span> opening, String tag, Editable output,</span><br><span class="line">                          XMLReader xmlReader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * 参数： </span><br><span class="line">         * opening：为true时表示开始解析,为false时表示解析完 </span><br><span class="line">         * tag:当前解析的标签 </span><br><span class="line">         * output:文本中的内容 </span><br><span class="line">         * xmlReader:xml解析器 </span><br><span class="line">         */</span></span><br><span class="line">        <span class="comment">// 判断当前解析的tag是否为size,并且已经解析完毕(在没有解析完毕之前output中没有数据)  </span></span><br><span class="line">        <span class="keyword">if</span> (tag.toLowerCase().equals(<span class="string">"size"</span>) &amp;&amp; !opening) &#123;</span><br><span class="line">            <span class="comment">// 通过output调用setSpan方法,改变文本的0下标到最后的下标的大小;  </span></span><br><span class="line">            <span class="comment">// 最后的参数用来标识在span范围内的文本前后输入新的字符时是否也改变它们的效果;  </span></span><br><span class="line">            output.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(size), <span class="number">0</span>, output.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="支持的HTML标签">支持的HTML标签</h2><p>并不是所有的HTML标签都支持，目前支持的标签分为两类：<br>1 . 静态string资源中，解析是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/content/res/StringBlock.java" target="_blank" rel="external">android.content.res.StringBlock</a>类来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：支持href属性</span><br><span class="line"><span class="tag">&lt;<span class="title">annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：支持height, size, fgcolor和bicolor</span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2 . Html.fromHtml方法中支持是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/text/Html.java" target="_blank" rel="external">Html.java</a>来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：href</span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">cite</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dfn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">em</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：color和face属性</span><br><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> - <span class="tag">&lt;<span class="title">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span>&gt;</span>：支持src属性，需要实现ImageGetter接口</span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>另外，font的color属性除了直接支持颜色色值之外，还支持一些颜色的直接名字，<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/graphics/java/android/graphics/Color.java" target="_blank" rel="external">Color.java</a>的getHtmlColor方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">black</span><br><span class="line">darkgray</span><br><span class="line">gray</span><br><span class="line">lightgray</span><br><span class="line">white</span><br><span class="line">red</span><br><span class="line">green</span><br><span class="line">blue</span><br><span class="line">yellow</span><br><span class="line">cyan</span><br><span class="line">magenta</span><br><span class="line">aqua</span><br><span class="line">fuchsia</span><br><span class="line">darkgrey</span><br><span class="line">grey</span><br><span class="line">lightgrey</span><br><span class="line">lime</span><br><span class="line">maroon</span><br><span class="line">navy</span><br><span class="line">olive</span><br><span class="line">purple</span><br><span class="line">silver</span><br><span class="line">teal</span><br></pre></td></tr></table></figure></p>
<h2 id="简单原理剖析">简单原理剖析</h2><p>其实这主要是用到了<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Spannable.html" target="_blank" rel="external">Spannable</a>接口。里面已经实现了SpannableString及setSpan即可得到我们想要的风格。</p>
<h3 id="简单使用">简单使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpannableString text = <span class="keyword">new</span> SpannableString(<span class="string">"Test"</span>);</span><br><span class="line">TextView.setText(text);</span><br></pre></td></tr></table></figure>
<h3 id="字体样式">字体样式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setSpan会将start到end这间的文本设置成创建的span格式。span可以是图片格式。</span></span><br><span class="line"><span class="comment">// 设置字体(default,default-bold,monospace,serif,sans-serif)</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"monospace"</span>), <span class="number">0</span>, <span class="number">2</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 等宽字体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"serif"</span>), <span class="number">2</span>, <span class="number">4</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 衬线字体</span></span><br></pre></td></tr></table></figure>
<h3 id="字体绝对大小">字体绝对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体绝对大小（绝对值,单位：像素）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>), <span class="number">4</span>, <span class="number">6</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 第二个参数boolean dip，如果为true，表示前面的字体大小单位为dip，否则为像素，同上。</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>, <span class="keyword">true</span>), <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="字体相对大小">字体相对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体相对大小（相对值,单位：像素） 参数表示为默认字体大小的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">0.5f</span>), <span class="number">8</span>, <span class="number">10</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 0.5f表示默认字体大小的一半</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">2.0f</span>), <span class="number">10</span>, <span class="number">12</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体大小的两倍</span></span><br></pre></td></tr></table></figure>
<h3 id="前景色和背景色">前景色和背景色</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体前景色 ，Color.MAGENTA为紫红</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ForegroundColorSpan(Color.MAGENTA), <span class="number">12</span>, <span class="number">15</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置前景色为洋红色</span></span><br><span class="line"><span class="comment">// 设置字体背景色 ，Color.CYAN为青绿色</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> BackgroundColorSpan(Color.CYAN), <span class="number">15</span>, <span class="number">18</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置背景色为青色</span></span><br></pre></td></tr></table></figure>
<h3 id="设置字体粗体、斜体、粗斜体">设置字体粗体、斜体、粗斜体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体样式正常，粗体，斜体，粗斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.NORMAL), <span class="number">18</span>, <span class="number">20</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 正常</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD), <span class="number">20</span>, <span class="number">22</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.ITALIC), <span class="number">22</span>, <span class="number">24</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD_ITALIC), <span class="number">24</span>, <span class="number">27</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗斜体</span></span><br></pre></td></tr></table></figure>
<h3 id="设置下划线和删除线">设置下划线和删除线</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置下划线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> UnderlineSpan(), <span class="number">27</span>, <span class="number">30</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 设置删除线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">30</span>, <span class="number">33</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="设置下标和上标">设置下标和上标</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text.setSpan(<span class="keyword">new</span> SubscriptSpan(), <span class="number">34</span>, <span class="number">35</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 下标</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> SuperscriptSpan(), <span class="number">36</span>, <span class="number">37</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 上标</span></span><br></pre></td></tr></table></figure>
<h3 id="设置超链接">设置超链接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超级链接（需要添加setMovementMethod方法附加响应）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"tel:13888888888"</span>), <span class="number">37</span>, <span class="number">39</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 电话</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mailto:google@google.com"</span>), <span class="number">39</span>, <span class="number">41</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 邮件</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"http://www.google.com"</span>), <span class="number">41</span>, <span class="number">43</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// URL</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"sms:13888888888"</span>), <span class="number">43</span>, <span class="number">45</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 短信，使用sms:或者smsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mms:13888888888"</span>), <span class="number">45</span>, <span class="number">47</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 彩信，使用mms:或者mmsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"geo:38.899533,-77.036476"</span>), <span class="number">47</span>, <span class="number">49</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 地图</span></span><br></pre></td></tr></table></figure>
<h3 id="拉伸字体">拉伸字体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体大小（相对值,单位：像素） 参数表示为默认字体宽度的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ScaleXSpan(<span class="number">2.0f</span>), <span class="number">49</span>, <span class="number">51</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体宽度的两倍，即X轴方向放大为默认字体的两倍，而高度不变</span></span><br></pre></td></tr></table></figure>
<h2 id="Ref">Ref</h2><p><a href="http://aichixihongshi.iteye.com/blog/1207503" target="_blank" rel="external">android中用Spannable在TextView中设置超链接、颜色、字体</a><br><a href="https://commonsware.com/blog/Android/2010/05/26/html-tags-supported-by-textview.html" target="_blank" rel="external">HTML Tags Supported By TextView</a><br><a href="http://daniel-codes.blogspot.com/2011/04/html-in-textviews.html" target="_blank" rel="external">HTML in TextViews</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/29/HTML-In-TextView/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/13/破解Beyond-Compare/" title="破解Beyond Compare" itemprop="url">破解Beyond Compare</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-13T10:15:26.000Z" itemprop="datePublished"> 发表于 2015-07-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>好吧，要支持原版<a href="http://www.scootersoftware.com/download.php" target="_blank" rel="external">BCompare</a>！</p>
<h2 id="Linux破解">Linux破解</h2><p>破解相对简单：</p>
<ol>
<li>修改BCompare的KEY，让它可以使用生成的KEY就可以了。<br>ubuntu下安装deb，目录在/usr/lib/beyondcompare/下。<br>将：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keexjEP3t4Mue23hrnuPtY4TdcsqNiJL-<span class="number">5174</span>TsUdLmJSIXKfG2NGPwBL6vnRPddT7tH29qpkneX63DO9ECSPE9rzY1zhThHERg8lHM9IBFT+rVuiY823aQJuqzxCKIE1bcDqM4wgW01FH6oCBP1G4ub01xmb4BGSUG6ZrjxWHJyNLyIlGvOhoY2HAYzEtzYGwxFZn2JZ66o4RONkXjX0DF9EzsdUef3UAS+JQ+fCYReLawdjEe6tXCv88GKaaPKWxCeaUL9PejICQgRQOLGOZtZQkLgAelrOtehxz5ANOOqCaJgy2mJLQVLM5SJ9Dli909c5ybvEhVmIC0dc9dWH+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>修改为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N9KmiLVlKMU7RJqnE+WXEEPI1SgglmfmLc1yVH7dqBb9ehOoKG9UE+HAE1YvH1XX2XVGeEqYUY-Tsk7YBTz0WpSpoYyPgx6Iki5KLtQ5G<span class="operator">-a</span>KP9eysnkuOAkrvHU8bLbGtZteGwJarev03PhfCioJL4OSqsmQGEvDbHFEbNl1qJtdwEriR+VNZts9vNNLk7UGfeNwIiqpxjk4Mn09nmSd8FhM4ifvcaIbNCRoMPGl6KU12iseSe+w+<span class="number">1</span>kFsLhX+OhQM8WXcWV10cGqBzQE9OqOLUcg9n0krrR3KrohstS9smTwEx9olyLYppvC0p5i7dAx2deWvM1ZxKNs0BvcXGukR+</span><br></pre></td></tr></table></figure></p>
<p>Linux命令为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">"s/keexjEP3t4Mue23hrnuPtY4TdcsqNiJL-5174TsUdLmJSIXKfG2NGPwBL6vnRPddT7tH29qpkneX63DO9ECSPE9rzY1zhThHERg8lHM9IBFT+rVuiY823aQJuqzxCKIE1bcDqM4wgW01FH6oCBP1G4ub01xmb4BGSUG6ZrjxWHJyNLyIlGvOhoY2HAYzEtzYGwxFZn2JZ66o4RONkXjX0DF9EzsdUef3UAS+JQ+fCYReLawdjEe6tXCv88GKaaPKWxCeaUL9PejICQgRQOLGOZtZQkLgAelrOtehxz5ANOOqCaJgy2mJLQVLM5SJ9Dli909c5ybvEhVmIC0dc9dWH+/N9KmiLVlKMU7RJqnE+WXEEPI1SgglmfmLc1yVH7dqBb9ehOoKG9UE+HAE1YvH1XX2XVGeEqYUY-Tsk7YBTz0WpSpoYyPgx6Iki5KLtQ5G-aKP9eysnkuOAkrvHU8bLbGtZteGwJarev03PhfCioJL4OSqsmQGEvDbHFEbNl1qJtdwEriR+VNZts9vNNLk7UGfeNwIiqpxjk4Mn09nmSd8FhM4ifvcaIbNCRoMPGl6KU12iseSe+w+1kFsLhX+OhQM8WXcWV10cGqBzQE9OqOLUcg9n0krrR3KrohstS9smTwEx9olyLYppvC0p5i7dAx2deWvM1ZxKNs0BvcXGukR+/g"</span> BCompare</span><br></pre></td></tr></table></figure></p>
<p>如果有权限问题：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">755</span> BCompare</span><br></pre></td></tr></table></figure></p>
<ol>
<li>打开软件，会提示Trial Mode Error！表示成功！输入Team ZWT生成的密钥，即可注册成功！</li>
</ol>
<h2 id="其他系统">其他系统</h2><p>此方法适用所有系统，包括win和os x！</p>
<h2 id="下载">下载</h2><p>Beyond Compare 4破解<a href="http://pan.baidu.com/s/1ntBs3A5" target="_blank" rel="external">下载地址</a>。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/tech/">tech</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/13/破解Beyond-Compare/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/13/Android-Fragment-No-View-Found-For-ID-Error/" title="Android Fragment - No View Found For ID Error" itemprop="url">Android Fragment - No View Found For ID Error</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-13T03:26:23.000Z" itemprop="datePublished"> 发表于 2015-07-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="说明">说明</h2><p>项目中很经常用到TAB，TAB不可避免就用到了ViewPager和FragmentPagerAdapter，这里不讨论<a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/app/FragmentPagerAdapter.html" target="_blank" rel="external">FragmentPagerAdapter</a>和<a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/app/FragmentStatePagerAdapter.html" target="_blank" rel="external">FragmentStatePagerAdapter</a>的<a href="http://stackoverflow.com/questions/18747975/difference-between-fragmentpageradapter-and-fragmentstatepageradapter" target="_blank" rel="external">区别</a>。<br>目前我遇到的问题，是在Pager Resume之后，会导致无法找到View ID，目前确认是因为View的Resume顺序导致的问题，在pager的fragment还未resume，而fragment下面的fragment已经开始恢复，导致视图找不到。目前还未有好的解决方案，故直接Pager持有，后面再解决。</p>
<h2 id="问题原因">问题原因</h2><h3 id="IDE问题">IDE问题</h3><p>在发生View问题时，如果是Eclipse或者是AS，都可以尝试clean下，然后再试试，特别是Eclipse比较经常发生这类问题！</p>
<h3 id="真的没ID">真的没ID</h3><p>再确认下自身XML布局，只有在content view中有这个ID，才能找到对应的View ID。<br>另外，也需要确认就是，R.id，而不是R.layout。</p>
<h3 id="FragmentManager获取错误">FragmentManager获取错误</h3><p>如果是在Fragment里面使用Fragment，那么要用<a href="http://developer.android.com/reference/android/app/Fragment.html#getChildFragmentManager(" target="_blank" rel="external">getChildFragmentManager()</a>)替代getSupportFragmentManager()，这会为当前Fragment创建一个FragmentManager，并与当前的Fragment生命周期相关联起来。具体可以参考<a href="http://developer.android.com/intl/zh-cn/about/versions/android-4.2.html#NestedFragments" target="_blank" rel="external">NestedFragments</a>。需要注意的是，如果使用Nested Fragments，是无法使用XML布局实现，需要在代码中动态添加Fragment。<br>如果需要其他的解决方案，网上也有一些可以参考的<a href="http://stackoverflow.com/questions/15608935/best-practice-for-nested-fragments-in-android-4-0-4-1-4-2-without-using-the" target="_blank" rel="external">事例</a>和<a href="https://gist.github.com/chrisjenx/3405429" target="_blank" rel="external">代码</a>。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You can now embed fragments inside fragments. This is useful <span class="keyword">for</span> a variety of situations <span class="keyword">in</span> <span class="built_in">which</span> you want to place dynamic and re-usable UI components into a UI component that is itself dynamic and re-usable. For example, <span class="keyword">if</span> you use ViewPager to create fragments that swipe left and right and consume a majority of the screen space, you can now insert fragments into each fragment page.</span><br></pre></td></tr></table></figure></p>
<h3 id="找不到的ID是0xFFFFFFFF">找不到的ID是0xFFFFFFFF</h3><p>ViewPager是一定要设置ID的，如果没有设置ID就会有这个问题。具体可以参考<a href="http://setohide.blogspot.se/2012/03/no-view-found-for-id-0xffffffff-for.html" target="_blank" rel="external">这里</a>。</p>
<h3 id="ID混乱">ID混乱</h3><p>如果你的视图中，有多个相同ID，那么也有可能会造成混乱，所以ID最好是唯一的，酱紫可以方便问题排查。</p>
<h3 id="旋转屏幕时错误">旋转屏幕时错误</h3><p>如果是在旋转屏幕时候有这个错误，那么可以考虑是否忘记移除setRetainInstance(true)的调用了。屏幕旋转如果没有处理，会重新初始化视图，那么有可能多个视图就会找不到ID了。</p>
<h3 id="DialogFragment里有ViewPager时错误">DialogFragment里有ViewPager时错误</h3><p>在使用Fragment的时候，如果里面有ViewPager的话，是需要传入getChildFragmentManager的，而不是getSupportFragmentManager，否则就会导致这个错误。</p>
<h3 id="视图还未建立，而ViewPager已经开始加载了">视图还未建立，而ViewPager已经开始加载了</h3><p>这个问题比较麻烦，所以才放到最后。<br>1、放到onActivityCreated的时候再操作Fragment，而不是在onCreateView的时候操作。<br>2、如果是ViewPager里面有ViewPager的话，那么考虑延迟恢复ViewPager视图，具体可参考<a href="http://stackoverflow.com/questions/19888539/illegalargumentexception-no-view-found-for-id-for-fragment-viewpager-in-vie" target="_blank" rel="external">这里</a>，关键代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerViewPager</span> <span class="keyword">extends</span> <span class="title">ViewPager</span> </span>&#123;</span><br><span class="line">    PagerAdapter mPagerAdapter;</span><br><span class="line"> </span><br><span class="line">    <span class="annotation">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow(); </span><br><span class="line">        <span class="keyword">if</span> (mPagerAdapter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">super</span>.setAdapter(mPagerAdapter);</span><br><span class="line">            mPageIndicator.setViewPager(<span class="keyword">this</span>);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="annotation">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdapter</span><span class="params">(PagerAdapter adapter)</span> </span>&#123;</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeAdapter</span><span class="params">(PagerAdapter pagerAdapter)</span> </span>&#123;</span><br><span class="line">        mPagerAdapter = pagerAdapter;</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BannerViewPager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BannerViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">        convertView = getBannerView(mParent);</span><br><span class="line">    &#125; </span><br><span class="line">    mViewPager = (ViewPager) convertView;</span><br><span class="line">    <span class="keyword">if</span> (mBanners != <span class="keyword">null</span> &amp;&amp; !mBanners.isEmpty()) &#123; </span><br><span class="line">        <span class="keyword">if</span> (mPagerAdapter == <span class="keyword">null</span>) &#123; </span><br><span class="line">            FragmentManager childFM = mFragment.getChildFragmentManager(); </span><br><span class="line">            removeOldFragment(childFM); </span><br><span class="line">            mPagerAdapter = <span class="keyword">new</span> ScreenSlidePagerAdapter(childFM, mBanners); </span><br><span class="line">            mViewPager.setAdapter(mPagerAdapter); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeOldFragment</span><span class="params">(FragmentManager fm)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">        Field added = fm.getClass().getDeclaredField(<span class="string">"mAdded"</span>);</span><br><span class="line">        added.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        added.set(fm, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">        Field active = fm.getClass().getDeclaredField(<span class="string">"mActive"</span>);</span><br><span class="line">        active.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        active.set(fm, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ref">Ref</h2><p><a href="http://solvedstack.com/questions/android-fragment-no-view-found-for-id" target="_blank" rel="external">android-fragment-no-view-found-for-id</a><br><a href="http://stackoverflow.com/questions/19888539/illegalargumentexception-no-view-found-for-id-for-fragment-viewpager-in-vie" target="_blank" rel="external">IllegalArgumentException: No view found for id for fragment — ViewPager in ViewPager</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/13/Android-Fragment-No-View-Found-For-ID-Error/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/10/Android-实现毛玻璃效果/" title="Android 实现毛玻璃效果" itemprop="url">Android 实现毛玻璃效果</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-10T12:05:22.000Z" itemprop="datePublished"> 发表于 2015-07-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>由于项目需要，需要实现毛玻璃效果，就是高斯模糊效果，实现方式如下。</p>
<h2 id="利用V_8包提供Render接口实现">利用V 8包提供Render接口实现</h2><p>利用现有ANDROID结构，通过RenderScript调用底层接口来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">blur</span><span class="params">(Bitmap bkg, View view)</span> </span>&#123;</span><br><span class="line">    …</span><br><span class="line">    RenderScript rs = RenderScript.create(getActivity());</span><br><span class="line">    Allocation overlayAlloc = Allocation.createFromBitmap(rs, overlay);</span><br><span class="line">    ScriptIntrinsicBlur blur = </span><br><span class="line">        ScriptIntrinsicBlur.create(rs, overlayAlloc.getElement());</span><br><span class="line">    blur.setInput(overlayAlloc);</span><br><span class="line">    blur.setRadius(radius);</span><br><span class="line">    blur.forEach(overlayAlloc);</span><br><span class="line">    overlayAlloc.copyTo(overlay);</span><br><span class="line">    view.setBackground(<span class="keyword">new</span> BitmapDrawable(getResources(), overlay));</span><br><span class="line">    rs.destroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这种方法直接利用Android系统提供的机制，从代码实现上是最简单也相对高效的实现。在此过程中遇到的很现实的问题是，直接使用ScriptIntrinsicBlur不能得到模糊程度较高的图片：</p>
<ol>
<li>当模糊半径 (radius)变大后会直接出现计算性能问题。</li>
<li>ScriptIntrinsicBlur脚本模糊半径不能大于25。<br>考虑到高斯模糊是计算周边像素平均值，在模糊程度很高的情况下，逐点计算平均值从显示效果上优势并不明显。可以通过将图片压缩成小图，计算小图的高斯模糊，再将小图放大的方法来模拟大半径高斯模糊的效果。</li>
</ol>
<h2 id="Java版实现">Java版实现</h2><p>这种方式通过在Java层中直接实现高斯模糊算法。在大模糊半径和大图片情况下，性能会出现问题。基本目前只作为对低版本Android客户端的兼容性方案使用。<br><a href="https://github.com/paveldudka/blurring/blob/master/app/src/main/java/com/paveldudka/util/FastBlur.java" target="_blank" rel="external">blurring/FastBlur.java</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/** </span><br><span class="line"> * Created by paveld on 3/6/14. </span><br><span class="line"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastBlur</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">doBlur</span><span class="params">(Bitmap sentBitmap, <span class="keyword">int</span> radius, <span class="keyword">boolean</span> canReuseInBitmap)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Stack Blur v1.0 from </span></span><br><span class="line">        <span class="comment">// http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// Java Author: Mario Klingemann &lt;mario at quasimondo.com&gt; </span></span><br><span class="line">        <span class="comment">// http://incubator.quasimondo.com </span></span><br><span class="line">        <span class="comment">// created Feburary 29, 2004 </span></span><br><span class="line">        <span class="comment">// Android port : Yahel Bouaziz &lt;yahel at kayenko.com&gt; </span></span><br><span class="line">        <span class="comment">// http://www.kayenko.com </span></span><br><span class="line">        <span class="comment">// ported april 5th, 2012 </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// This is a compromise between Gaussian Blur and Box blur </span></span><br><span class="line">        <span class="comment">// It creates much better looking blurs than Box Blur, but is </span></span><br><span class="line">        <span class="comment">// 7x faster than my Gaussian Blur implementation. </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// I called it Stack Blur because this describes best how this </span></span><br><span class="line">        <span class="comment">// filter works internally: it creates a kind of moving stack </span></span><br><span class="line">        <span class="comment">// of colors whilst scanning through the image. Thereby it </span></span><br><span class="line">        <span class="comment">// just has to add one new block of color to the right side </span></span><br><span class="line">        <span class="comment">// of the stack and remove the leftmost color. The remaining </span></span><br><span class="line">        <span class="comment">// colors on the topmost layer of the stack are either added on </span></span><br><span class="line">        <span class="comment">// or reduced by one, depending on if they are on the right or </span></span><br><span class="line">        <span class="comment">// on the left side of the stack. </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// If you are using this algorithm in your code please add </span></span><br><span class="line">        <span class="comment">// the following line: </span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="comment">// Stack Blur Algorithm by Mario Klingemann &lt;mario@quasimondo.com&gt; </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        Bitmap bitmap;</span><br><span class="line">        <span class="keyword">if</span> (canReuseInBitmap) &#123;</span><br><span class="line">            bitmap = sentBitmap;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            bitmap = sentBitmap.copy(sentBitmap.getConfig(), <span class="keyword">true</span>);</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (radius &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">null</span>); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> w = bitmap.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h = bitmap.getHeight();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span>[] pix = <span class="keyword">new</span> <span class="keyword">int</span>[w * h];</span><br><span class="line">        bitmap.getPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> wm = w - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> hm = h - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> wh = w * h;</span><br><span class="line">        <span class="keyword">int</span> div = radius + radius + <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> r[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> g[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> b[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> rsum, gsum, bsum, x, y, i, p, yp, yi, yw;</span><br><span class="line">        <span class="keyword">int</span> vmin[] = <span class="keyword">new</span> <span class="keyword">int</span>[Math.max(w, h)];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> divsum = (div + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        divsum *= divsum;</span><br><span class="line">        <span class="keyword">int</span> dv[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span> * divsum];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span> * divsum; i++) &#123;</span><br><span class="line">            dv[i] = (i / divsum);</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        yw = yi = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span>[][] stack = <span class="keyword">new</span> <span class="keyword">int</span>[div][<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> stackpointer;</span><br><span class="line">        <span class="keyword">int</span> stackstart;</span><br><span class="line">        <span class="keyword">int</span>[] sir;</span><br><span class="line">        <span class="keyword">int</span> rbs;</span><br><span class="line">        <span class="keyword">int</span> r1 = radius + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> routsum, goutsum, boutsum;</span><br><span class="line">        <span class="keyword">int</span> rinsum, ginsum, binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                p = pix[yi + Math.min(wm, Math.max(i, <span class="number">0</span>))];</span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line">                rsum += sir[<span class="number">0</span>] * rbs;</span><br><span class="line">                gsum += sir[<span class="number">1</span>] * rbs;</span><br><span class="line">                bsum += sir[<span class="number">2</span>] * rbs;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            stackpointer = radius;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                r[yi] = dv[rsum];</span><br><span class="line">                g[yi] = dv[gsum];</span><br><span class="line">                b[yi] = dv[bsum];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[x] = Math.min(x + radius + <span class="number">1</span>, wm);</span><br><span class="line">                &#125; </span><br><span class="line">                p = pix[yw + vmin[x]];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[(stackpointer) % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                yi++;</span><br><span class="line">            &#125; </span><br><span class="line">            yw += w;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            yp = -radius * w;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                yi = Math.max(<span class="number">0</span>, yp) + x;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = r[yi];</span><br><span class="line">                sir[<span class="number">1</span>] = g[yi];</span><br><span class="line">                sir[<span class="number">2</span>] = b[yi];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += r[yi] * rbs;</span><br><span class="line">                gsum += g[yi] * rbs;</span><br><span class="line">                bsum += b[yi] * rbs;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (i &lt; hm) &#123;</span><br><span class="line">                    yp += w;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            yi = x;</span><br><span class="line">            stackpointer = radius;</span><br><span class="line">            <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">                <span class="comment">// Preserve alpha channel: ( 0xff000000 &amp; pix[yi] ) </span></span><br><span class="line">                pix[yi] = (<span class="number">0xff000000</span> &amp; pix[yi]) | (dv[rsum] &lt;&lt; <span class="number">16</span>) | (dv[gsum] &lt;&lt; <span class="number">8</span>) | dv[bsum];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[y] = Math.min(y + r1, hm) * w;</span><br><span class="line">                &#125; </span><br><span class="line">                p = x + vmin[y];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                sir[<span class="number">0</span>] = r[p];</span><br><span class="line">                sir[<span class="number">1</span>] = g[p];</span><br><span class="line">                sir[<span class="number">2</span>] = b[p];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[stackpointer];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                yi += w;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        bitmap.setPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> (bitmap);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二个方式通过直接计算高斯并直接在视图画布上实现。<br>BlurLinearLayout.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BlurCalculate mBlurCalculate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurLinearLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        mBlurCalculate = <span class="keyword">new</span> BlurCalculate(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurLinearLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * radius for linearlayout**</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBlurCalculate != <span class="keyword">null</span>)</span><br><span class="line">            mBlurCalculate.setRadius(radius);</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow();</span><br><span class="line">        mBlurCalculate.onAttachedToWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">        mBlurCalculate.bluronDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBlurCalculate.isCanvasChanged(canvas))</span><br><span class="line">            mBlurCalculate.blurCanvas();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            mBlurCalculate.drawCanvas(canvas);</span><br><span class="line">            <span class="keyword">super</span>.dispatchDraw(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>BlurCalculate.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.Allocation;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.Element;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.RenderScript;</span><br><span class="line"><span class="keyword">import</span> android.support.v8.renderscript.ScriptIntrinsicBlur;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewTreeObserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurCalculate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> BITMAP_RATIO = <span class="number">0.1f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View mView;</span><br><span class="line">    <span class="keyword">private</span> Bitmap mBitmap;</span><br><span class="line">    <span class="keyword">private</span> Canvas mCanvas;</span><br><span class="line">    <span class="keyword">private</span> Rect mRect;</span><br><span class="line">    <span class="keyword">private</span> Matrix mMatrix;</span><br><span class="line">    <span class="keyword">private</span> Matrix mDrawMatrix;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRealHeight, mRealWidth;</span><br><span class="line">    <span class="keyword">private</span> RenderScript mRenderScript;</span><br><span class="line">    <span class="keyword">private</span> Allocation mInput;</span><br><span class="line">    <span class="keyword">private</span> Allocation mOutput;</span><br><span class="line">    <span class="keyword">private</span> ScriptIntrinsicBlur mScript;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRadius = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mAction = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlurCalculate</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mView = view;</span><br><span class="line">        mRenderScript = RenderScript.create(view.getContext());</span><br><span class="line">        mCanvas = <span class="keyword">new</span> Canvas();</span><br><span class="line">        mRect = <span class="keyword">new</span> Rect();</span><br><span class="line">        mMatrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">        mDrawMatrix = <span class="keyword">new</span> Matrix();</span><br><span class="line"></span><br><span class="line">        mDrawMatrix.setScale(<span class="number">10.0f</span>, <span class="number">10.0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAction</span><span class="params">(<span class="keyword">int</span> action)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mAction = action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCanvasChanged</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> canvas == mCanvas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getViewTreeObserver().addOnPreDrawListener(onPreDrawListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bluronDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getViewTreeObserver().removeOnPreDrawListener(onPreDrawListener);</span><br><span class="line">        <span class="keyword">if</span> (mBitmap != <span class="keyword">null</span>)</span><br><span class="line">            mBitmap.recycle();</span><br><span class="line">        mBitmap = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCanvas</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBitmap != <span class="keyword">null</span>)</span><br><span class="line">            canvas.drawBitmap(mBitmap, mDrawMatrix, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blurCanvas</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mInput = Allocation.createFromBitmap(mRenderScript, mBitmap, Allocation.MipmapControl.MIPMAP_NONE,</span><br><span class="line">                Allocation.USAGE_SCRIPT);</span><br><span class="line">        mOutput = Allocation.createTyped(mRenderScript, mInput.getType());</span><br><span class="line">        mScript = ScriptIntrinsicBlur.create(mRenderScript, Element.U8_4(mRenderScript));</span><br><span class="line">        mScript.setRadius(mRadius);</span><br><span class="line">        mScript.setInput(mInput);</span><br><span class="line">        mScript.forEach(mOutput);</span><br><span class="line">        mOutput.copyTo(mBitmap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mRadius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getScreenBitmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mView.getGlobalVisibleRect(mRect);</span><br><span class="line">        mRealHeight = mView.getHeight();</span><br><span class="line">        mRealWidth = mView.getWidth();</span><br><span class="line">        <span class="keyword">int</span> w = Math.round(mRealWidth * BITMAP_RATIO) + <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">int</span> h = Math.round(mRealHeight * BITMAP_RATIO) + (mAction == <span class="number">0</span> ? -<span class="number">4</span> : <span class="number">4</span>);</span><br><span class="line">        w = w &amp; ~<span class="number">0x03</span>;</span><br><span class="line">        h = h &amp; ~<span class="number">0x03</span>;</span><br><span class="line">        <span class="keyword">if</span> (w &lt;= <span class="number">0</span> || h &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (mBitmap == <span class="keyword">null</span> || mBitmap.getWidth() != w || mBitmap.getHeight() != h) &#123;</span><br><span class="line">            mBitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">            mMatrix.setScale(BITMAP_RATIO, BITMAP_RATIO);</span><br><span class="line">            mMatrix.invert(mDrawMatrix);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(mView.getBottom()-mView.getTop())</span></span><br><span class="line">        <span class="keyword">float</span> dx = -(Math.min(<span class="number">0</span>, mView.getLeft()) + mRect.left);</span><br><span class="line">        <span class="keyword">float</span> dy = mAction == <span class="number">0</span> ? (-(Math.min(<span class="number">0</span>, mView.getTop()) + mRect.top)) : -(mRect.bottom - ((mView.getBottom() - mView.getTop())));</span><br><span class="line">        mCanvas.restoreToCount(<span class="number">1</span>);</span><br><span class="line">        mCanvas.setBitmap(mBitmap);</span><br><span class="line">        mCanvas.setMatrix(mMatrix);</span><br><span class="line">        mCanvas.translate(dx, dy);</span><br><span class="line">        mCanvas.save();</span><br><span class="line">        mView.getRootView().draw(mCanvas);</span><br><span class="line">        <span class="comment">//mCanvas.setBitmap(null);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ViewTreeObserver.OnPreDrawListener onPreDrawListener = <span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (mView.getVisibility() == View.VISIBLE)</span><br><span class="line">                getScreenBitmap();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果是android studio的话，添加V8包方法：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    renderscriptTargetApi <span class="number">18</span></span><br><span class="line">    renderscriptSupportModeEnabled <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="第三方库实现">第三方库实现</h2><p><a href="https://github.com/harism/android_anndblur" target="_blank" rel="external">android_anndblur</a>:<br>Project for implementing background blur effect for Android devices<br><a href="https://github.com/kikoso/android-stackblur" target="_blank" rel="external">android-stackblur</a>:<br>Android StackBlur is a library that can perform a blurry effect on a Bitmap based on a gradient or radius, and return the result. The library is based on the code of Mario Klingemann.</p>
<h2 id="OpenGL实现">OpenGL实现</h2><p>无论从效果和实时性来讲都是最好的，但需要根据需求来看是否真的有这样的实时性要求。这种方式从显示效果上会优于第一种方法，甚至可以达到渐变的效果，但这些计算都是以耗电作为代价的。作为Launcher这种系统级别的应用，在显示效果差异并不明显的情况下，建议综合考虑耗电量，以及内存和计算性能的消耗。</p>
<h2 id="Ref">Ref</h2><p><a href="https://github.com/paveldudka/blurring" target="_blank" rel="external">blurring</a><br><a href="http://www.zhihu.com/question/27017363" target="_blank" rel="external">Android（Android5.0）下毛玻璃（磨砂）效果如何实现？</a><br><a href="http://blog.jobbole.com/63894/" target="_blank" rel="external">Android高级模糊技术</a><br><a href="https://github.com/harism/android_anndblur" target="_blank" rel="external">android_anndblur</a><br><a href="https://github.com/kikoso/android-stackblur" target="_blank" rel="external">android-stackblur</a><br><a href="https://developer.android.com/intl/zh-cn/tools/support-library/features.html#v8" target="_blank" rel="external">v8 Support Library</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/10/Android-实现毛玻璃效果/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/10/Android-ToolBar-Widget-Usage/" title="Android ToolBar Widget Usage" itemprop="url">Android ToolBar Widget Usage</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-10T08:03:39.000Z" itemprop="datePublished"> 发表于 2015-07-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>从2014年Google I/O大会发表了Material Design之后，其也开始陆陆续续更新了Android APP的界面设计接口，在ActionBar之后，Android在support library里面也提供了更多的API给开发者使用。在Material Design之中有一个名称为App Bar，用来取代过去的Action Bar控件，本篇就以此为引，为大家介绍下Tool Bar的使用和自定义。<br>在推出Material Design之后，官方在某些方面也感觉到ActionBar限制了应用开发的弹性，接下来，将分为基本用法、自定义控件及针对ToolBar的总结，为大家介绍下这个控件。</p>
<h2 id="基本用法">基本用法</h2><p>ToolBar已经集成在V7支持包中，要使用也相对较为简单，基本可分为三步：</p>
<ol>
<li>新增ToolBar样式</li>
<li>XML布局中新增ToolBar</li>
<li>在程序中替代ActionBar</li>
</ol>
<h3 id="一、新增ToolBar样式">一、新增ToolBar样式</h3><p>在低版本中，我们需要禁用windowActionBar及window title，在V21以上（5.0以上）可不用。<br>value/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme.Base"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat"</span>&gt;</span><span class="css"></span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowActionBar</span>"&gt;<span class="tag">false</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">windowNoTitle<span class="string">"&gt;true&lt;/item&gt;</span><br><span class="line">  </span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在新版本中，也可直接继承自Theme.AppCompat.NoActionBar。<br>values-v21/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="二、XML布局中新增ToolBar">二、XML布局中新增ToolBar</h3><p>新增布局文件toolbar_actionbar.xml文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"?actionBarSize"</span></span><br><span class="line">    <span class="attribute">android:background</span>=<span class="value">"@null"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>之后，在主XML布局文件中，即可以include方式集成：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">include</span> <span class="attribute">layout</span>=<span class="value">"@layout/toolbar_actionbar"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在使用过程中，也可自定义样式，比如text appearance等，增加对ToolBar的定制。</p>
<h3 id="三、程序中替代ActionBar">三、程序中替代ActionBar</h3><p>关键代码只有一行，即替代原有目前的ActionBar。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">setSupportActionBar(mActionBarToolbar);</span><br></pre></td></tr></table></figure></p>
<p>之后，即可使用mActionBarToolBar进行操作，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mActionBarToolbar.setTitle();</span><br><span class="line">mActionBarToolbar.setSubtitle();</span><br><span class="line">mActionBarToolbar.setNavigationIcon()</span><br><span class="line">mActionBarToolbar.setLogo()</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h3 id="四、单独使用而不与ActionBar进行关联">四、单独使用而不与ActionBar进行关联</h3><p>在前一节中设置与ActionBar进行关联，如果不进行关联也是可以使用。即执行方法：setSupportActionBar，那么Menu的操作也不用在onCreateOptionsMenu方法，直接使用ToolBar的inflateMenu方法，Menu的事件也是独立的，需要通过设置ToolBar的setOnMenuItemClickListener来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">toolbar.setOnMenuItemClickListener(<span class="keyword">new</span> Toolbar.OnMenuItemClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> id = menuItem.getItemId();</span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_add_new_item) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="自定义ToolBar">自定义ToolBar</h2><p>自定义ToolBar我们将从配色开始，到自定义我们的布局，比如Title居中等要求。</p>
<ol>
<li>自定义配色</li>
<li>ToolBar控件</li>
<li>自定义布局</li>
</ol>
<h3 id="一、自定义配色">一、自定义配色</h3><p>基本分为四块配色：<br>1、状态栏底色（看电量时间的那栏）：在style中设置主题的colorPrimaryDark属性<br>2、AppBar底色（应用栏）：分为两种，一个是ActionBar的话，在style中设置主题的colorPrimary属性；第二个是如果使用Tool Bar的话，直接设置ToolBar的background属性。<br>3、主窗口底色（就是我们AppBar下方的应用界面）：style设置主题windowBackground属性。<br>4、导航列底色：在V 21之后，在应用底部有新增导航列，即左右切换等快捷操作。在values-v21/style中设置主题的navigationBarColor属性。<br>values/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme.Base"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat"</span>&gt;</span><span class="css"></span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">windowActionBar</span>"&gt;<span class="tag">false</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">windowNoTitle<span class="string">"&gt;true&lt;/item&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;!-- Actionbar color --&gt;</span><br><span class="line">  &lt;item name="</span>colorPrimary<span class="string">"&gt;@color/accent_material_dark&lt;/item&gt;</span><br><span class="line">  &lt;!--Status bar color--&gt;</span><br><span class="line">  &lt;item name="</span>colorPrimaryDark<span class="string">"&gt;@color/accent_material_light&lt;/item&gt;</span><br><span class="line">  &lt;!--Window color--&gt;</span><br><span class="line">  &lt;item name="</span>android:windowBackground<span class="string">"&gt;@color/dim_foreground_material_dark&lt;/item&gt;</span><br><span class="line"></span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>values-v21/styles.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">  &lt;!<span class="tag">--Navigation</span> <span class="tag">bar</span> <span class="tag">color--</span>&gt;</span><br><span class="line">  &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">navigationBarColor<span class="string">"&gt;@color/accent_material_light&lt;/item&gt;</span><br><span class="line"></span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Tool Bar背景色：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">  <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">  <span class="attribute">android:layout_height</span>=<span class="value">"?attr/actionBarSize"</span></span><br><span class="line">  <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">  <span class="attribute">android:background</span>=<span class="value">"?attr/colorPrimary"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="二、ToolBar控件">二、ToolBar控件</h3><p>从做到右依次为：<br>Icon —- Logo —- Title —- —- —- —- Menu</p>
<ol>
<li>Icon：设置向上的图标，即在二级页面时候，返回上级图标，调用setNavigationIcon方法设置，在Material Design上，新的向上图标也有别于ActionBar。</li>
<li>Logo：应用的LOGO，setLogo方法。</li>
<li>Title：标题，调用setTitle方法。还有副标题可设置，setSubtitle方法。</li>
<li>Menu：设置菜单按钮及事件，setOnMenuItemClickListener方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar_actionbar);</span><br><span class="line"><span class="comment">// App Logo</span></span><br><span class="line">toolbar.setLogo(R.drawable.ic_launcher);</span><br><span class="line"><span class="comment">// Title</span></span><br><span class="line">toolbar.setTitle(<span class="string">"My Title"</span>);</span><br><span class="line"><span class="comment">// Sub Title</span></span><br><span class="line">toolbar.setSubtitle(<span class="string">"Sub title"</span>);</span><br><span class="line">setSupportActionBar(toolbar);</span><br><span class="line"><span class="comment">// Navigation Icon 设置需要在设置完 setSupoortActionBar 之后</span></span><br><span class="line"><span class="comment">// 否则会出现 back button</span></span><br><span class="line">toolbar.setNavigationIcon(R.drawable.ab_android);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Menu的设置也很简单：<br>首先设置menu.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">menu</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">      <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">      <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">      <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_edit"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_edit"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"80"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/ab_edit"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"ifRoom"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_share"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_edit"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"90"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/ab_share"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"ifRoom"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@+id/action_settings"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"@string/action_settings"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">app:showAsAction</span>=<span class="value">"never"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其次代码中设置监听：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Toolbar.OnMenuItemClickListener onMenuItemClick = <span class="keyword">new</span> Toolbar.OnMenuItemClickListener() &#123;</span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (menuItem.getItemId()) &#123;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_edit:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_share:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> R.id.action_settings:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Menu item click 的监听事件要在设置完 setSupportActionBar 之后才可以</span></span><br><span class="line">toolbar.setOnMenuItemClickListener(onMenuItemClick);</span><br></pre></td></tr></table></figure></p>
<h3 id="三、自定义布局">三、自定义布局</h3><p>如果想将title修改为居中，此时系统自带的ToolBar的setTitle已经无法满足我们的需求了，此时需要自定义ToolBar布局及控件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_actionbar"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"?actionBarSize"</span></span><br><span class="line">    <span class="attribute">android:background</span>=<span class="value">"@null"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/toolbar_title"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/TextAppearance.AppCompat.Widget.ActionBar.Title"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_gravity</span>=<span class="value">"center"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重载setContentView(int resid)方法，并调用此方法，需要注意的是，因为我们使用自己的title视图，所以需要禁用系统的title显示，也就是setDisplayShowTitleEnabled方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Toolbar <span class="title">getActionBarToolbar</span><span class="params">(AppCompatActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mActionBarToolbar == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">        mTitleView = (TextView) mActionBarToolbar.findViewById(R.id.toolbar_title);</span><br><span class="line">        <span class="keyword">if</span> (mActionBarToolbar != <span class="keyword">null</span>) &#123;</span><br><span class="line">            activity.setSupportActionBar(mActionBarToolbar);</span><br><span class="line">            <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">                activity.getSupportActionBar().setDisplayShowTitleEnabled(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mActionBarToolbar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后，我们需要设置标题联动，这里可以使用activity里面的一个onTitleChanged监听，这个监听在Activity的onPostCreate和setTitle方法都会调用，在Fragment切换时候，也可以很方便的调用getActivity().setTitle()即可修改标题栏。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onTitleChanged</span><span class="params">(CharSequence title, <span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onTitleChanged(title, color);</span><br><span class="line">    <span class="keyword">if</span>(mToolBarHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mToolBarHelper.setTitle(title);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>附带上所有java代码：<br>activity中代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(<span class="keyword">int</span> layoutResID)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.setContentView(layoutResID);</span><br><span class="line">    mToolBarHelper = <span class="keyword">new</span> ToolBarHelper();</span><br><span class="line">    mToolBarHelper.getActionBarToolbar(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ToolBarHelper <span class="title">getToolBarHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mToolBarHelper;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onTitleChanged</span><span class="params">(CharSequence title, <span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onTitleChanged(title, color);</span><br><span class="line">    <span class="keyword">if</span>(mToolBarHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mToolBarHelper.setTitle(title);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ToolBarHelper.java代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToolBarHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Toolbar mActionBarToolbar;</span><br><span class="line">    <span class="keyword">private</span> TextView mTitleView;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Toolbar <span class="title">getActionBarToolbar</span><span class="params">(AppCompatActivity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mActionBarToolbar == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mActionBarToolbar = (Toolbar) activity.findViewById(R.id.toolbar_actionbar);</span><br><span class="line">            mTitleView = (TextView) mActionBarToolbar.findViewById(R.id.toolbar_title);</span><br><span class="line">            <span class="keyword">if</span> (mActionBarToolbar != <span class="keyword">null</span>) &#123;</span><br><span class="line">                activity.setSupportActionBar(mActionBarToolbar);</span><br><span class="line">                <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    activity.getSupportActionBar().setDisplayShowTitleEnabled(<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mActionBarToolbar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(<span class="keyword">int</span> resid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTitleView.setText(resid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(CharSequence title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mTitleView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTitleView.setText(title);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="结语">结语</h2><p>相比而言，ToolBar比ActionBar改进很多，而且其易用性方面也有很大提高，我们也可以不用再自己手动去制作应用标题了。</p>
<h2 id="Ref">Ref</h2><p><a href="http://angeldevil.me/2014/12/24/toolbar-as-actionbar-and-centered-title/" target="_blank" rel="external">Toolbar作为ActionBar与标题居中</a><br><a href="http://developer.android.com/intl/zh-cn/reference/android/support/v7/widget/Toolbar.html" target="_blank" rel="external">Class Toolbar</a><br><a href="http://blog.mosil.biz/2014/10/android-toolbar/" target="_blank" rel="external">ANDROID-TOOLBAR STEP BY STEP</a><br><a href="http://android-developers.blogspot.com/2014/10/appcompat-v21-material-design-for-pre.html" target="_blank" rel="external">Material Design for Pre-Lollipop Devices</a><br><a href="http://www.google.com/design/spec/layout/structure.html#structure-app-bar" target="_blank" rel="external">structure-app-bar</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/10/Android-ToolBar-Widget-Usage/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/08/Android-Studio-With-SVN/" title="Android Studio With SVN" itemprop="url">Android Studio With SVN</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-08T12:17:08.000Z" itemprop="datePublished"> 发表于 2015-07-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="环境">环境</h2><p>系统使用Ubuntu 12.04，SVN版本1.8.8，AS使用最新稳定1.2.2。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn, version <span class="number">1.8</span>.<span class="number">8</span> (r1568071)</span><br><span class="line">   compiled Aug <span class="number">13</span> <span class="number">2014</span>, <span class="number">17</span>:<span class="number">12</span>:<span class="number">39</span> on x86_64-pc-linux-gnu</span><br></pre></td></tr></table></figure></p>
<h2 id="配置AS">配置AS</h2><p>配置AS很简单。<br>1、配置SVN执行目录：<br>File -&gt; Settings -&gt; Version Control -&gt; Subversion -&gt; General Tab里面的Use command line client，如果你已经安装SVN，AS应该默认是配置好的。<br>2、上传你的文件到SVN：<br>VCS -&gt; Import into Version Control -&gt; Import into Subversion…之后就可在线上版本查看到文件已经同步。<br>3、为项目新增SVN管理：<br>VCS -&gt; Enable Version Control Integration… 简单配置，即可在面板上有UP和CI等版本操作的图标。<br>至此，AS配置完成。</p>
<h2 id="设置SVN_IGNORE">设置SVN IGNORE</h2><p>一直不知道SVN如何设置忽略命令，网上看的很多都是不准确或者理解有偏差。<br>1、设置全局忽略文件列表：<br>编辑~/.subversion/config文件，修改此文件中的global-ignores，里面也有提供实例。<br>当然，如果你想修改所有用户的ignore，文件目录在/etc/subversion/config。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global-ignores = *.o *.lo *.la *.al .libs *.so *.so.[0-9]* *.a *.pyc *.pyo</span></span><br><span class="line"><span class="comment">#   *.rej *~ #*# .#* .*.swp .DS_Store</span></span><br></pre></td></tr></table></figure></p>
<p>2、设置某目录svn ignore：<br>关键是使用svn的property set命令，此命令不可递归，只能设置当前目录下的ignore规则。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">svn pe svn:ignore path</span><br><span class="line"><span class="comment"># svn propedit svn:ignore path</span></span><br><span class="line">svn pd svn:ignore path</span><br><span class="line"><span class="comment"># svn propdel svn:ignore path</span></span><br><span class="line">svn ps svn:ignore path</span><br><span class="line"><span class="comment"># svn propset svn:ignore path</span></span><br></pre></td></tr></table></figure></p>
<p>如果当前目录结构为：<br>.<br>|<br>|-Android<br>|   |<br>|   - trunk<br>|   - branches<br>|   - tags<br>|-iOS<br>想要过滤trunk目录下某些文件或目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn pe svn:ignore Android/trunk</span><br></pre></td></tr></table></figure></p>
<p>之后会打开编辑窗口，输入下方文件即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.gradle</span><br><span class="line">local.properties</span><br><span class="line">.DS_Store</span><br><span class="line">build</span><br><span class="line">captures</span><br><span class="line">proguard</span><br></pre></td></tr></table></figure></p>
<p>附带完整svn ignore命令（svn st命令，可以查看当前状态）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> project-path</span><br><span class="line">svn pe Android/trunk</span><br><span class="line">svn pe Android/trunk/.idea</span><br><span class="line">svn pe Android/trunk/app</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.gradle</span><br><span class="line">local.properties</span><br><span class="line">.DS_Store</span><br><span class="line">build</span><br><span class="line">captures</span><br><span class="line">proguard</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk/.idea下的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workspace.xml</span><br><span class="line">libraries</span><br></pre></td></tr></table></figure></p>
<p>Android/trunk/app下的ignore：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build</span><br></pre></td></tr></table></figure></p>
<p>设置完成，使用svn ci -m ‘ignore files’即可。<br>附带.ignore文件为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Built application files</span></span><br><span class="line">*.apk</span><br><span class="line">*.ap_</span><br><span class="line"></span><br><span class="line"><span class="comment"># Files for the Dalvik VM</span></span><br><span class="line">*.dex</span><br><span class="line"></span><br><span class="line"><span class="comment"># Java class files</span></span><br><span class="line">*.class</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated files</span></span><br><span class="line">bin/</span><br><span class="line">gen/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gradle files</span></span><br><span class="line">.gradle/</span><br><span class="line">build/</span><br><span class="line">/*/build/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Local configuration file (sdk path, etc)</span></span><br><span class="line">local.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># Proguard folder generated by Eclipse</span></span><br><span class="line">proguard/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log Files</span></span><br><span class="line">*.log</span><br><span class="line"></span><br><span class="line">/.idea/workspace.xml</span><br><span class="line">/.idea/libraries</span><br><span class="line">.DS_Store</span><br><span class="line">/capture</span><br></pre></td></tr></table></figure></p>
<p>附带命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svn ps svn:ignore <span class="string">'ignorefile'</span> dir</span><br><span class="line">svn up</span><br><span class="line">svn commit -m <span class="string">'ignore ignorefile'</span></span><br><span class="line"></span><br><span class="line">svn <span class="built_in">export</span> dir dir_bak</span><br><span class="line">svn rm dir</span><br><span class="line">svn commit -m <span class="string">'delete dir'</span></span><br><span class="line">mv dir-bak dir</span><br><span class="line">svn ps svn:ignore <span class="string">'ignorefile'</span> dir</span><br><span class="line">svn up</span><br><span class="line">svn commit -m <span class="string">'ignore ignorefile'</span></span><br><span class="line"></span><br><span class="line">svn ps svn:ignore <span class="string">'ignorefile1</span><br><span class="line">ignorefile2</span><br><span class="line">ignorefile3'</span> dir</span><br></pre></td></tr></table></figure></p>
<h2 id="SVN常用命令">SVN常用命令</h2><p>Show The Code:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">svn co svn://xxx</span><br><span class="line">svn checkout svn://</span><br><span class="line">svn <span class="built_in">export</span> [-r version] svn://</span><br><span class="line">svn add file</span><br><span class="line">svn commit -m <span class="string">''</span></span><br><span class="line">svn ci -m <span class="string">''</span></span><br><span class="line">svn up</span><br><span class="line">svn update</span><br><span class="line">svn update -r <span class="number">200</span> file</span><br><span class="line">svn delete svn:// -m <span class="string">''</span></span><br><span class="line">svn delete file</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/08/Android-Studio-With-SVN/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/19/Android-Project-Templete/" title="Android Project Templete" itemprop="url">Android Project Templete</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-06-19T08:25:20.000Z" itemprop="datePublished"> 发表于 2015-06-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Android更新迭代很快，而公司业务也在不断扩张，需要这个项目模板来帮助我们快速构建新的应用程序。而且Android的库也在不断的更新换代，包括网络请求库、图片库、JSON解析库等，需要我们不断的更新自身的项目结构，与Android系统保持同步更新，在兼容适配等会更有好处。<br>本库包含了通用的网络库、图片库、内存检测库、底部TAB库等，基本满足项目的前期构建。还包括了脚本编译多渠道包等其他功能，具体可以clone下来自己把玩把玩~~<br>如果有任何建议或者意见，随时联系，也可以pull request到分支。<br><a href="https://github.com/hwangjr/AndroidProjectTemplete" target="_blank" rel="external">AndroidProjectTemplete</a><br>目前已经包含的库有：<br>1、appcompat-v7:22.2.0<br>2、<a href="https://github.com/square/retrofit" target="_blank" rel="external">retrofit:1.9.0</a><br>3、<a href="https://github.com/square/okhttp/tree/master/okhttp-urlconnection" target="_blank" rel="external">okhttp-urlconnection:2.4.0</a><br>4、<a href="https://github.com/square/okhttp" target="_blank" rel="external">okhttp:2.4.0</a><br>5、<a href="https://github.com/square/okio" target="_blank" rel="external">okio:1.4.0</a><br>6、<a href="https://github.com/OrangeGangsters/SwipyRefreshLayout" target="_blank" rel="external">swipy:1.2</a><br>7、<a href="https://github.com/wasabeef/recyclerview-animators" target="_blank" rel="external">recyclerview-animators:1.2</a><br>8、support-v4:22.2.0<br>9、<a href="https://github.com/bumptech/glide" target="_blank" rel="external">glide:3.6.0</a><br>10、<a href="https://github.com/square/leakcanary" target="_blank" rel="external">leakcanary-android:1.3.1</a><br>11、<a href="https://github.com/google/gson" target="_blank" rel="external">GSON</a><br>11、自写底部Tab库（解决Fragment嵌套等问题）</p>
<p>build.gradle:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span><br><span class="line">    compile <span class="string">'com.android.support:appcompat-v7:22.2.0'</span></span><br><span class="line">    compile <span class="string">'com.squareup.retrofit:retrofit:1.9.0'</span></span><br><span class="line">    compile <span class="string">'com.squareup.okhttp:okhttp-urlconnection:2.4.0'</span></span><br><span class="line">    compile <span class="string">'com.squareup.okhttp:okhttp:2.4.0'</span></span><br><span class="line">    compile <span class="string">'com.squareup.okio:okio:1.4.0'</span></span><br><span class="line">    compile <span class="string">'com.github.orangegangsters:swipy:1.2.0@aar'</span></span><br><span class="line">    compile <span class="string">'jp.wasabeef:recyclerview-animators:1.2.0@aar'</span></span><br><span class="line">    compile <span class="string">'com.android.support:support-v4:22.2.0'</span></span><br><span class="line">    compile <span class="string">'com.github.bumptech.glide:glide:3.6.0'</span></span><br><span class="line">    debugCompile <span class="string">'com.squareup.leakcanary:leakcanary-android:1.3.1'</span></span><br><span class="line">    releaseCompile <span class="string">'com.squareup.leakcanary:leakcanary-android-no-op:1.3.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/06/19/Android-Project-Templete/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/16/Android-Network-Library/" title="Android Network Library" itemprop="url">Android Network Library</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-06-16T13:09:18.000Z" itemprop="datePublished"> 发表于 2015-06-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>There are so many android library to help us to develop the better apps:<br><a href="https://android.googlesource.com/platform/frameworks/volley" target="_blank" rel="external">Volley</a><br><a href="https://github.com/mcxiaoke/android-volley" target="_blank" rel="external">android-volley</a><br><a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit</a><br><a href="http://square.github.io/okhttp/" target="_blank" rel="external">OkHttp</a><br><a href="https://github.com/koush/ion" target="_blank" rel="external">ion</a><br><a href="http://loopj.com/android-async-http/" target="_blank" rel="external">Android Asynchronous Http Client</a></p>
<p>The installation of volley is:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://android.googlesource.com/platform/frameworks/volley</span><br><span class="line"><span class="built_in">cd</span> volley</span><br><span class="line">android update project -p</span><br><span class="line">ant jar</span><br></pre></td></tr></table></figure></p>
<ol>
<li>Volley is encourage by google io, and google use it for many products.</li>
<li>Retrofit is a type-safe REST client for Android and Java.</li>
<li>Retrofit introduce the api design like twiter, separate api into many modules.</li>
<li>Retrofit is ridiculously fast, use gson for default json parser.</li>
<li>Retrofit meshes quite well with api architecture.<br>etc..<br>So, i decide to use Retrofit for my new project.</li>
</ol>
<p>Further reading:<br><a href="http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/" target="_blank" rel="external">Android Async HTTP Clients: Volley vs Retrofit</a><br><a href="http://stackoverflow.com/questions/16902716/comparison-of-android-networking-libraries-okhttp-retrofit-volley" target="_blank" rel="external">Comparison of Android Networking Libraries: OkHTTP, Retrofit, Volley</a><br><a href="https://www.bignerdranch.com/blog/solving-the-android-image-loading-problem-volley-vs-picasso/" target="_blank" rel="external">Solving the Android image loading problem: Volley vs. Picasso</a><br><a href="https://futurestud.io/blog/retrofit-getting-started-and-android-client/" target="_blank" rel="external">Retrofit — Getting Started and Create an Android Client</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/06/16/Android-Network-Library/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/15/Hexo-Basic-Usage/" title="Hexo Basic Usage" itemprop="url">Hexo Basic Usage</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-06-15T08:10:02.000Z" itemprop="datePublished"> 发表于 2015-06-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>This is just a tips about Hexo.</p>
<h2 id="Installation">Installation</h2><p>Just node.js and git:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node.js</span></span><br><span class="line">wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh</span><br><span class="line">nvm install <span class="number">0.12</span></span><br><span class="line"><span class="comment"># hexo</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"><span class="comment"># update</span></span><br><span class="line"><span class="comment"># npm update -g hexo-cli</span></span><br><span class="line"><span class="comment"># git</span></span><br><span class="line">yum install git</span><br><span class="line"><span class="comment"># apt-get install git</span></span><br></pre></td></tr></table></figure></p>
<p>When computer reboot, u need to reload the node.js:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvm ls</span><br><span class="line">nvm use <span class="number">0.12</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Common_Usage">Common Usage</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># new blog</span></span><br><span class="line">hexo n <span class="string">""</span></span><br><span class="line"><span class="comment"># generate</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="comment"># deploy</span></span><br><span class="line">hexo d</span><br><span class="line"><span class="comment"># publish</span></span><br><span class="line">hexo p</span><br><span class="line"><span class="comment"># server</span></span><br><span class="line">hexo s</span><br><span class="line"><span class="comment"># clean</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="comment"># deploy with comment</span></span><br><span class="line">hexo d -m <span class="string">""</span></span><br></pre></td></tr></table></figure>
<h2 id="Reference">Reference</h2><p><a href="https://hexo.io/docs/index.html" target="_blank" rel="external">Hexo Doc</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Hexo/">Hexo</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Hexo/">Hexo</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/06/15/Hexo-Basic-Usage/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/CI/" title="CI">CI<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/tech/" title="tech">tech<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/创业/" title="创业">创业<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/tech/" title="tech">tech<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/创业/" title="创业">创业<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ci/" title="ci">ci<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.hwangjr.com" target="_blank" title="HwangJR&#39;s Blog">HwangJR&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, Welcome to my blog. <br/>
			I&#39;m HwangJR, Tech change the world.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1234193120" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/https://github.com/hwangjr" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/4827228" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/HuangJR" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/https://facebook.com/jr.hwang.2010" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		<a href="https://www.zhihu.com/people/hwangjr" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/+JianrongHuang?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:huangjianrong2010@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="HwangJR">HwangJR</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'HwangJR';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-63911310-1', 'hwangjr.github.io');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: '6e8f6d9aa88722365432'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
 </html>
