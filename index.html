
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>HwangJR&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="HwangJR">
    

    
    <meta name="description" content="Some stuff about tech etc..">
<meta property="og:type" content="website">
<meta property="og:title" content="HwangJR's Blog">
<meta property="og:url" content="https://hwangjr.github.io/index.html">
<meta property="og:site_name" content="HwangJR's Blog">
<meta property="og:description" content="Some stuff about tech etc..">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HwangJR's Blog">
<meta name="twitter:description" content="Some stuff about tech etc..">
<meta name="twitter:creator" content="@HuangJR">
<link rel="publisher" href="+JianrongHuang">

    
    <link rel="alternative" href="/atom.xml" title="HwangJR&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HwangJR&#39;s Blog" title="HwangJR&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HwangJR&#39;s Blog">HwangJR&#39;s Blog</a></h1>
				<h2 class="blog-motto">Life is wonderful!</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="ts-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/23/阿里CentOS-6-iptables配置/" title="阿里CentOS 6 iptables配置" itemprop="url">阿里CentOS 6 iptables配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-10-23T10:31:08.000Z" itemprop="datePublished"> 发表于 2015-10-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>就是，配置防火墙，防止被鲁。</p>
<p>iptables的命令格式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables [-t table] <span class="built_in">command</span> [chain] [rules] [-j target]</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>[-t table] ：用来指明使用的表， 有三种选项: filter, nat 和 mangle，如果未指定，则使用filter作为缺省表。 事实上，对于单个服务器的防火墙配置，一般来讲，我们只需要对filter表进行配件就OK了。filter表包括 INPUT, OUTPUT,和FORWARD三个chain.</p>
</li>
<li><p>command 表明iptables命名要做什么，比如</p>
</li>
<li><p>-A （–append): 该命令会把一条规则附件到chain的末尾。</p>
</li>
<li><p>-D（–delete)用来删除某个规则。</p>
</li>
<li><p>-F （–flush) 如果指定了chain, 删除该chain中的所有规则，如果未指定chain, 则删除所有chain中的所有规则。</p>
</li>
<li><p>target: 是由规则指定的操作。 包括下面几种：</p>
</li>
<li><p>ACCEPT: 接收信息包(允许它前往目的地），并且将停止遍历chain.</p>
</li>
<li><p>DROP：  拒绝，</p>
</li>
</ul>
<p>此外还有REJECT, RETURN, LOG, REDIRECT, MARK, MIRROR, MAQUERADE等。</p>
<p>具体的iptables的语法和概念就不再多说了，请参照<a href="http://linux.die.net/man/8/iptables" target="_blank" rel="external">iptables man page</a>官方文档 .</p>
<p>简单来说，iptables防火墙是由一系列的规则(rule)组成，  一个数据请求进来， 会依次和这些规则进行比较，如果正好符合规则的定义，那这个数据请求要么会被接收ACCEPT，要么被拒绝DRIP。如果不符合任何规则的定义，最后缺省的规则会被应用。</p>
<h2 id="配置">配置</h2><p>SSH的端口22自然是需要开放的，否则我们就无法登录服务器了。CentOS的VPS经常作为用LAMP搭建的Web服务器，FTP服务器， Mail服务器等。</p>
<ul>
<li><p>对于Web服务来说，需要开放80端口，如果是HTTPS/SSL协议的话，还需用开放443端口。</p>
</li>
<li><p>对于Mail服务来说，由于涉及SMTP, POP3, IMAP协议，需要开放的端口：SMTP : 25   Secure SMTP:465  POP3: 110   Secure POP3: 995   IMAP: 143   IMAP over SSL: 993。</p>
</li>
<li><p>对于FTP服务来说，需要开放 20, 21两个端口。</p>
</li>
</ul>
<h3 id="屏蔽常见攻击">屏蔽常见攻击</h3><p>缺省情况下，CentOS的iptables的设置是允许任何数据通过的。我们首先要清空iptables中的所有的规则：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></p>
<p>然后我们加上阻止简单扫描和攻击的规则：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP             <span class="comment">#NONE 包(所有标识bit都没有设置)主要是扫描类的数据包</span></span><br><span class="line">iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP     <span class="comment">#防止sync-flood 攻击</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP              <span class="comment">#ALL包（所有的标注bit都被设置了）也是网络扫描的数据包</span></span><br></pre></td></tr></table></figure></p>
<p>关于sync-flood, 请参照<a href="http://en.wikipedia.org/wiki/SYN_flood" target="_blank" rel="external">wikipedia</a>的解释。</p>
<h3 id="相应服务开放端口">相应服务开放端口</h3><p>首先我们应该接受本机localhost的任何请求，否则，数据库连接等将无法工作：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>对于不同的服务需要开放不同的端口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT      <span class="comment"># SSH</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT      <span class="comment"># HTTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">443</span> -j ACCEPT     <span class="comment">#HTTPS</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">25</span> -j ACCEPT   <span class="comment">#SMTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">465</span>  -j ACCEPT <span class="comment">#Secure SMTP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">110</span> -j ACCEPT   <span class="comment">#POP3</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">995</span> -j ACCEPT   <span class="comment">#Secure POP3</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">143</span> -j ACCEPT   <span class="comment">#IMAP</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">993</span> -j ACCEPT   <span class="comment">#Secure IMAP</span></span><br></pre></td></tr></table></figure></p>
<h3 id="通用规则">通用规则</h3><p>首先要允许所有从服务器端发起的连接，由此返回的响应数据应该是允许的！比如VPS发起的yum update , 必须要允许外部的update数据进来：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -m <span class="keyword">state</span>  --state ESTABLISHED, RELATED -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>最后，设置缺省的策略：屏蔽任何进入的数据请求，允许所有从Server发出的请求<br><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br><span class="line">iptables -<span class="keyword">P</span> INPUT DROP</span><br></pre></td></tr></table></figure></p>
<h3 id="保存设置">保存设置</h3><p>首先通过下面的命令查看一下我们的设置是否正确！<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptable -<span class="keyword">L</span> -<span class="keyword">n</span></span><br></pre></td></tr></table></figure></p>
<p>确认没有问题后，执行下面的命令<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables <span class="keyword">save</span></span><br></pre></td></tr></table></figure></p>
<p>执行上述命令后，相应的规则会写入 /etc/sysconfig/iptables这个文件，你可以检查一下看看。</p>
<p>最后执行<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> iptables restart</span><br></pre></td></tr></table></figure></p>
<p>重新启动iptables防火墙，以使上述设置生效。</p>
<h3 id="自动化">自动化</h3><p>为了更方便的修改和维护自己的iptables的设置，我一般是把所有的iptables的设置先写到一个单独文件中，测试没有问题后。然后再保存到iptable的配置文件中。</p>
<p>放大招，sh配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># A simple iptables firewall configuration</span></span><br><span class="line"></span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin; <span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">#flush/erase original rules</span></span><br><span class="line">iptables -F <span class="comment">#清除所有已制定的rule</span></span><br><span class="line">iptables -X <span class="comment">#清除用户自定义的chain/table</span></span><br><span class="line">iptables -Z <span class="comment">#将所有的chain的计数和流量统计归零</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Accept localhost connetting, no matter what it is</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#Accept any response package which is initiated from inside</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#block most common network attacks(recon packets and syn-flood attack)</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span><br><span class="line">iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#open ports for different services</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT <span class="comment">#SSH</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT <span class="comment">#HTTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 443 -j ACCEPT #HTTPS</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 25 -j ACCEPT #SMTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 465 -j ACCEPT #Secure SMTP</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 110 -j ACCEPT #POP3</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp --dport 995 -j ACCEPT #Secure POP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ICMP configuration</span></span><br><span class="line"><span class="comment">#To prevent ICMP DDOS,we do not allow ICMP type 8(echo-request) or limit this request with 1/second</span></span><br><span class="line"><span class="comment">#some ICMP requests are allowed.</span></span><br><span class="line">icmp_<span class="built_in">type</span>=<span class="string">"0 3 4 11 12 14 16 18"</span></span><br><span class="line"><span class="keyword">for</span> ticmp <span class="keyword">in</span> <span class="variable">$icmp_type</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    iptables -A INPUT -p icmp --icmp-type <span class="variable">$ticmp</span> -j ACCEPT</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p icmp --icmp-type 8 -m limit --limit 1/second -j ACCEPT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#default policies</span></span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#save to /etc/sysconfig/iptables</span></span><br><span class="line">/etc/init.d/iptables save</span><br></pre></td></tr></table></figure></p>
<h2 id="常用命令">常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables</span><br><span class="line"><span class="comment"># 检测状态</span></span><br><span class="line">service iptables status</span><br><span class="line">service iptables start</span><br><span class="line"><span class="comment"># 查看当前配置</span></span><br><span class="line">iptables -L -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接受一切请求</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空默认所有规则</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="comment"># 清空自定义所有规则</span></span><br><span class="line">iptables -X</span><br><span class="line"><span class="comment"># 清除计数器</span></span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line">service iptables save</span><br><span class="line">chkconfig iptables on</span><br></pre></td></tr></table></figure>
<h2 id="REF">REF</h2><p><a href="http://www.androiddev.net/centos-6-iptables-firewall/" target="_blank" rel="external">为CentOS 6设置IPTables防火墙 | 码农日记</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/23/阿里CentOS-6-iptables配置/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/23/Gradle查询-排除依赖/" title="Gradle查询/排除依赖" itemprop="url">Gradle查询/排除依赖</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-10-23T10:29:58.000Z" itemprop="datePublished"> 发表于 2015-10-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>使用Gradle编译项目时，可使用此排查依赖包冲突。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看项目库依赖</span></span><br><span class="line">gradle -q dependencies plugin_framework:dependencies —configuration compile</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/23/Gradle查询-排除依赖/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/23/CentOS6-5-配置Subversion/" title="CentOS6.5 配置Subversion" itemprop="url">CentOS6.5 配置Subversion</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-10-23T10:28:24.000Z" itemprop="datePublished"> 发表于 2015-10-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>需要部署Subversion进行版本控制，团队习惯用Subversion，自然Git也有部署，后续慢慢切入。<br>不基于Apache，也就是http无法访问，只通过svn访问。<br>不源码编译，版本兼容会有问题。</p>
<blockquote>
<p>Subversion目录说明：<br><em>dav目录：是提供apache与mod_dav_svn使用的目录，让他们存储内部数据
</em>db目录：就是所有版本控制的数据存放文件<br><em>hooks目录：放置hook脚本文件的目录
</em>locks目录：用来放置subversion锁定数据的目录，追踪存取文件库的客户端<br><em>format文件：是一个文本文件，里面只放了一个整数。表示当前文件库配置的版本号
</em>conf目录：是这个仓库的配置文件（仓库的用户访问账号、权限等）</p>
</blockquote>
<h2 id="安装">安装</h2><p>查询是否已经有安装，并查询安装信息：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询是否安装及版本</span></span><br><span class="line">rpm -qa subversion</span><br><span class="line"><span class="comment"># 移除</span></span><br><span class="line">yum remove subversion</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install subversion</span><br><span class="line"><span class="comment"># 查询安装目录</span></span><br><span class="line">rpm -ql subversion</span><br></pre></td></tr></table></figure></p>
<h2 id="基本配置">基本配置</h2><p>本次配置将针对多个版本库，其访问统一为：<code>svn://ip/project1</code>，可在下面分别创建多个库。</p>
<h3 id="创建svn库并初始化">创建svn库并初始化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建版本库路径</span></span><br><span class="line">mkdir -p /home/svn/repos/project1</span><br><span class="line"><span class="comment"># 新建一个版本仓库</span></span><br><span class="line">svnadmin create /home/svn/repos/project1</span><br><span class="line"><span class="comment"># 初始化版本库中目录</span></span><br><span class="line">mkdir project project/server project/server/branches project/server/tags project/server/trunk project/android project/android/branches project/android/tags project/android/trunk project/ios project/ios/branches project/ios/tags project/ios/trunk</span><br><span class="line">svn import project/ file:///home/svn/repos/project1 -m <span class="string">'init svn folder'</span></span><br><span class="line"><span class="comment"># 可删除临时创建文件，或者保留以后创建其他版本库继续使用</span></span><br><span class="line">rm -rf project</span><br><span class="line"><span class="comment"># 保留以后继续使用</span></span><br><span class="line">mv project /home/svn/projectTemp</span><br></pre></td></tr></table></figure>
<p>其中project目录为：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">project</span>/</span><br><span class="line">├── <span class="keyword">android</span><br><span class="line"></span>│   ├── <span class="keyword">branches</span><br><span class="line"></span>│   ├── tags</span><br><span class="line">│   └── trunk</span><br><span class="line">├── ios</span><br><span class="line">│   ├── <span class="keyword">branches</span><br><span class="line"></span>│   ├── tags</span><br><span class="line">│   └── trunk</span><br><span class="line">└── server</span><br><span class="line">    ├── <span class="keyword">branches</span><br><span class="line"></span>    ├── tags</span><br><span class="line">    └── trunk</span><br></pre></td></tr></table></figure></p>
<p><code>/home/svn/repos</code>目录为：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/home/svn/repos/</span><br><span class="line">└── project1</span><br><span class="line">    ├── <span class="keyword">conf</span></span><br><span class="line">    ├── <span class="keyword">db</span></span><br><span class="line">    ├── <span class="keyword">format</span></span><br><span class="line">    ├── hooks</span><br><span class="line">    ├── locks</span><br><span class="line">    └── README.txt</span><br></pre></td></tr></table></figure></p>
<h3 id="配置svn">配置svn</h3><p>版本库用户统一管理，故这里会直接在<code>/home/svn</code>目录创建<code>conf</code>文件并保存其配置。<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建配置目录</span></span><br><span class="line"><span class="keyword">mkdir</span> /home/svn/conf</span><br></pre></td></tr></table></figure></p>
<h4 id="配置用户">配置用户</h4><p>移动用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /home/svn/repos/project1/conf/passwd /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/passwd</span><br></pre></td></tr></table></figure></p>
<p>修改里面用户，格式<code>username = passwd</code>的条目即可。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[users]</span></span><br><span class="line"><span class="setting">hwangjr = <span class="value">hwangjr</span></span></span><br></pre></td></tr></table></figure></p>
<h4 id="修改访问策略">修改访问策略</h4><p>移动用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /home/svn/repos/project1/conf/authz /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/authz</span><br></pre></td></tr></table></figure></p>
<p>修改里面配置，<code>groups</code>为定义用户群组，其他为配置访问权限，<strong>需要注意是<code>* =</code>表示除了上面配置的用户组之外，任何人都被禁止访问本目录，此必须加上</strong>。<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[groups]</span></span><br><span class="line">dev = hwangjr</span><br><span class="line"></span><br><span class="line"><span class="string">[project1:/]</span></span><br><span class="line">@dev = rw</span><br><span class="line">* =</span><br></pre></td></tr></table></figure></p>
<h4 id="修改svnserve，让配置生效">修改svnserve，让配置生效</h4><p>拷贝用户配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /home/svn/repos/project1/conf/svnserve.conf /home/svn/conf/</span><br></pre></td></tr></table></figure></p>
<p>配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/svn/conf/svnserve.conf</span><br></pre></td></tr></table></figure></p>
<p>修改里面配置。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = <span class="keyword">write</span></span><br><span class="line">password-db = <span class="regexp">/home/</span>svn<span class="regexp">/conf/</span>passwd</span><br><span class="line">authz-db = <span class="regexp">/home/</span>svn<span class="regexp">/conf/</span>authz</span><br></pre></td></tr></table></figure></p>
<h4 id="启动/停止svn">启动/停止svn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svnserve <span class="operator">-d</span> -r /home/svn/repos</span><br><span class="line"><span class="comment"># 指定port</span></span><br><span class="line">svnserve <span class="operator">-d</span> -r /home/svn/repos --listen-port <span class="number">3391</span></span><br><span class="line"><span class="comment"># 停止svn</span></span><br><span class="line">killall svnserve</span><br><span class="line"><span class="comment"># ps</span></span><br><span class="line">ps -ef | grep svnserve</span><br><span class="line"><span class="built_in">kill</span> -<span class="number">9</span> pid</span><br><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -tlnp | grep svn</span><br></pre></td></tr></table></figure>
<h3 id="测试访问">测试访问</h3><p>本地测试即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn co svn://<span class="number">127.0</span>.<span class="number">0.1</span>/project1 --username hwangjr --password hwangjr</span><br></pre></td></tr></table></figure></p>
<h3 id="新增一个版本库">新增一个版本库</h3><p>本次配置可管理多个版本库，且用户共用，新增一个版本库很简单：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/svn/repos/project2</span><br><span class="line">svnadmin create /home/svn/repos/project2</span><br><span class="line">rm -rf /home/svn/repos/project2/conf/passwd /home/svn/repos/project2/conf/authz</span><br><span class="line">cp /home/svn/conf/svnserve.conf /home/svn/repos/project2/conf/</span><br></pre></td></tr></table></figure></p>
<p>此版本库已经新增完毕，如果需要初始化目录，则可采用上面方式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn import /home/svn/projectTemp/  file:///home/svn/repos/project2 -m <span class="string">'init svn folder'</span></span><br></pre></td></tr></table></figure></p>
<p>可编辑<code>/home/svn/conf/passwd</code>来新增/删除用户，可编辑<code>/home/svn/conf/authz</code>来控制权限。举个authz栗子：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[project1:/]</span><br><span class="line"><span class="comment">@dev = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br><span class="line"></span><br><span class="line">[project2:/]</span><br><span class="line"><span class="comment">@dev = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br></pre></td></tr></table></figure></p>
<h3 id="自启动">自启动</h3><p>通过服务来启动即可，编辑<code>vim /etc/init.d/svnserve</code>，修改OPTIONS为<code>-r /home/svn/repos</code>，片段为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### <span class="operator"><span class="keyword">END</span> INIT INFO</span><br><span class="line"></span><br><span class="line">OPTIONS=<span class="string">"-r /home/svn/repos"</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">Source</span> <span class="keyword">function</span> <span class="keyword">library</span>.</span><br><span class="line">. /etc/rc.<span class="keyword">d</span>/init.<span class="keyword">d</span>/functions</span></span><br></pre></td></tr></table></figure></p>
<p>设置服务自启动：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig svnserve on</span><br></pre></td></tr></table></figure></p>
<h3 id="防火墙">防火墙</h3><p>如果对防火墙有疑问，可以参考另一篇iptables，开放所需端口即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -tlnp | grep svn</span><br><span class="line"><span class="comment"># 开放端口</span></span><br><span class="line">iptables -A INPUT -p tcp --dport <span class="number">3690</span> -j ACCEPT <span class="comment"># SVN</span></span><br><span class="line">/etc/init.d/iptables save</span><br></pre></td></tr></table></figure></p>
<p>或者编辑配置文件：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"><span class="constant">A</span> <span class="constant">INPUT</span> -p tcp -m tcp --dport <span class="number">3690</span> -j <span class="constant">ACCEPT</span></span><br><span class="line"></span>service iptables restart</span><br></pre></td></tr></table></figure></p>
<h2 id="常用配置">常用配置</h2><h3 id="强制提交写LOG">强制提交写LOG</h3><p>配置pre-comit文件，要求用户提交前必须写LOG。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/repos/project1/hooks</span><br><span class="line"><span class="keyword">vim</span> <span class="keyword">pre</span>-commit</span><br><span class="line">chmod +<span class="keyword">x</span> <span class="keyword">pre</span>-commit</span><br></pre></td></tr></table></figure></p>
<p>pre-commit文件内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">TXN=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">SVNLOOK=/usr/bin/svnlook</span><br><span class="line">LOGMSG=`<span class="variable">$SVNLOOK</span> <span class="built_in">log</span> -t <span class="string">"<span class="variable">$TXN</span>"</span> <span class="string">"<span class="variable">$REPOS</span>"</span> | grep <span class="string">"[a-zA-Z0-9]"</span> | wc -c`</span><br><span class="line"><span class="comment"># 5(要求的LOG长度，依实际需要修改)</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$LOGMSG</span>"</span> <span class="operator">-lt</span> <span class="number">5</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">"\nEmpty log message not allowed. Commit aborted!"</span> <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<h3 id="可修改LOG">可修改LOG</h3><p>配置pre-revprop-change文件，此文件在show log中修改log时会运行，得到修改的权限，否则会报错：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DAV request failed; it’s possible that the repository’s pre-revprop-<span class="operator"><span class="keyword">change</span> hook either <span class="keyword">failed</span> <span class="keyword">or</span> <span class="keyword">is</span> non-existent. <span class="keyword">At</span> <span class="keyword">least</span> one property <span class="keyword">change</span> <span class="keyword">failed</span>;</span> repository is unchanged</span><br></pre></td></tr></table></figure></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/repos/project1/hooks/</span><br><span class="line"><span class="keyword">vim</span> <span class="keyword">pre</span>-revprop-<span class="keyword">change</span></span><br><span class="line">chmod +<span class="keyword">x</span> <span class="keyword">pre</span>-revprop-<span class="keyword">change</span></span><br></pre></td></tr></table></figure>
<p>文件内容如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">USER=<span class="string">"<span class="variable">$3</span>"</span></span><br><span class="line">PROPNAME=<span class="string">"<span class="variable">$4</span>"</span></span><br><span class="line"><span class="keyword">if</span> [<span class="string">"<span class="variable">$PROPNAME</span>"</span> = <span class="string">"svn:log"</span>];<span class="keyword">then</span> <span class="built_in">exit</span> <span class="number">0</span>;<span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="HTTP服务器（未进行验证_）">HTTP服务器（未进行验证 ）</h2><h3 id="转换密码">转换密码</h3><p>HTTP不支持明文，Perl脚本来进行转化密码，脚本目录下会多一个<code>webpasswd</code>文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/svn/conf/</span><br><span class="line">vim ptopw.pl</span><br><span class="line">chmod +x ptopw.pl</span><br><span class="line">./ptopw.pl</span><br></pre></td></tr></table></figure></p>
<p>脚本内容：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"></span><br><span class="line"><span class="comment">#open the svn passwd file</span></span><br><span class="line"><span class="keyword">open</span> (FILE, <span class="string">"../conf/passwd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the passwd file!!!\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#clear the apache passwd file</span></span><br><span class="line"><span class="keyword">open</span> (OUT_FILE, <span class="string">"&gt;webpasswd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the webpasswd file!!!\n"</span>);</span><br><span class="line"><span class="keyword">close</span> (OUT_FILE);</span><br><span class="line"></span><br><span class="line"><span class="comment">#begin</span></span><br><span class="line"><span class="keyword">foreach</span> (&lt;FILE&gt;) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_</span> =~ <span class="regexp">m/^[^#].*=/</span>) &#123;</span><br><span class="line"><span class="variable">$_</span> =~ <span class="regexp">s/=//</span>;</span><br><span class="line"><span class="string">`htpasswd -b webpasswd $_`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="修改httpd配置">修改httpd配置</h3><p>编辑<code>/etc/httpd/conf/httpd.conf</code>，在末尾添加svn：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Location /repos&gt;</span><br><span class="line">DAV svn</span><br><span class="line">SVNPath /home/svn/repos/</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName <span class="string">"svn for repos"</span></span><br><span class="line">AuthUserFile /home/svn/conf/webpasswd</span><br><span class="line">AuthzSVNAccessFile /home/svn/conf/authz</span><br><span class="line">Satisfy all</span><br><span class="line">Require valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="修改权限">修改权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R apache.apache /home/svn/repos</span><br></pre></td></tr></table></figure>
<h3 id="重启服务">重启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/httpd restart</span><br></pre></td></tr></table></figure>
<h3 id="测试">测试</h3><p>浏览器打开<code>http://ip/repos/server</code>测试。</p>
<h2 id="邮件提醒（未验证）">邮件提醒（未验证）</h2><ul>
<li><p>安装Perl模块Module::Build</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/D/DA/DAGOLDEN/Module-Build-0.36_11.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Module-Build-0.36_11.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Module-Build-0.36_11</span></span><br><span class="line"><span class="preprocessor"># perl Build.PL</span></span><br><span class="line"><span class="preprocessor"># ./Build</span></span><br><span class="line"><span class="preprocessor"># ./Build test</span></span><br><span class="line"><span class="preprocessor"># ./Build install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块Authen::SASL</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/G/GB/GBARR/Authen-SASL-2.15.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Authen-SASL-2.15.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Authen-SASL-2.15</span></span><br><span class="line"><span class="preprocessor"># perl Makefile.PL</span></span><br><span class="line"><span class="preprocessor"># make test</span></span><br><span class="line"><span class="preprocessor"># make install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块Net::SMTP_auth</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/A/AP/APLEINER/Net-SMTP_auth-0.08.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf Net-SMTP_auth-0.08.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd Net-SMTP_auth-0.08</span></span><br><span class="line"><span class="preprocessor"># perl Makefile.PL</span></span><br><span class="line"><span class="preprocessor"># make test</span></span><br><span class="line"><span class="preprocessor"># make install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Perl模块SVN::Notify</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http://search.cpan.org/CPAN/authors/id/D/DW/DWHEELER/SVN-Notify-2.80.tar.gz</span></span><br><span class="line"><span class="preprocessor"># tar xvf SVN-Notify-2.80.tar.gz</span></span><br><span class="line"><span class="preprocessor"># cd SVN-Notify-2.80</span></span><br><span class="line"><span class="preprocessor"># perl Build.PL</span></span><br><span class="line"><span class="preprocessor"># ./Build</span></span><br><span class="line"><span class="preprocessor"># ./Build test</span></span><br><span class="line"><span class="preprocessor"># ./Build install</span></span><br><span class="line"><span class="preprocessor"># cd ..</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动邮件服务器</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service sendmail restart</span></span><br><span class="line"><span class="keyword">Shutting</span> down sendmail:                                   <span class="sqbracket"> [FAILED]</span></span><br><span class="line"><span class="keyword">Starting</span> sendmail:                                        <span class="sqbracket"> [  OK  ]</span></span><br><span class="line"><span class="keyword">Starting</span> sm-client:                                       <span class="sqbracket"> [  OK  ]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置自动发邮件脚本<br>修改post-commit脚本，以支持邮件通知功能。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># cd /home/svn/repos/project1/hooks/</span></span><br><span class="line"><span class="preprocessor"># vim post-commit</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>内容如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line"></span><br><span class="line">/usr/bin/svnnotify –repos-path “<span class="variable">$1</span>″ –revision “<span class="variable">$2</span>″ –to huangjianrong2010@gmail.com –from project1@svn.com –handler “HTML::ColorDiff”  –with-diff –smtp localhost –smtp-user root –smtp-pass passwd -c “UTF-<span class="number">8</span>″ -g zh_CN -o raw –svnlook /usr/bin/svnlook –subject-prefix ‘[SVN Update]‘</span><br></pre></td></tr></table></figure></p>
<p>to参数代表接收邮件的地址，可以有多个。from参数是虚拟的，代表你的发送地址，一般情况下，这个参数 不重要，但如果接收者的邮件服务器有反垃圾邮件的功能，需要判定源地址的话，这个参数是否合法就显得很重要了</p>
<p>再给该脚本添加可执行权限<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># chmod +x post-commit</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>再次提交时，就会给指定邮件地址发信了。ALL DONE！</li>
</ul>
<h2 id="备份管理">备份管理</h2><p>采用简单方式，定时备份仓库目录。</p>
<ul>
<li><p>新建备份目录</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /home/svn/backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写备份脚本</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/scripts</span><br><span class="line"><span class="keyword">vim</span> backup.<span class="keyword">sh</span></span><br><span class="line">chmod +<span class="keyword">x</span> backup.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>backup.sh内容：<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cd /home/svn/repos</span><br><span class="line">now=`/bin/date +%Y%m%d`</span><br><span class="line">/bin/tar czvf <span class="string">"project_backup_$now.tar.gz"</span> project1/ &amp;&amp; rm -rf /home/svn/backup/* &amp;&amp; /bin/mv project_backup_*.tar.gz /home/svn/backup/</span><br><span class="line"><span class="keyword">if</span> [ $? == <span class="number">0</span> ]</span><br><span class="line">then</span><br><span class="line"><span class="literal">result</span>=”<span class="type">OK</span>!!”</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="literal">result</span>=”<span class="type">False</span>!!”</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">#send mail to administrator</span></span><br><span class="line">/bin/mail mail@gmail.com -s “project_backup_$now” &lt;&lt;<span class="type">MESSAGE</span></span><br><span class="line"><span class="type">Result</span>: `/bin/echo $<span class="literal">result</span>`</span><br><span class="line"><span class="type">MESSAGE</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>设置每日执行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab <span class="operator">-e</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输入：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 每晚<span class="number">23</span>点备份</span></span><br><span class="line"><span class="number">0</span> <span class="number">23</span> * * * /home/svn/scripts/backup.sh</span><br></pre></td></tr></table></figure></p>
<h2 id="svnstat分析svn数据（未验证）">svnstat分析svn数据（未验证）</h2><ul>
<li><p>安装JAVA</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x jre-xxx-rpm<span class="class">.bin</span></span><br><span class="line">./jre-xxx-rpm.bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载svnstat</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">http:</span>/<span class="regexp">/iweb.dl.sourceforge.net/project</span><span class="regexp">/svnstat/svnstat</span><span class="regexp">/Release-1.1-beta/</span><span class="constant">SvnStat</span>-<span class="number">1.1</span>-beta.zip</span><br><span class="line">unzip <span class="constant">SvnStat</span>-<span class="number">1.1</span>-beta.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新代码</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn co <span class="string">svn:</span><span class="comment">//ip/project1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成数据</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pwd</span></span><br><span class="line"># /root</span><br><span class="line">svn <span class="keyword">log</span> project1 -v -xml -non-interactive &gt; project1.<span class="literal">log</span></span><br><span class="line"><span class="keyword">cd</span> SvnStat-1.1-beta</span><br><span class="line">java -classpath SvnStat-all.jar <span class="keyword">de</span>.agentlab.svnstat.SvnStat -jar SvnStat-all.jar -r /root/project.<span class="keyword">log</span> -<span class="keyword">d</span> /<span class="keyword">var</span>/www/html/</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<br>打开浏览器即可查看</p>
</li>
</ul>
<h2 id="statsvn分析svn数据（未验证）">statsvn分析svn数据（未验证）</h2><ul>
<li><p>下载statsvn</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//downloads.sourceforge.net/project/statsvn/statsvn/0.7.0/statsvn-0.7.0.zip?use_mirror=jaist</span></span><br><span class="line">unzip statsvn-<span class="number">0.7</span><span class="number">.0</span>.zip</span><br><span class="line">cd statsvn-<span class="number">0.7</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成statsvn数据</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="regexp">/var/</span>www<span class="regexp">/html/</span>statsvn</span><br><span class="line">java -jar statsvn.jar -verbose -output-dir <span class="regexp">/var/</span>www<span class="regexp">/html/</span>statsvn<span class="regexp">/ /</span>root<span class="regexp">/project.log /</span>root<span class="regexp">/project</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<br>打开浏览器查看</p>
</li>
</ul>
<h2 id="配置codestriker（未验证）">配置codestriker（未验证）</h2><ul>
<li><p>依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MCPAN <span class="operator">-e</span> <span class="string">'install "Template"'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>下载</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># wget http:<span class="comment">//downloads.sourceforge.net/project/codestriker/codestriker/1.9.10/codestriker-1.9.10.tar.gz?use_mirror=jaist&amp;ts=1279246587</span></span></span><br><span class="line"><span class="preprocessor"># mkdir /var/www/codestriker</span></span><br><span class="line"><span class="preprocessor"># cd /var/www/codestriker</span></span><br><span class="line"><span class="preprocessor"># tar xvf /path/codestriker-<span class="number">1.9</span><span class="number">.10</span>.tar.gz</span></span><br><span class="line"><span class="preprocessor"># chown -R apache.apache codestriker-<span class="number">1.9</span><span class="number">.10</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据库</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># service mysqld restart</span></span><br><span class="line"><span class="preprocessor"># mysql -uroot mysql</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>执行:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> codestrikerdb <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span></span><br><span class="line"><span class="operator"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">INSERT</span>,<span class="keyword">UPDATE</span>,<span class="keyword">DELETE</span>,<span class="keyword">INDEX</span>,<span class="keyword">ALTER</span>,<span class="keyword">CREATE</span>,<span class="keyword">DROP</span>,<span class="keyword">REFERENCES</span> <span class="keyword">ON</span> codestrikerdb.* <span class="keyword">TO</span> codestriker@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> ‘cspasswd’;</span></span><br><span class="line"><span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span></span><br><span class="line">quit</span><br></pre></td></tr></table></figure></p>
<ul>
<li>配置codestriker<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># cd codestriker-<span class="number">1.9</span><span class="number">.10</span>/</span></span><br><span class="line"><span class="preprocessor"># vim codestriker.conf</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意以下几点(详细可查看codestriker的安装文档)<br>a.数据库的用户名密码要配对<br>b.svn的数据仓库要配对，如下：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@valid</span>_repositories =</span><br><span class="line">(</span><br><span class="line"><span class="symbol">'svn</span>:file:<span class="comment">///home/svn/repos/project1',</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>执行安装脚本</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> bin/</span><br><span class="line">./install.<span class="keyword">pl</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置http支持</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">vim</span> /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在最后面加上如下内容:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Alias <span class="regexp">/codestriker/</span>  <span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/cgi-bin/</span></span><br><span class="line">Alias <span class="regexp">/codestrikerhtml/</span>  <span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/html/</span></span><br><span class="line"></span><br><span class="line">&lt;Directory “<span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/cgi-bin/</span>”&gt;</span><br><span class="line">SetHandler perl-script</span><br><span class="line">PerlHandler <span class="string">ModPerl:</span>:Registry</span><br><span class="line">Options +ExecCGI</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory “<span class="regexp">/var/</span>www<span class="regexp">/codestriker/</span>codestriker-<span class="number">1.9</span><span class="number">.10</span><span class="regexp">/html/</span>”&gt;</span><br><span class="line">AllowOverride None</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>查看<br>重启httpd服务：<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> httpd restart</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>浏览器输入<code>http://ip/codestriker/codestriker.pl</code>。</p>
<h2 id="REFS">REFS</h2><p><a href="http://www.ha97.com/4467.html" target="_blank" rel="external">CentOS Linux搭建SVN Server配置详解</a><br><a href="http://www.hi-docs.com/article/detail-MTA4.html" target="_blank" rel="external">Centos 6.5+ 搭建SVN服务器（实用简写版）-LINUX技术文章,经验分享,HI-DOCS</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/23/CentOS6-5-配置Subversion/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/09/Supervisor-Basic-Usage/" title="Supervisor Basic Usage" itemprop="url">Supervisor Basic Usage</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-10-09T06:38:05.000Z" itemprop="datePublished"> 发表于 2015-10-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="http://supervisord.org/" target="_blank" rel="external">Supervisor</a> is a process control system, it is a client/server system that allows its users to monitor and control a number of processes on UNIX-like operating systems.</p>
<p>It shares some of the same goals of programs like <a href="http://supervisord.org/glossary.html#term-launchd" target="_blank" rel="external">launchd</a>, <a href="http://supervisord.org/glossary.html#term-daemontools" target="_blank" rel="external">daemontools</a>, and <a href="http://supervisord.org/glossary.html#term-runit" target="_blank" rel="external">runit</a>. Unlike some of these programs, it is not meant to be run as a substitute for init as “process id 1”. Instead it is meant to be used to control processes related to a project or a customer, and is meant to start like any other program at boot time.</p>
<h2 id="Install">Install</h2><p>Sample for centos:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Maybe u need to install python-setuptools or pip</span></span><br><span class="line"><span class="comment">## yum install python-setuptools &amp;&amp; easy_install pip</span></span><br><span class="line">easy_install supervisor</span><br><span class="line"><span class="comment">## or </span></span><br><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure></p>
<h2 id="Commands">Commands</h2><p>This is some common commands:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for all service</span></span><br><span class="line">supervisorctl start all</span><br><span class="line">supervisorctl stop all</span><br><span class="line">supervisorctl restart all</span><br><span class="line"></span><br><span class="line"><span class="comment"># for service 'ss'</span></span><br><span class="line">supervisorctl stop ss</span><br><span class="line">supervisorctl start ss</span><br><span class="line">supervisorctl restart ss</span><br></pre></td></tr></table></figure></p>
<h2 id="Usage">Usage</h2><p><strong>STEP 1: Init the config file </strong></p>
<p>First of all, we need a config file, supervisor provider us a sample:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## This will create a supervisord.conf file under /etc folder</span></span><br><span class="line"><span class="built_in">echo</span>_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p>
<p><strong>STEP 2: Setup config </strong></p>
<p>Second, we need to config the file, add the code below to the end of conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if this config is not correct, it may occur supervisor start fail</span></span><br><span class="line">[program:ss]</span><br><span class="line"><span class="built_in">command</span> = ssserver -c /etc/ss.json</span><br><span class="line">user = root</span><br><span class="line">autostart = <span class="literal">true</span></span><br><span class="line">autorestart = <span class="literal">true</span></span><br><span class="line">stderr_logfile = /var/<span class="built_in">log</span>/supervisor/ss.stderr.log</span><br><span class="line">stdout_logfile = /var/<span class="built_in">log</span>/supervisor/ss.stdout.log</span><br></pre></td></tr></table></figure></p>
<p>More info see : <a href="http://supervisord.org/configuration.html#programx-section" target="_blank" rel="external">Configuration File — Supervisor 3.1.3 documentation</a></p>
<p><strong>STEP 3: Run Supervisor</strong></p>
<p>Finally, run the supervisor:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># run supervisor with conf file</span></span><br><span class="line">supervisord -c /etc/supervisord.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># run without conf file, will search for the default conf file by:</span></span><br><span class="line"><span class="comment"># $CWD/supervisord.conf</span></span><br><span class="line"><span class="comment"># $CWD/etc/supervisord.conf</span></span><br><span class="line"><span class="comment"># /etc/supervisord.conf</span></span><br><span class="line">supervisord</span><br></pre></td></tr></table></figure></p>
<p>If we modify the conf file, we also can update the conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl update</span><br></pre></td></tr></table></figure></p>
<h2 id="Run_on_startup">Run on startup</h2><p>If you are using a distribution-packaged version of Supervisor, it should already be integrated into the service management infrastructure of your distribution.</p>
<p>There are user-contributed scripts for various operating systems at: <a href="https://github.com/Supervisor/initscripts" target="_blank" rel="external">Supervisor/initscripts</a></p>
<p>OR :<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># add this before exit</span></span><br><span class="line">supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p>
<h2 id="Manage_on_web">Manage on web</h2><p>U can manage the service remote, just modify the conf file:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9001</span>        ; (ip_address:port specifier, *:port <span class="keyword">for</span> all iface)</span><br><span class="line">username=user              ; (default is no username (open server))</span><br><span class="line">password=<span class="number">123</span>               ; (default is no password (open server))</span><br></pre></td></tr></table></figure></p>
<p>and reload conf:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl reload</span><br></pre></td></tr></table></figure></p>
<h2 id="END">END</h2><p>Just so easy, Supervisor is very fantastic, enjoy it.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/09/Supervisor-Basic-Usage/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/21/将SOCKET代理转化为HTTP代理/" title="将SOCKET代理转化为HTTP代理" itemprop="url">将SOCKET代理转化为HTTP代理</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-21T07:39:01.000Z" itemprop="datePublished"> 发表于 2015-08-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>众所周知，中国伟大的墙阻碍了很多前进的脚步，特别是ANDROID SDK的更新（node啥的都不说了）。特别是最近管控比较严，就只能使用朋友的SOCKET5的服务器代理，而ANDROID SDK是无法使用SOCKET5代理，只支持HTTP代理，类似<a href="http://www.androiddevtools.cn/" target="_blank" rel="external">AndroidDevTools</a>的站点也不是很好使了，只能寻找SOCKET5转换成HTTP的方式。</p>
<h2 id="SOCKET转HTTP">SOCKET转HTTP</h2><h3 id="DeleGate介绍">DeleGate介绍</h3><p>这里要使用到<a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>软件，支持各个平台。<br><a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>是一个多平台的简单代理服务器软件，通过本地建立各种代理服务器，包括HTTP，FTP，SOCKET等。</p>
<blockquote>
<p>This is a private and voluntary site that is independent of AIST, for providing support information and redistribution of DeleGate, a general purpose proxy server software developed in AIST and, more specifically, for providing voluntary-based support for users in forums, supplementary contents for guide, some experimental services and demonstrations, as well as contents mirroring some of those in the official site of DeleGate of AIST. </p>
</blockquote>
<h3 id="安装软件">安装软件</h3><p>新版没有找到源码，但是<a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a>提供了编译之后的可执行程序。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://delegate.hpcc.jp/pub/DeleGate/bin/linux/<span class="number">9.9</span>.<span class="number">13</span>/linux2.<span class="number">6</span>-dg9_9_13.tar.gz</span><br><span class="line">tar xzf linux2.<span class="number">6</span>-dg9_9_13.tar.gz</span><br><span class="line"><span class="built_in">cd</span> dg9_9_13</span><br><span class="line">tree .</span><br></pre></td></tr></table></figure></p>
<p>在bin目录下就是可执行程序和配置文件，整个文件目录很简洁，在subin里面也提供了setup-subin.sh脚本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bin</span><br><span class="line">│   ├── dg9_9_13</span><br><span class="line">│   ├── dg9_9_13.conf</span><br><span class="line">subin</span><br><span class="line">│   ├── dgbind</span><br><span class="line">│   ├── dgchroot</span><br><span class="line">│   ├── dgcpnod</span><br><span class="line">│   ├── dgdate</span><br><span class="line">│   ├── dgforkpty</span><br><span class="line">│   ├── dgpam</span><br><span class="line">│   └── setup-subin.sh</span><br></pre></td></tr></table></figure></p>
<p>setup-subin.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line">SUBINS=<span class="string">"dgpam dgbind dgchroot dgcpnod"</span></span><br><span class="line">sudo sh -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">  su root -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">  su root -c <span class="string">"chown root <span class="variable">$SUBINS</span>; chmod 6550 <span class="variable">$SUBINS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">ls <span class="operator">-l</span> <span class="variable">$SUBINS</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用">使用</h3><p>使用方式也很简单，通过编辑bin目录下的conf文件来完成，这里以SOCKET转HTTP为例，具体需求自己查看配置文件。<br>编辑dg9_9_13.conf，新增：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mail-address of the administrator of this DeleGat</span></span><br><span class="line">ADMIN=email@email.com</span><br><span class="line"><span class="comment"># the protocol DeleGate speaks with its clients</span></span><br><span class="line">SERVER=http</span><br><span class="line"><span class="comment"># the entrance port on which DeleGate waits clients</span></span><br><span class="line">-P8080</span><br><span class="line"><span class="comment"># forwarding to a SOCKS server</span></span><br><span class="line">SOCKS=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure></p>
<p>配置完成后，直接执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./dg9_9_13</span><br><span class="line"><span class="comment"># 如果没有权限，给权限即可</span></span><br><span class="line">sudo chmod +x dg9_9_13</span><br></pre></td></tr></table></figure></p>
<p>查看是否在运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep dg9</span><br><span class="line">hwangjr   <span class="number">4595</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">53340</span>  <span class="number">3436</span> ?        Ss   <span class="number">11</span>:<span class="number">10</span>   <span class="number">0</span>:<span class="number">00</span> ./dg9_9_13 -&#123;<span class="number">000</span>&#125;[RPM=<span class="number">0.00</span>(<span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>),IDLE=<span class="number">15</span>s]-P8080 -- --------------------</span><br><span class="line">hwangjr   <span class="number">4601</span>  <span class="number">0.0</span>  <span class="number">0.0</span>  <span class="number">15952</span>   <span class="number">940</span> pts/<span class="number">14</span>   S+   <span class="number">11</span>:<span class="number">10</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto dg9</span><br></pre></td></tr></table></figure></p>
<p>停止运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./dg9_9_13 -P8080 -F<span class="built_in">kill</span></span><br><span class="line"><span class="comment"># 暴力</span></span><br><span class="line"><span class="built_in">kill</span> -<span class="number">9</span> <span class="number">4595</span></span><br></pre></td></tr></table></figure></p>
<h3 id="配置ANDROID_SDK">配置ANDROID SDK</h3><p>回到我们的场景，配置ANDROID SDK，基本按照我们的思路，直接配置本地的路由和端口即可。<br>打开ANDROID SDK，Tools -&gt; Options，配置HTTP PROXY SERVER为：127.0.0.1，端口为8080，然后即可畅游谷歌网络。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">12</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52791</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">15</span> INFO     connecting dl-ssl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52796</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">17</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52799</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52809</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">18</span>:<span class="number">57</span> INFO     connecting dl.google.com:<span class="number">80</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52821</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">02</span> INFO     connecting ssl.google-analytics.com:<span class="number">443</span> from <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">52962</span></span><br></pre></td></tr></table></figure></p>
<h3 id="ShadowSocks">ShadowSocks</h3><p>顺带简单介绍下<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">shadowsocks/shadowsocks</a>，其功能在官网已经介绍：</p>
<blockquote>
<p>A fast tunnel proxy that helps you bypass firewalls.<br>Features:<br>TCP &amp; UDP support<br>User management API<br>TCP Fast Open<br>Workers and graceful restart<br>Destination IP blacklist</p>
</blockquote>
<p>安装（ubuntu）：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">usage: sslocal [OPTION]...</span><br><span class="line">A fast tunnel proxy that helps you bypass firewalls.</span><br><span class="line"></span><br><span class="line">You can supply configurations via either config file or <span class="built_in">command</span> line arguments.</span><br><span class="line"></span><br><span class="line">Proxy options:</span><br><span class="line">  -c CONFIG              path to config file</span><br><span class="line">  <span class="operator">-s</span> SERVER_ADDR         server address</span><br><span class="line">  -p SERVER_PORT         server port, default: <span class="number">8388</span></span><br><span class="line">  -b LOCAL_ADDR          <span class="built_in">local</span> binding address, default: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">  <span class="operator">-l</span> LOCAL_PORT          <span class="built_in">local</span> port, default: <span class="number">1080</span></span><br><span class="line">  -k PASSWORD            password</span><br><span class="line">  -m METHOD              encryption method, default: aes-<span class="number">256</span>-cfb</span><br><span class="line">  -t TIMEOUT             timeout <span class="keyword">in</span> seconds, default: <span class="number">300</span></span><br><span class="line">  --fast-open            use TCP_FASTOPEN, requires Linux <span class="number">3.7</span>+</span><br><span class="line"></span><br><span class="line">General options:</span><br><span class="line">  -h, --help             show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">  <span class="operator">-d</span> start/stop/restart  daemon mode</span><br><span class="line">  --pid-file PID_FILE    pid file <span class="keyword">for</span> daemon mode</span><br><span class="line">  --log-file LOG_FILE    <span class="built_in">log</span> file <span class="keyword">for</span> daemon mode</span><br><span class="line">  --user USER            username to run as</span><br><span class="line">  -v, -vv                verbose mode</span><br><span class="line">  -q, -qq                quiet mode, only show warnings/errors</span><br><span class="line">  --version              show version information</span><br><span class="line"></span><br><span class="line">Online <span class="built_in">help</span>: &lt;https://github.com/shadowsocks/shadowsocks&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">sudo sslocal <span class="operator">-s</span> SERVER_ADDR -p SERVER_PORT -b LOCAL_ADDR <span class="operator">-l</span> LOCAL_PORT -k PASSWORD -m METHOD</span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG</span></span><br><span class="line">sudo less /var/<span class="built_in">log</span>/shadowsocks.log</span><br></pre></td></tr></table></figure>
<p>更多详细可以参考文档<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">shadowsocks/shadowsocks</a>。</p>
<h2 id="总结">总结</h2><p>伟大的墙。</p>
<h2 id="REF">REF</h2><p><a href="http://delegate.org/delegate/" target="_blank" rel="external">DeleGate Support Site</a><br><a href="http://www.delegate.org/documents/" target="_blank" rel="external">Documents on DeleGate</a><br><a href="ftp://ftp.delegate.org/pub/DeleGate/" target="_blank" rel="external">FTP on DeleGate</a><br><a href="http://www.delegate.org/delegate/build.shtml" target="_blank" rel="external">Building DeleGate</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/21/将SOCKET代理转化为HTTP代理/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/18/GitHub-GitBook-Markdown来写一本自己的书/" title="GitHub + GitBook + Markdown来写一本自己的书" itemprop="url">GitHub + GitBook + Markdown来写一本自己的书</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-18T09:32:23.000Z" itemprop="datePublished"> 发表于 2015-08-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>近期想要自己沉淀，而且也有意学习下如何贡献自己的知识，给更多人分享我的所得，所以就萌生自己写一个系列的入门书。<br>本次主要通过GitHub上面来进行源码托管，通过GitBook来进行排版及线上阅读下载等，利用Markdown语法来进行撰写。所以最好有一些GitHub及Markdown使用经验最嘉。</p>
<h2 id="作案工具准备">作案工具准备</h2><p>很简单：</p>
<ol>
<li>GitHub帐号</li>
<li>GitBook帐号（可利用GitHub帐号登录，也可申请）</li>
</ol>
<h3 id="GitHub配置">GitHub配置</h3><p>新建一个repo，比如<a href="https://github.com/hwangjr/simple-android" target="_blank" rel="external">hwangjr/simple-android</a>，ignore可以选择git book，READ ME等自己可以配置。</p>
<h3 id="GitBook配置">GitBook配置</h3><p>新建一本书籍<a href="https://www.gitbook.com/book/hwangjr/simple-android/welcome" target="_blank" rel="external">简易Android</a>。</p>
<h4 id="将代码托管到GitHub上">将代码托管到GitHub上</h4><p>点击Settings，选择右侧GitHub，会让你先与你的GitHub帐号进行关联（如果还未进行关联的话），然后设置成你在GitHub上新建的项目即可，即hwangjr/simple-android。</p>
<h4 id="绑定自定义域名">绑定自定义域名</h4><p>你可以绑定自己的自定义域名来进行解析到你的书籍。<br>1.在GitBook上设置你的域名。<br>点击右侧的Domains设置，即/settings/domains，然后输入你的HomePage及content的domain，这边设置为：<br>For homepage: simple-android.hwangjr.com<br>For content: content.simple-android.hwangjr.com</p>
<p>2.在域名解析商那边进行解析配置。<br>这里主要以万网解析进行配置，其他配置可参考，大同小异。<br>新增两条解析规则：<br>CNAME   simple-android   默认   www.gitbook.com<br>CNAME   content.simple-android   默认   www.gitbook.com<br>这里需要注意，记录值需要设置为www.gitbook.com，不能设置为gitbook.com等其他。<br>绑定完可以测试下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nslookup simple-android.hwangjr.com</span><br><span class="line">Server:		<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line">Address:	<span class="number">192.168</span>.<span class="number">1.1</span><span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">simple-android.hwangjr.com	canonical name = www.gitbook.com.</span><br><span class="line">www.gitbook.com	canonical name = saga-<span class="number">4658</span>.herokussl.com.</span><br><span class="line">saga-<span class="number">4658</span>.herokussl.com	canonical name = elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com.</span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.83</span>.<span class="number">21.67</span></span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.243</span>.<span class="number">203.15</span></span><br><span class="line">Name:	elb049689-<span class="number">1604000308</span>.us-east-<span class="number">1</span>.elb.amazonaws.com</span><br><span class="line">Address: <span class="number">54.197</span>.<span class="number">223.43</span></span><br></pre></td></tr></table></figure></p>
<p>具体也可参考：<a href="http://help.gitbook.com/platform/domains.html" target="_blank" rel="external">Custom Domains</a></p>
<h4 id="GitBook软件安装">GitBook软件安装</h4><p>首先需要Node.js环境，才能安装GitBook软件。简单说明下软件安装。<br>安装Node.js最好用<a href="https://github.com/creationix/nvm" target="_blank" rel="external">creationix/nvm</a>来进行版本管理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.github.com/creationix/nvm/master/install.sh | sh</span><br><span class="line">nvm install <span class="number">0.12</span></span><br><span class="line">nvm use <span class="number">0.12</span></span><br><span class="line">npm install gitbook -g</span><br></pre></td></tr></table></figure></p>
<p>NPM较慢可以参考：<a href="https://npm.taobao.org/" target="_blank" rel="external">淘宝 NPM 镜像</a><br>之后即可用git book在本地进行书籍调试。</p>
<h3 id="Markdown配置">Markdown配置</h3><p>Markdown目前一般用stackedit.io进行编写，之后进行同步~也有很多其他的软件，类似MarkdownPad等，都可以进行本地编写，VIM也有相应的Markdown插件。</p>
<h3 id="总结">总结</h3><p>这里还可以设置书籍主题(/theme)等操作，这里就不详细说明了。<br>接下来就可以用Markdown进行书籍编写了~</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Books/">Books</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Books/">Books</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/18/GitHub-GitBook-Markdown来写一本自己的书/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/12/V8和项目SO库冲突/" title="V8和项目SO库冲突" itemprop="url">V8和项目SO库冲突</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-12T07:19:46.000Z" itemprop="datePublished"> 发表于 2015-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>在<a href="http://blog.hwangjr.com/2015/07/10/Android-%E5%AE%9E%E7%8E%B0%E6%AF%9B%E7%8E%BB%E7%92%83%E6%95%88%E6%9E%9C/" target="_blank" rel="external">毛玻璃效果</a>中，项目加入了毛玻璃，相应的会引入V8库。V8库有加入对底层的支持，包括so库等。<br>由于项目中也有加入百度推送，包括so库，在加入V8之后，启动应用会收到一个error，加载推送的so库错误。</p>
<h2 id="初步诊断，so库加入方式冲突">初步诊断，so库加入方式冲突</h2><h3 id="加入V8方式">加入V8方式</h3><p>如果是android studio的话：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    renderscriptTargetApi <span class="number">22</span></span><br><span class="line">    renderscriptSupportModeEnabled <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="集成SO库方式">集成SO库方式</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    <span class="keyword">sourceSets</span> &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="结论">结论</h3><p>是render script的加入方式和jniLibs.srcDirs冲突，很可能被重写了，导致没有加入。</p>
<h2 id="解决方法">解决方法</h2><p>知道是什么原因引起的，那就很好解决了。</p>
<h3 id="修改V8引入方式">修改V8引入方式</h3><p>既然是引入V8导致的问题，那么相应的，我们可以显示的引入V8包。V8在SDK中的位置（不同版本的V8在相应的build tools的版本下）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/android-sdk-linux/build-tools/<span class="number">22.0</span>.1</span><br></pre></td></tr></table></figure></p>
<p>我们拷贝lib下面的jar包和packaged下面的so库，显示导入V8包，即可解决问题。</p>
<h3 id="第三方插件">第三方插件</h3><p>有需求就有市场，强大的GITHUB上面有了GRADLE NATIVE插件<a href="https://github.com/nhachicha/android-native-dependencies" target="_blank" rel="external">android-native-dependencies</a>，专门解决so库的集成问题，包括Maven等仓库的so库拉取等。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">  <span class="keyword">repositories</span> &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.0.0'</span></span><br><span class="line">    <span class="keyword">classpath</span> <span class="string">'com.nabilhachicha:android-native-dependencies:0.1.2'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'android'</span></span><br><span class="line">apply plugin: <span class="string">'android-native-dependencies'</span></span><br><span class="line"></span><br><span class="line">native_dependencies &#123;</span><br><span class="line">    artifact <span class="string">'com.snappydb:snappydb-native:0.2.+:armeabi'</span></span><br><span class="line">    artifact <span class="string">'com.snappydb:snappydb-native:0.2.+:x86'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">//regular Jar dependencies ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Gradle任务方式">Gradle任务方式</h3><p>其实so库就是将so库copy到特定的目录下面，来进行打包即可，那么我们直接写copy的task执行也是可以的。但是有个问题就是随着gradle的升级，很多方法可能会丢弃，那么我们就得随着gradle升级不断升级。<br><a href="https://gist.github.com/khernyo/4226923" target="_blank" rel="external">参考代码</a>：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This hack works with com.android.tools.build:gradle:1.0.0, won't work in later version without modification</span></span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'android'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">targetCompatibility</span> = <span class="number">1.6</span></span><br><span class="line"><span class="keyword">sourceCompatibility</span> = <span class="number">1.6</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">	target = <span class="string">'android-14'</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">sourceSets</span> &#123;</span><br><span class="line">		main &#123;</span><br><span class="line">			manifest.srcFile <span class="string">'AndroidManifest.xml'</span></span><br><span class="line">			java.srcDir <span class="string">'src'</span></span><br><span class="line">			res.srcDir <span class="string">'res'</span></span><br><span class="line">			assets.srcDir <span class="string">'assets'</span></span><br><span class="line">			resources.srcDir <span class="string">'src'</span></span><br><span class="line">		&#125;</span><br><span class="line">		test &#123;</span><br><span class="line">			java.srcDir <span class="string">'tests/src'</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':main'</span>)</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'../main/libs'</span>, <span class="keyword">include</span>: <span class="string">'*.jar'</span>)</span><br><span class="line">	<span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'../thirdparty/actionbar-sherlock/library/libs'</span>, <span class="keyword">include</span>: <span class="string">'*.jar'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> copyNativeLibs(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">	<span class="keyword">from</span>(<span class="keyword">new</span> <span class="keyword">File</span>(<span class="keyword">project</span>(<span class="string">':main'</span>).buildDir, <span class="string">'native-libs'</span>)) &#123; <span class="keyword">include</span> <span class="string">'**/*.so'</span> &#125;</span><br><span class="line">	<span class="keyword">into</span> <span class="keyword">new</span> <span class="keyword">File</span>(buildDir, <span class="string">'native-libs'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123; javaCompileTask -&gt; javaCompileTask.dependsOn copyNativeLibs &#125;</span><br><span class="line"></span><br><span class="line">clean.dependsOn <span class="string">'cleanCopyNativeLibs'</span></span><br><span class="line"></span><br><span class="line">tasks.withType(com.android.build.gradle.PackageApplicationTask) &#123; pkgTask -&gt;</span><br><span class="line">	pkgTask.jniDir <span class="keyword">new</span> <span class="keyword">File</span>(buildDir, <span class="string">'native-libs'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Ref">Ref</h2><p><a href="https://github.com/nhachicha/android-native-dependencies" target="_blank" rel="external">android-native-dependencies</a><br><a href="https://nhachicha.wordpress.com/2014/05/27/android-gradle-add-native-so-dependencies/" target="_blank" rel="external">Android Gradle, add native .so dependencies</a><br><a href="http://tools.android.com/tech-docs/new-build-system" target="_blank" rel="external">New Build System - Android Tools Project Site</a><br><a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental" target="_blank" rel="external">Experimental Plugin User Guide</a><br><a href="https://github.com/googlesamples/android-ndk" target="_blank" rel="external">googlesamples/android-ndk</a><br><a href="http://zhengxiaopeng.com/2014/12/13/Android-Studio-jar%E3%80%81so%E3%80%81library%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96/" target="_blank" rel="external">Android Studio Jar、so、library项目依赖</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/12/V8和项目SO库冲突/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/12/AndroidStudio-快捷键/" title="AndroidStudio 快捷键" itemprop="url">AndroidStudio 快捷键</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-12T07:18:55.000Z" itemprop="datePublished"> 发表于 2015-08-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="IDE">IDE</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F1</td>
<td>帮助</td>
</tr>
<tr>
<td>Alt+F1</td>
<td>查找文件所在目录位置</td>
</tr>
<tr>
<td>Alt+1</td>
<td>快速打开或隐藏工程面板</td>
</tr>
<tr>
<td>Ctrl+Alt+S</td>
<td>打开设置对话框</td>
</tr>
<tr>
<td>Alt+Home</td>
<td>跳转到导航栏</td>
</tr>
<tr>
<td>Esc</td>
<td>光标返回编辑框</td>
</tr>
<tr>
<td>Shift+Esc</td>
<td>光标返回编辑框,关闭无用的窗口</td>
</tr>
<tr>
<td>Shift+Click</td>
<td>关闭标签页</td>
</tr>
<tr>
<td>F12</td>
<td>把焦点从编辑器移到最近使用的工具窗口</td>
</tr>
<tr>
<td>Ctrl+Alt+Y</td>
<td>同步</td>
</tr>
<tr>
<td>Ctrl+Alt+S</td>
<td>打开设置对话框</td>
</tr>
<tr>
<td>Alt+Shift+Inert</td>
<td>开启/关闭列选择模式</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+S</td>
<td>打开当前项目/模块属性</td>
</tr>
<tr>
<td>Alt+Shift+C</td>
<td>查看文件的变更历史</td>
</tr>
<tr>
<td>Ctrl+Shift+F10</td>
<td>运行</td>
</tr>
<tr>
<td>Ctrl+Shift+F9</td>
<td>debug运行</td>
</tr>
<tr>
<td>Ctrl+Alt+F12</td>
<td>资源管理器打开文件夹</td>
</tr>
</tbody>
</table>
<h2 id="编辑">编辑</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alt+J</td>
<td>多行编辑</td>
</tr>
<tr>
<td>Alt+MouseDrag</td>
<td>鼠标选中区域</td>
</tr>
<tr>
<td>Ctrl+C</td>
<td>复制当前行或选中的内容</td>
</tr>
<tr>
<td>Ctrl+D</td>
<td>粘贴当前行或选中的内容到下一行</td>
</tr>
<tr>
<td>Ctrl+X</td>
<td>剪切当前行或选中的内容</td>
</tr>
<tr>
<td>Ctrl+Y</td>
<td>删除行</td>
</tr>
<tr>
<td>Ctrl+Z</td>
<td>倒退</td>
</tr>
<tr>
<td>Ctrl+Shift+Z</td>
<td>向前</td>
</tr>
<tr>
<td>Alt+Enter</td>
<td>自动修正</td>
</tr>
<tr>
<td>Ctrl+Alt+L</td>
<td>格式化代码</td>
</tr>
<tr>
<td>Ctrl+Alt+I</td>
<td>将选中的代码进行自动缩进编排</td>
</tr>
<tr>
<td>Ctrl+Alt+O</td>
<td>优化导入的类和包</td>
</tr>
<tr>
<td>Ctrl+Alt+D</td>
<td>对选中内容添加包围代码</td>
</tr>
<tr>
<td>Ctrl+Alt+J</td>
<td>用动态模板环绕</td>
</tr>
<tr>
<td>Alt+Insert</td>
<td>得到一些Intention Action，可以生成构造器、Getter、Setter、将 == 改为 equals() 等</td>
</tr>
<tr>
<td>Ctrl+Shift+V</td>
<td>选最近使用的剪贴板内容并插入</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+V</td>
<td>简单粘贴</td>
</tr>
<tr>
<td>Ctrl+Shift+Insert</td>
<td>选最近使用的剪贴板内容并插入（同Ctrl+Shift+V）</td>
</tr>
<tr>
<td>Ctrl+Enter</td>
<td>在当前行的上面插入新行，并移动光标到新行（此功能光标在行首时有效）</td>
</tr>
<tr>
<td>Shift+Enter</td>
<td>在当前行的下面插入新行，并移动光标到新行</td>
</tr>
<tr>
<td>Ctrl+J</td>
<td>自动代码</td>
</tr>
<tr>
<td>Ctrl+Alt+T</td>
<td>把选中的代码放在 try{} 、if{} 、 else{} 里</td>
</tr>
<tr>
<td>Shift+Alt+Insert</td>
<td>竖编辑模式</td>
</tr>
<tr>
<td>Ctrl+ /</td>
<td>注释 //</td>
</tr>
<tr>
<td>Ctrl+Shift+ /</td>
<td>注释 /<em>…</em>/</td>
</tr>
<tr>
<td>Ctrl+Shift+J</td>
<td>合并成一行</td>
</tr>
<tr>
<td>F2/Shift+F2</td>
<td>跳转到下/上一个错误语句处</td>
</tr>
<tr>
<td>Ctrl+Shift+Back</td>
<td>跳转到上次编辑的地方</td>
</tr>
<tr>
<td>Ctrl+Alt+Space</td>
<td>类名自动完成</td>
</tr>
<tr>
<td>Shift+Alt+Up/Down</td>
<td>内容向上/下移动</td>
</tr>
<tr>
<td>Ctrl+Shift+Up/Down</td>
<td>语句向上/下移动</td>
</tr>
<tr>
<td>Ctrl+Shift+U</td>
<td>大小写切换</td>
</tr>
<tr>
<td>Tab</td>
<td>代码标签输入完成后，按 Tab，生成代码</td>
</tr>
<tr>
<td>Ctrl+Backspace</td>
<td>按单词删除</td>
</tr>
<tr>
<td>Ctrl+Shift+Enter</td>
<td>语句完成</td>
</tr>
</tbody>
</table>
<h2 id="文件">文件</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl+F12</td>
<td>显示当前文件的结构</td>
</tr>
<tr>
<td>Ctrl+H</td>
<td>显示类继承结构图</td>
</tr>
<tr>
<td>Ctrl+Q</td>
<td>显示注释文档</td>
</tr>
<tr>
<td>Ctrl+P</td>
<td>方法参数提示</td>
</tr>
<tr>
<td>Ctrl+U</td>
<td>打开当前类的父类或者实现的接口</td>
</tr>
<tr>
<td>Alt+Left/Right</td>
<td>切换代码视图</td>
</tr>
<tr>
<td>Ctrl+Alt+Left/Right</td>
<td>返回上次编辑的位置</td>
</tr>
<tr>
<td>Alt+Up/Down</td>
<td>在方法间快速移动定位</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>快速打开光标处的类或方法</td>
</tr>
<tr>
<td>Ctrl+W</td>
<td>选中代码，连续按会有其他效果</td>
</tr>
<tr>
<td>Ctrl+Shift+W</td>
<td>取消选择光标所在词</td>
</tr>
<tr>
<td>Ctrl+ - / +</td>
<td>折叠/展开代码</td>
</tr>
<tr>
<td>Ctrl+Shift+ - / +</td>
<td>折叠/展开全部代码</td>
</tr>
<tr>
<td>Ctrl+Shift+.</td>
<td>折叠/展开当前花括号中的代码</td>
</tr>
<tr>
<td>Ctrl+ ] / [</td>
<td>跳转到代码块结束/开始处</td>
</tr>
<tr>
<td>F2 或 Shift+F2</td>
<td>高亮错误或警告快速定位</td>
</tr>
<tr>
<td>Ctrl+Shift+C</td>
<td>复制路径</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+C</td>
<td>复制引用，必须选择类名</td>
</tr>
<tr>
<td>Alt+Up/Down</td>
<td>在方法间快速移动定位</td>
</tr>
<tr>
<td>Shift+F1</td>
<td>要打开编辑器光标字符处使用的类或者方法 Java 文档的浏览器</td>
</tr>
<tr>
<td>Ctrl+G</td>
<td>定位行</td>
</tr>
</tbody>
</table>
<h2 id="查找">查找</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl+F</td>
<td>在当前窗口查找文本</td>
</tr>
<tr>
<td>Ctrl+Shift+F</td>
<td>在指定环境下查找文本</td>
</tr>
<tr>
<td>F3</td>
<td>向下查找关键字出现位置</td>
</tr>
<tr>
<td>Shift+F3</td>
<td>向上一个关键字出现位置</td>
</tr>
<tr>
<td>Ctrl+R</td>
<td>在当前窗口替换文本</td>
</tr>
<tr>
<td>Ctrl+Shift+R</td>
<td>在指定窗口替换文本</td>
</tr>
<tr>
<td>Ctrl+N</td>
<td>查找类</td>
</tr>
<tr>
<td>Ctrl+Shift+N</td>
<td>查找文件</td>
</tr>
<tr>
<td>Ctrl+Shift+Alt+N</td>
<td>查找项目中的方法或变量</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>查找变量的来源</td>
</tr>
<tr>
<td>Ctrl+Alt+B</td>
<td>快速打开光标处的类或方法</td>
</tr>
<tr>
<td>Ctrl+Shift+B</td>
<td>跳转到类或方法实现处</td>
</tr>
<tr>
<td>Ctrl+E</td>
<td>最近打开的文件</td>
</tr>
<tr>
<td>Alt+F3</td>
<td>快速查找，效果和Ctrl+F相同</td>
</tr>
<tr>
<td>F4</td>
<td>跳转至定义变量的位置</td>
</tr>
<tr>
<td>Alt+F7</td>
<td>查询当前元素在工程中的引用</td>
</tr>
<tr>
<td>Ctrl+F7</td>
<td>查询当前元素在当前文件中的引用，然后按 F3 可以选择</td>
</tr>
<tr>
<td>Ctrl+Alt+F7</td>
<td>选中查询当前元素(方法或元素)在工程中的引用</td>
</tr>
<tr>
<td>Ctrl+Alt+H</td>
<td>打开方法调用结构层级的窗口</td>
</tr>
<tr>
<td>Ctrl+Shift+F7</td>
<td>高亮显示匹配的字符，按 Esc 高亮消失</td>
</tr>
<tr>
<td>Ctrl+Shift+Alt+N</td>
<td>查找类中的方法或变量</td>
</tr>
<tr>
<td>Ctrl+F12</td>
<td>查找类中的方法</td>
</tr>
<tr>
<td>Ctrl+Shift+O</td>
<td>弹出显示查找内容</td>
</tr>
<tr>
<td>Ctrl+Alt+Up/Down</td>
<td>快速跳转搜索结果</td>
</tr>
<tr>
<td>Ctrl+Shift+S</td>
<td>高级搜索、搜索结构</td>
</tr>
</tbody>
</table>
<h2 id="重构">重构</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F5</td>
<td>复制</td>
</tr>
<tr>
<td>F6</td>
<td>移动</td>
</tr>
<tr>
<td>Alt+Delete</td>
<td>安全删除</td>
</tr>
<tr>
<td>Ctrl+U</td>
<td>转到父类</td>
</tr>
<tr>
<td>Ctrl+O</td>
<td>重写父类的方法</td>
</tr>
<tr>
<td>Ctrl+I</td>
<td>实现方法</td>
</tr>
<tr>
<td>Ctrl+Alt+N</td>
<td>内联</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+T</td>
<td>弹出重构菜单</td>
</tr>
<tr>
<td>Shift+F6</td>
<td>重构-重命名</td>
</tr>
<tr>
<td>Ctrl+Alt+M</td>
<td>提取代码组成方法</td>
</tr>
<tr>
<td>Ctrl+Alt+C</td>
<td>将变量更改为常量</td>
</tr>
<tr>
<td>Ctrl+Alt+V</td>
<td>定义变量引用当前对象或者方法的返回值</td>
</tr>
<tr>
<td>Ctrl+Alt+F</td>
<td>将局部变量更改为类的成员变量</td>
</tr>
<tr>
<td>Ctrl+Alt+P</td>
<td>将变量更改为方法的参数</td>
</tr>
</tbody>
</table>
<h2 id="调试">调试</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>F8</td>
<td>跳到下一步</td>
</tr>
<tr>
<td>Shift+F8</td>
<td>跳出函数、跳到下一个断点</td>
</tr>
<tr>
<td>Alt+Shift+F8</td>
<td>强制跳出函数</td>
</tr>
<tr>
<td>F7</td>
<td>进入代码</td>
</tr>
<tr>
<td>Shift+F7</td>
<td>智能进入代码</td>
</tr>
<tr>
<td>Alt+Shift+F7</td>
<td>强制进入代码</td>
</tr>
<tr>
<td>Alt+F9</td>
<td>运行至光标处</td>
</tr>
<tr>
<td>Ctrl+Alt+F9</td>
<td>强制运行至光标处</td>
</tr>
<tr>
<td>Ctrl+F2</td>
<td>停止运行</td>
</tr>
<tr>
<td>Alt+F8</td>
<td>计算变量值</td>
</tr>
</tbody>
</table>
<h2 id="VCS">VCS</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alt+ ~    VCS</td>
<td>操作菜单</td>
</tr>
<tr>
<td>Ctrl+K</td>
<td>提交更改</td>
</tr>
<tr>
<td>Ctrl+T</td>
<td>更新项目</td>
</tr>
<tr>
<td>Ctrl+Alt+Shift+D</td>
<td>显示变化</td>
</tr>
</tbody>
</table>
<h2 id="Others">Others</h2><table>
<thead>
<tr>
<th>按键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>(Ctrl+)F11</td>
<td>标记书签</td>
</tr>
<tr>
<td>Shift+F11</td>
<td>显示书签</td>
</tr>
</tbody>
</table>
<h2 id="REF">REF</h2><p><a href="http://zhengxiaopeng.com/2014/12/13/Android-Studio-jar%E3%80%81so%E3%80%81library%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96/" target="_blank" rel="external">Android Studio Jar、so、library项目依赖</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/12/AndroidStudio-快捷键/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/05/创业团队股权分配/" title="创业团队股权分配" itemprop="url">创业团队股权分配</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-08-05T07:33:39.000Z" itemprop="datePublished"> 发表于 2015-08-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>团队分配股权，根本上来说，是需要创始人在分配和讨论过程中，整个团队感觉到合理、公平的一个分配方案，需要让各方达成共识。但是股权分配肯定无法替代信任的建立。<br>另外，股权分配一旦确定，很多在执行力上不足，这也是很多创业团队现有的问题，这时大家必须坐到一块，兑现股权约定。<br>本文从互联网资料参考，并进行总结，希望能让大家有所收获。</p>
<h2 id="阶梯分配">阶梯分配</h2><p>将其取名为阶梯，是因为这个分配是从进入团队的不同时期来进行分配，越迟加入公司的员工风险越低。</p>
<h3 id="原则">原则</h3><p>为了简单，假设所有创始人都全职创业。<br>随着公司的不断壮大，新员工不断加入，公司的也将一批一批的加入新员工，当你进行第一批招人时，很可能你已经获取到现金流（投资或者客户），所以除了创始人（第一批）之外，其他都不是创始人，他们是加入公司打工，因为他们不需要冒很大风险且从工作第一天就开始拿工资了。<br>那么当你的公司大到可以上市或者其他，这时你的公司也许已经有了6批，员工大约5批，第二批有5个，第三批25个，第四批200，ETC。<br>综上：创始人应该最终拿整个公司大约50%的股份，首批下面的5批员工每一批最终都分别分到大约10%的公司股份，每一批员工都将平分这10%股份。<br>基本思路就是，你设立不同的资历，最高的员工承受最大风险，最低员工风险最低，每批员工平均分配给这个这批股份，也就是让越早加入员工获得越多股份。<br>现在，你还需用执行一个重要的原则：股份绑定（vesting）。绑定期最好是4-5年，任何人在公司起码1年才可持有股份（包括创始人）。一般头一年25%，接下来每月落实2%。没有股份绑定条款，派股给任何人都是不靠谱的！<br>最后需要解决一个问题，当有新的投资进来时，将如何分割股份？答案很简单：新的投资将稀释所有人的股份。<br>另外，千万不要用分配股权来解决一些薪资或其他问题，比如：</p>
<ol>
<li>创业构想提出者，需要多拿股份吗？</li>
<li>创始人之一不是全职投入？（那创始人就不是创始人了）</li>
<li>为公司提供设备或其他有价值（专利等）东西，如何处理？<br>这些问题，都可通过类似补发工资等方式来解决，在公司现金流运转正常之后，对每个创始人薪资进行补发，避免因此引起的纠纷。<br>投资人、创始人和雇员分别拥有多少股份？这个需要市场来确定，现实地看，如果投资人最终获得50%以上，创始人重要性将被削弱，从而丧失动力。而如果创始人和员工如果持有100%股份，也会给投资人带来很大的压力，以平衡投资人和创始人/员工之间分配。正常公司上市时，投资人将拥有50%股份，创始人+员工将拥有50%股份。<h3 id="总结">总结</h3>虽然创业公司股权分配原则没有一刀切的解决方案，但是尽可能简单化、透明化、公平化！</li>
</ol>
<h2 id="常规分配">常规分配</h2><p>股权分配最错误的做法是股权五五分，五五分的结果是没有分配决定权。在开始的蜜月期可能不会产生争执，正所谓可以共患难，难以同甘苦。到了一定阶段，出现分歧的时候，如果有没有一个人拥有绝对的控制权，可能谁也不服气谁，最终的结果就是分道扬镳，创业失败。基于公司法规定的的股权1/2的决议规则和2/3的特别决议规则，相对理想的股权分配是持1/2以上股权，更理想是2/3以上。<br>这边分为三个部分。<br>一是创始人的股权。<br>二是员工的股权。<br>三是众筹的股权。</p>
<h3 id="创始人的股权">创始人的股权</h3><h4 id="确定创始人">确定创始人</h4><p>创始人是承担了风险的人。判断创始人的简单方法是拿不拿工资，如果在最开始，都不能支付工资给你，那你就是创始人。<br>按照下面标准来进行股权增减：</p>
<ol>
<li>初始(每人均分100份股权)。</li>
<li>召集人(股权增加5%)。</li>
<li>创业点子及执行很重要(股权增加5%)。提供了最初的创业点子并执行成功。</li>
<li>迈出第一步最难(股权增加5%-25%)。如果某个创始人提出的概念已经着手实施，比如已经开始申请专利、已经有一个演示原型、已经有一个产品的早期版本，或者其他对吸引投资或贷款有利的事情，那么这个创始人额外可以得到的股权，从5%到 25%不等。</li>
<li>CEO，即总经理应该持股更多(股权增加5%)。</li>
<li>全职创业是最最有价值的(股权增加200%)。</li>
<li>信誉是最重要的资产(股权增加50-500%)。如果创始人是第一次创业，而他的合伙人里有人曾经参与过风投投资成功了的项目，那么这个合伙人比创始人更有投资价值。在某些极端情况 下，某些创始人会让投资人觉得非常值得投资，这些超级合伙人基本上消除了“创办阶段”的所有风险，所以最好让他们在这个阶段获得最多的股权。</li>
<li>现金投入参照投资人投资。很可能是某个合伙人投入的资金相对而言多的多。这样的投资应该获较多的股权，因为最早期的投资，风险也往往最大，所以应该获得更多的股权。</li>
<li>最后进行计算。假设最后计算的三个创始人的股份是为200/150/250，那么将他们的股份数相加(即为600份)作为总数，再计算他们每个人的持股比例：33%/25%/42%。<h4 id="创始人股权的退出机制">创始人股权的退出机制</h4>作为创业企业，如果创始人离开创业团队就涉及股权的退出机制。如果不设定退出机制，允许中途退出的合伙人带走股权，对退出合伙人的公平，但却是对其它长期参与创业的合伙人最大的不公平，对其它合伙人也没有安全感。<br>对于退出的合伙人，一方面，可以全部或部分收回股权；另一方面，必须承认合伙人的历史贡献，按照一定溢价/或折价回购股权。对于如何确定具体的退出价格，涉及两个因素，一个是退出价格基数，一个是溢价/或折价倍数。可以考虑按照：</li>
<li>合伙人掏钱买股权的购买价格的一定溢价回购</li>
<li>退出合伙人按照其持股比例可参与分配公司净资产或净利润的一定溢价</li>
<li>按照公司最近一轮融资估值的一定折扣价回购</li>
<li>有些退出价格是当时投入的本金，加合理利息回报。至于退出价格，不同公司会存在差异。<h4 id="股权与分红权的分离">股权与分红权的分离</h4>分红权和股权可以分离，表决权理论上也可以分离。对于出资较大的合伙人，可以给与较大的分红权，但对于承担风险较大的，应给与较大的股权。<h4 id="股权协议的约定">股权协议的约定</h4>一些公司出现拥有股权的合伙人在创业过程中出现了，违背创业企业利益的行为，比如泄密或者携带知识产权另立门户等，为了保护创业企业其他合伙人的利益，最好在协议中约定这些对股权的限制条款。还可制定股权实现的考核标准，不达到考核标准不拥有股权。<h3 id="员工的股权">员工的股权</h3>什么是员工？谁是员工的判断标准是看其是否是具有员工心态的人。在创业企业，有些合伙人希望把员工当做合伙人，也给与股权激励。这样的做法，负面作用是：</li>
<li>过早的分散了股权</li>
<li>拥有员工心态的人，希望得到的是稳定的现金收入，而不是未来可能增值的股权。<br>因此，即使是作为激励作用的股权也不应当份额过大。员工管理问题不应单纯利用股权解决。一般来说，VC会要求员工持股计划在VC投资进来之前执行，这样VC就可以减少稀释。不过不能认为这是A轮VC自私，要知道B轮VC到时候也会要求在他们进来之前再执行一次员工持股计划，这时A轮VC和创始股东将一起稀释。 员工的期权比例应该留多少？一般来说是5-15%。<h3 id="众筹的股权">众筹的股权</h3><strong>众筹从概念逐渐变为实践，“股权众筹是否构成非法集资”已经不再是法律角度的焦点。</strong>股权众筹，既然是“众”筹，就说明股东数量非常多。不过，公司法规定，有限责任公司的股东不超过50人，非上市的股份有限公司股东不超过200人。法律对公司股东人数的限制，导致大部分众筹股东不能直接出现在企业工商登记的股东名册中。这一问题的解决方案一般有两种：</li>
<li><strong>委托持股，或者说是代持股。</strong>一个实名股东分别与几个乃至几十个隐名的众筹股东签订代持股协议，代表众筹股东持有众筹公司股份。在这种模式下，众筹股东并不亲自持有股份，而是由某一个实名股东持有，并且在工商登记里只体现出该实名股东的身份。中国国内法律已经认可了保护真实股东的合法利益，也就是即使股东名册里面没有出现众筹股东的名字，只要有协议证明真实股东是真实的出资人，其权益也是被保障的。</li>
<li><strong>持股平台持股。</strong>比如，先设立一个持股平台，五十个众筹股东作为这个持股平台的投资人，把资金投入持股平台。然后，持股平台把这笔款再投入众筹公司，由持股平台作为众筹公司的股东。这样五十个众筹股东在众筹公司里只体现为一个股东，即持股平台。持股平台可以是有限责任公司，也可以是有限合伙。两者对于众筹股东来说都是有限责任的。按照合伙企业法，通常有限合伙人不参与管理，由普通合伙人负责管理。这样，众筹发起人就可以其普通合伙人的身份，管理和控制持股平台，进而控制持股平台在众筹公司的股份，也就实际上控制了众筹股东的投资及股份。<br><strong>期权池</strong>是在融资前为未来引进高级人才而预留的一部分股份，用于激励员工(包括创始人自己、高管、骨干、普通员工)，是初创企业实施股权激励计划(Equity Incentive Plan)最普通采用的形式，在欧美等国家被认为是驱动初创企业发展必要的关键要素之一。硅谷的惯例是预留公司全部股份的10%-20%作为期权池，较大的期权池对员工和VC具更大吸引力。 VC一般要求期权池在它进入前设立，并要求在它进入后达到一定比例。由于每轮融资都会稀释期权池的股权比例，因此一般在每次融资时均调整(扩大)期权池，以不断吸引新的人才。<h3 id="案例">案例</h3>苹果，起始阶段的股权比例是乔布斯和沃兹尼亚克各45%，韦恩10%；谷歌，佩吉和布林一人一半；Facebook，扎克伯格65%，萨维林30%，莫斯科维茨5%。<br>苹果电脑是沃兹尼亚克开发的，但乔布斯和沃兹股份一样（沃兹的父亲对此非常不满），因为乔布斯不仅是个营销天才，而且拥有领导力，对公司未来意志坚定激情四射。而沃兹生性内敛，习惯于一个人工作，并且只愿意兼职为新公司工作，乔布斯和他的朋友家人百般劝说才同意全职。至于韦恩，他拥有10%是因为其他两人在运营公司方面完全是新手，需要他的经验。由于厌恶风险，韦恩很快就退股了，他一直声称自己从未后悔过。<br>Facebook是扎克伯格开发的，他又是个意志坚定的领导者，因此占据65%，萨维林懂得怎样把产品变成钱，莫斯科维茨则在增加用户上贡献卓著。不过，Facebook起始阶段的股权安排埋下了日后隐患。由于萨维林不愿意和其他人一样中止学业全情投入新公司，而他又占有1/3的股份。因此，当莫斯科维茨和新加入但创业经验丰富的帕克贡献与日俱增时，就只能稀释萨维林的股份来增加后两者的持股，而萨维林则以冻结公司账号作为回应。A轮融资完成后，萨维林的股份降至不到10%，怒火中烧的他干脆将昔日伙伴们告上了法庭。萨维林之所以拿那么高股份是因为他能为公司赚到钱，而公司每天都得花钱。但扎克伯格的理念是“让网站有趣比让它赚钱更重要”，萨维林想的则是如何满足广告商要求从而多赚钱。短期看萨维林是对的，但这么做不可能成就一家伟大的公司，扎克伯格对此心知肚明。Facebook正确的办法应当是早一点寻找天使投资，就像苹果和谷歌曾经做过的那样。在新公司确定产品方向之后，就需要天使投资来帮助自己把产品和商业模式稳定下，避免立即赚钱的压力将公司引入歧途。Facebook的天使投资人是帕克的朋友介绍的彼得·泰尔，他注资50万美元，获得 10%股份。这之后，Facebook的发展可谓一帆风顺，不到一年就拿到了A轮融资——阿克塞尔公司投资1270万美元，公司估值1亿美元。7年后的2012年，Facebook上市，此时公司8岁。谷歌从天使到A轮的时间差不多是一年。硅谷著名风投公司KPCB和红杉资本各注入谷歌125万美元，分别获得10%股份。5后的2004年，也就是公司创立6年后，谷歌上市，近2000名员工获得配股。 苹果公司在马库拉投资后没有经历后续融资，4年之后上市，上百名员工成了百万富翁，此时公司5岁。<h3 id="总结-1">总结</h3>创业团队在组建过程中需要制定股权分配方案。随着公司逐渐变大，资本需求会越来越旺，后续融资不可避免，引进经验丰富的运营人才也必须授予其股权或期权，这些都会稀释创始人的股权。事实上，创始人在公司长大之后如何不被董事会踢出自己创办的公司，早已是硅谷的经典话题之一。乔布斯在苹果上市4年半后被赶出了苹果公司，没有一个创始人愿意失去自己的公司，而他们也有办法做到这一点，那就是采用双层股权结构（就是前文提到的表决权和分红权分离的做法）。<br>苹果当年是单一股权结构，同股同权，苹果上市后，乔布斯的股权下降到11%，董事会里也没有他的铁杆盟友（他本以为马库拉会是），触犯众怒后的结局可想而知。 谷歌则在上市时重拾美国资本市场消失已久的AB股模式，佩吉、布林、施密特等公司创始人和高管持有B类股票，每股表决权等于A类股票10股的表决权。2012年，谷歌又增加了不含投票权的C类股用于增发新股。这样，即使总股本继续扩大，即使创始人减持了股票，他们也不会丧失对公司的控制力。预计到2015年，佩吉、布林、施密特持有谷歌股票将低于总股本的20%，但仍拥有近60%的投票权。Facebook前年上市时同样使用了投票权1：10的AB股模式，这样扎克伯格一人就拥有28.2的表决权。此外，扎克伯格还和主要股东签订了表决权代理协议，在特定情况下，扎克伯格可代表这些股东行使表决权，这意味着他掌握了56.9%的表决权。<br>在中国，公司法规定同股同权，不允许直接实施双层或三层股权结构，但公司法允许公司章程对投票权进行特别约定（有限责任公司），允许股东在股东大会上将自己的投票权授予其他股东代为行使（股份有限公司）。</li>
</ol>
<h2 id="总结-2">总结</h2><p>股权分配问题是一种博弈，是不同角色之间的讨价还价，也取决于不同人的性格，没有一个标准答案。</p>
<h2 id="Ref">Ref</h2><p><a href="http://www.zhihu.com/question/19551070" target="_blank" rel="external">几个朋友合伙创业，如何分配股权？ - 知乎</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19906816" target="_blank" rel="external">杜国栋：联合创始人退出，他手里的股权怎么办？ - 创思舍 - 知乎专栏</a><br><a href="http://zhuanlan.zhihu.com/duguodong/19970947" target="_blank" rel="external">创始人之间如何分股权：按贡献估值 - 创思舍 - 知乎专栏</a><br><a href="http://wenku.baidu.com/view/cd30202c453610661ed9f410.html" target="_blank" rel="external">华为股权分配政策(幻灯片)_百度文库</a><br><a href="http://www.tmtpost.com/172112.html" target="_blank" rel="external">联合创始人股权分配，五五分是最糟糕的做法</a><br><a href="http://blog.sina.com.cn/s/blog_61b925fa0100foie.html" target="_blank" rel="external">(3)11.18.09 期权：为什么给，给多少，怎么给？<em>邵亦波</em>新浪博客</a><br><a href="http://36kr.com/p/22890.html" target="_blank" rel="external">Joel Spolsky: 创业公司如何公平分配股权？</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/创业/">创业</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/创业/">创业</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/08/05/创业团队股权分配/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/29/HTML-In-TextView/" title="HTML In TextView" itemprop="url">HTML In TextView</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/+JianrongHuang?rel=author" title="HwangJR" target="_blank" itemprop="author">HwangJR</a>
		
  <p class="article-time">
    <time datetime="2015-07-29T07:50:06.000Z" itemprop="datePublished"> 发表于 2015-07-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景">背景</h2><p>往往我们会遇到效果图中需要展示多个颜色的文字，不同的大小，甚至有可能会遇到多个排版，这时候，如果我们全部用TextView，有时候一个字就因为颜色不同就得新建一个TextView，是很浪费。这时候，我们可以适当考虑HTML来排版并显示在TextView中。<br>目前在GITHUB上面已经开源一个Html TextView库，有学习价值，有兴趣可以参考：<a href="https://github.com/sufficientlysecure/html-textview" target="_blank" rel="external">html-textview</a></p>
<h2 id="HTML在string-xml中">HTML在string.xml中</h2><p>在string.xml中是无法直接写html，下面实例包括字符替换和HTML示例。<br>string.xml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name=<span class="string">"format_temp"</span>&gt;&lt;![CDATA[&lt;font color=\<span class="string">"#9d9d9d\"&gt;%1<span class="variable">$s</span>&lt;/font&gt; 收到@&lt;font color=\"#dd3a37\"&gt;%2<span class="variable">$s</span>&lt;/font&gt;的示例]]&gt;&lt;/string&gt;</span><br><span class="line">// 或者使用转意</span><br><span class="line">&lt;string name="</span>format_temp<span class="string">"&gt;Text: &amp;lt;b&gt;%s&amp;lt;/b&gt;&lt;/string&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.format(getString(R.string.format_temp)), <span class="string">"刚刚"</span>, <span class="string">"大胖"</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="在TextView中的使用">在TextView中的使用</h2><h3 id="文本展示">文本展示</h3><p>单纯文本展示直接使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动</span></span><br><span class="line">TextView.setMovementMethod(ScrollingMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure></p>
<h3 id="超链接展示">超链接展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">TextView.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure>
<p>或者设置TextView的autoLink为all<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"all"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;TextView</span><br><span class="line">	android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">	android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">	android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">	android:autoLink=<span class="string">"web|email"</span> /&gt;</span><br><span class="line"></span><br><span class="line">TextView.setAutoLinkMask(Linkify.ALL);</span><br><span class="line">TextView.setAutoLinkMask(Linkify.EMAIL_ADDRESSES|Linkify.WEB_URLS);</span><br></pre></td></tr></table></figure></p>
<h3 id="图片展示">图片展示</h3><p>在Html的fromHtml方法中，可以传入Html的ImageGetter。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TextView.setText(Html.fromHtml(html, <span class="keyword">new</span> ImageGetter(), <span class="keyword">null</span>));</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageGetter</span> <span class="keyword">implements</span> <span class="title">Html</span>.<span class="title">ImageGetter</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">		Drawable d = getResources().getDrawable(R.drawable.ic_launch);</span><br><span class="line">		d.setBounds(<span class="number">0</span>,<span class="number">0</span>,d.getIntrinsicWidth(),d.getIntrinsicHeight());</span><br><span class="line">		<span class="keyword">return</span> d;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="自定义TAG展示">自定义TAG展示</h3><p>这时，我们需要用到我们最后一个传入参数，<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Html.TagHandler.html" target="_blank" rel="external">Html.TagHandler</a>。简单示例一个size的标签。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SizeLabel</span> <span class="keyword">implements</span> <span class="title">TagHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SizeLabel</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTag</span><span class="params">(<span class="keyword">boolean</span> opening, String tag, Editable output,</span><br><span class="line">                          XMLReader xmlReader)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * 参数： </span><br><span class="line">         * opening：为true时表示开始解析,为false时表示解析完 </span><br><span class="line">         * tag:当前解析的标签 </span><br><span class="line">         * output:文本中的内容 </span><br><span class="line">         * xmlReader:xml解析器 </span><br><span class="line">         */</span></span><br><span class="line">        <span class="comment">// 判断当前解析的tag是否为size,并且已经解析完毕(在没有解析完毕之前output中没有数据)  </span></span><br><span class="line">        <span class="keyword">if</span> (tag.toLowerCase().equals(<span class="string">"size"</span>) &amp;&amp; !opening) &#123;</span><br><span class="line">            <span class="comment">// 通过output调用setSpan方法,改变文本的0下标到最后的下标的大小;  </span></span><br><span class="line">            <span class="comment">// 最后的参数用来标识在span范围内的文本前后输入新的字符时是否也改变它们的效果;  </span></span><br><span class="line">            output.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(size), <span class="number">0</span>, output.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="支持的HTML标签">支持的HTML标签</h2><p>并不是所有的HTML标签都支持，目前支持的标签分为两类：<br>1 . 静态string资源中，解析是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/content/res/StringBlock.java" target="_blank" rel="external">android.content.res.StringBlock</a>类来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：支持href属性</span><br><span class="line"><span class="tag">&lt;<span class="title">annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：支持height, size, fgcolor和bicolor</span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">marquee</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2 . Html.fromHtml方法中支持是通过<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/core/java/android/text/Html.java" target="_blank" rel="external">Html.java</a>来进行，目前支持的有：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>：href</span><br><span class="line"><span class="tag">&lt;<span class="title">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">big</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">cite</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dfn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">em</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">font</span>&gt;</span>：color和face属性</span><br><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> - <span class="tag">&lt;<span class="title">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span>&gt;</span>：支持src属性，需要实现ImageGetter接口</span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strike</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sub</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">tt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">u</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>另外，font的color属性除了直接支持颜色色值之外，还支持一些颜色的直接名字，<a href="https://android.googlesource.com/platform/frameworks/base.git/+/android-5.1.1_r8/graphics/java/android/graphics/Color.java" target="_blank" rel="external">Color.java</a>的getHtmlColor方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">black</span><br><span class="line">darkgray</span><br><span class="line">gray</span><br><span class="line">lightgray</span><br><span class="line">white</span><br><span class="line">red</span><br><span class="line">green</span><br><span class="line">blue</span><br><span class="line">yellow</span><br><span class="line">cyan</span><br><span class="line">magenta</span><br><span class="line">aqua</span><br><span class="line">fuchsia</span><br><span class="line">darkgrey</span><br><span class="line">grey</span><br><span class="line">lightgrey</span><br><span class="line">lime</span><br><span class="line">maroon</span><br><span class="line">navy</span><br><span class="line">olive</span><br><span class="line">purple</span><br><span class="line">silver</span><br><span class="line">teal</span><br></pre></td></tr></table></figure></p>
<h2 id="简单原理剖析">简单原理剖析</h2><p>其实这主要是用到了<a href="http://developer.android.com/intl/zh-cn/reference/android/text/Spannable.html" target="_blank" rel="external">Spannable</a>接口。里面已经实现了SpannableString及setSpan即可得到我们想要的风格。</p>
<h3 id="简单使用">简单使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpannableString text = <span class="keyword">new</span> SpannableString(<span class="string">"Test"</span>);</span><br><span class="line">TextView.setText(text);</span><br></pre></td></tr></table></figure>
<h3 id="字体样式">字体样式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setSpan会将start到end这间的文本设置成创建的span格式。span可以是图片格式。</span></span><br><span class="line"><span class="comment">// 设置字体(default,default-bold,monospace,serif,sans-serif)</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"monospace"</span>), <span class="number">0</span>, <span class="number">2</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 等宽字体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"serif"</span>), <span class="number">2</span>, <span class="number">4</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 衬线字体</span></span><br></pre></td></tr></table></figure>
<h3 id="字体绝对大小">字体绝对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体绝对大小（绝对值,单位：像素）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>), <span class="number">4</span>, <span class="number">6</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 第二个参数boolean dip，如果为true，表示前面的字体大小单位为dip，否则为像素，同上。</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>, <span class="keyword">true</span>), <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="字体相对大小">字体相对大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体相对大小（相对值,单位：像素） 参数表示为默认字体大小的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">0.5f</span>), <span class="number">8</span>, <span class="number">10</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 0.5f表示默认字体大小的一半</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">2.0f</span>), <span class="number">10</span>, <span class="number">12</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体大小的两倍</span></span><br></pre></td></tr></table></figure>
<h3 id="前景色和背景色">前景色和背景色</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体前景色 ，Color.MAGENTA为紫红</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ForegroundColorSpan(Color.MAGENTA), <span class="number">12</span>, <span class="number">15</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置前景色为洋红色</span></span><br><span class="line"><span class="comment">// 设置字体背景色 ，Color.CYAN为青绿色</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> BackgroundColorSpan(Color.CYAN), <span class="number">15</span>, <span class="number">18</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 设置背景色为青色</span></span><br></pre></td></tr></table></figure>
<h3 id="设置字体粗体、斜体、粗斜体">设置字体粗体、斜体、粗斜体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体样式正常，粗体，斜体，粗斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.NORMAL), <span class="number">18</span>, <span class="number">20</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 正常</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD), <span class="number">20</span>, <span class="number">22</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.ITALIC), <span class="number">22</span>, <span class="number">24</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 斜体</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD_ITALIC), <span class="number">24</span>, <span class="number">27</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 粗斜体</span></span><br></pre></td></tr></table></figure>
<h3 id="设置下划线和删除线">设置下划线和删除线</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置下划线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> UnderlineSpan(), <span class="number">27</span>, <span class="number">30</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// 设置删除线</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">30</span>, <span class="number">33</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure>
<h3 id="设置下标和上标">设置下标和上标</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text.setSpan(<span class="keyword">new</span> SubscriptSpan(), <span class="number">34</span>, <span class="number">35</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 下标</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> SuperscriptSpan(), <span class="number">36</span>, <span class="number">37</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 上标</span></span><br></pre></td></tr></table></figure>
<h3 id="设置超链接">设置超链接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超级链接（需要添加setMovementMethod方法附加响应）</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"tel:13888888888"</span>), <span class="number">37</span>, <span class="number">39</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 电话</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mailto:google@google.com"</span>), <span class="number">39</span>, <span class="number">41</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 邮件</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"http://www.google.com"</span>), <span class="number">41</span>, <span class="number">43</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// URL</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"sms:13888888888"</span>), <span class="number">43</span>, <span class="number">45</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 短信，使用sms:或者smsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mms:13888888888"</span>), <span class="number">45</span>, <span class="number">47</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 彩信，使用mms:或者mmsto:</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"geo:38.899533,-77.036476"</span>), <span class="number">47</span>, <span class="number">49</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 地图</span></span><br></pre></td></tr></table></figure>
<h3 id="拉伸字体">拉伸字体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字体大小（相对值,单位：像素） 参数表示为默认字体宽度的多少倍</span></span><br><span class="line">text.setSpan(<span class="keyword">new</span> ScaleXSpan(<span class="number">2.0f</span>), <span class="number">49</span>, <span class="number">51</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">// 2.0f表示默认字体宽度的两倍，即X轴方向放大为默认字体的两倍，而高度不变</span></span><br></pre></td></tr></table></figure>
<h2 id="Ref">Ref</h2><p><a href="http://aichixihongshi.iteye.com/blog/1207503" target="_blank" rel="external">android中用Spannable在TextView中设置超链接、颜色、字体</a><br><a href="https://commonsware.com/blog/Android/2010/05/26/html-tags-supported-by-textview.html" target="_blank" rel="external">HTML Tags Supported By TextView</a><br><a href="http://daniel-codes.blogspot.com/2011/04/html-in-textviews.html" target="_blank" rel="external">HTML in TextViews</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/tech/">tech</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/29/HTML-In-TextView/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Books/" title="Books">Books<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/CI/" title="CI">CI<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/tech/" title="tech">tech<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/创业/" title="创业">创业<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/tech/" title="tech">tech<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/创业/" title="创业">创业<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ci/" title="ci">ci<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Books/" title="Books">Books<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.hwangjr.com" target="_blank" title="HwangJR&#39;s Blog">HwangJR&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, Welcome to my blog. <br/>
			I&#39;m HwangJR, Tech change the world.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1234193120" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/https://github.com/hwangjr" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/4827228" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/HuangJR" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/https://facebook.com/jr.hwang.2010" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		<a href="https://www.zhihu.com/people/hwangjr" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/+JianrongHuang?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:huangjianrong2010@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="HwangJR">HwangJR</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'HwangJR';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-63911310-1', 'hwangjr.github.io');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: '6e8f6d9aa88722365432'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
 </html>
